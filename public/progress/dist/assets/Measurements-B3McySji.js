import{j as e,u as t,z as s,d as a,c as l,y as i}from"./index-CS486dXL.js";import{r as n,_ as r}from"./vendor-DTtRowIX.js";import{l as d}from"./loadRecharts-BTZDNLeK.js";import"./charts-Cu4NAUVk.js";function o(){const[t,s]=n.useState(!1);return e.jsxs("div",{children:[e.jsx("button",{className:"text-xs underline",onClick:()=>s(!0),children:"How to measure"}),t&&e.jsx("div",{className:"fixed inset-0 bg-black/60 grid place-items-center",onClick:()=>s(!1),children:e.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-soft max-w-md",onClick:e=>e.stopPropagation(),children:[e.jsx("div",{className:"font-medium mb-2",children:"How to measure"}),e.jsx("img",{src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyMDAgMTAwJyB3aWR0aD0nMjAwJyBoZWlnaHQ9JzEwMCc+PHJlY3QgeD0nMTAnIHk9JzEwJyB3aWR0aD0nMTgwJyBoZWlnaHQ9JzgwJyByeD0nMTAnIGZpbGw9JyMxMTE4MjYnLz48dGV4dCB4PScxMDAnIHk9JzU1JyBmaWxsPSd3aGl0ZScgdGV4dC1hbmNob3I9J21pZGRsZScgZm9udC1zaXplPScxMic+TWVhc3VyZW1lbnQgSWxsdXN0cmF0aW9uczwvdGV4dD48L3N2Zz4K",alt:"illustrations",className:"rounded-xl"}),e.jsx("div",{className:"text-xs text-gray-400 mt-2",children:"Illustrations placeholder"})]})})]})}function c(e){return null==e||e!=e?"—":"number"==typeof e?Math.abs(e)>=1e3?Math.round(e).toString():Math.abs(e)>=100?e.toFixed(1):(Math.abs(e),e.toFixed(2)):e}const m=({active:t,payload:s,label:a,labelFormatter:l,context:i})=>{if(!t||!s||!s.length)return null;const n=s.filter(e=>e&&null!=e.value);return n.length?e.jsxs("div",{className:"text-[10px] bg-slate-900/90 backdrop-blur rounded-lg border border-white/10 px-2 py-1.5 space-y-1 shadow-lg max-w-[220px]",children:[e.jsx("div",{className:"font-semibold text-[10px] text-white/80",children:l?l(a):a}),e.jsx("div",{className:"space-y-0.5",children:n.map((t,s)=>{var l;const n=t.name||t.dataKey,r=t.value,d=null==(l=null==i?void 0:i.seriesMinMax)?void 0:l[n],o=d&&r===d.min,m=d&&r===d.max;let x=null,u=null;if(null==i?void 0:i.previousPointLookup){const e=i.previousPointLookup(n,a);if(null!=e){const t=r-e;if(Math.abs(t)>0){if(x=(t>0?"+":"")+c(t),0!==e){const s=t/e*100;u=(s>0?"+":"")+(Math.abs(s)>=10?s.toFixed(1):s.toFixed(2))+"%"}}}}return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"inline-block w-2 h-2 rounded-full",style:{background:t.color||t.stroke||t.fill||"#888"}}),e.jsx("span",{className:"truncate max-w-[90px]",children:n}),e.jsx("span",{className:"ml-auto font-medium",children:c(r)}),x&&e.jsx("span",{className:"ml-1 "+(x.startsWith("+")?"text-emerald-400":"text-red-400"),children:x}),u&&e.jsx("span",{className:"ml-1 "+(u.startsWith("+")?"text-emerald-300":"text-red-300"),children:u}),(o||m)&&e.jsx("span",{className:"ml-1 "+(m?"text-amber-400":"text-sky-400"),children:m?"▲":"▼"})]},s)})})]}):null};const x={neck:"Measure at the thickest point, relaxed.",chest:"Tape at nipples level, relaxed.",waist:"At navel, relaxed but not sucked in.",hips:"Around glutes at the widest point.",thigh:"Mid-thigh, stand tall.",calf:"At the largest point standing.",upperArm:"Upper arm cold, flexed lightly.",forearm:"At the largest point, arm parallel to floor.",heightCm:"Stand tall without shoes, heels together, back against the wall. Measure to the nearest 0.5 cm."},u={weightKg:"Weight (kg)",heightCm:"Height (cm)",upperArm:"Upper arm",bodyFatPct:"Body fat %",leanMassKg:"Lean mass (kg)",fatMassKg:"Fat mass (kg)",ffmi:"FFMI",ffmiAdjusted:"Adj. FFMI"},g={weightKg:"kg",heightCm:"cm",neck:"cm",chest:"cm",waist:"cm",hips:"cm",thigh:"cm",calf:"cm",upperArm:"cm",forearm:"cm"},h=e=>{if(u[e])return u[e];const t=e.replace(/([A-Z])/g," $1").replace(/_/g," ").trim();return t?t.charAt(0).toUpperCase()+t.slice(1):e},p=[{key:"skinfoldChest",label:"Chest",description:"Diagonal fold taken halfway between the nipple and anterior axillary line. Pinch firmly and place caliper 1cm below fingers."},{key:"skinfoldAxilla",label:"Mid-axilla",description:"Vertical fold on the mid-axillary line at the level of the xiphoid process (just below the sternum)."},{key:"skinfoldTricep",label:"Tricep",description:"Vertical fold on the back of the upper arm, halfway between shoulder and elbow. Arm relaxed at side."},{key:"skinfoldSubscapular",label:"Subscapular",description:"Diagonal fold just below the shoulder blade, angled at ~45° following the natural skin crease."},{key:"skinfoldAbdomen",label:"Abdomen",description:"Vertical fold 2cm to the right of the navel. Exhale softly before measuring."},{key:"skinfoldSuprailiac",label:"Suprailiac",description:"Diagonal fold just above the hip bone along the natural line of the iliac crest, angled toward the groin."},{key:"skinfoldThigh",label:"Thigh",description:"Vertical fold on the front of the thigh, midway between hip and knee. Shift weight to the opposite leg."},{key:"skinfoldBicep",label:"Bicep",description:"Vertical fold on the front of the upper arm, halfway between shoulder and elbow, arm relaxed."}],f=["Always measure on the right side of the body for consistency.","Take at least two readings per site and use the average when possible.","Pinch the skinfold firmly before applying the caliper 1cm below your fingers.","Allow the caliper to settle for ~2 seconds before reading the value in millimetres.","Stay relaxed — flexing or twisting can change the thickness of the fold."],b=["skinfoldChest","skinfoldAxilla","skinfoldTricep","skinfoldSubscapular","skinfoldAbdomen","skinfoldSuprailiac","skinfoldThigh"],y=["skinfoldChest","skinfoldAbdomen","skinfoldThigh"],N=["skinfoldTricep","skinfoldSuprailiac","skinfoldThigh"];function v({sex:e,age:t,calipers:s,weightKg:a}){const l=e=>{const t=s[e];return"number"!=typeof t||Number.isNaN(t)?void 0:t},i=e=>e.every(e=>null!=l(e));if(!t||Number.isNaN(t)||t<=0)return{ok:!1,reason:"age"};const n=(s,i)=>{const n=s.reduce((e,t)=>e+(l(t)??0),0);const r=((s,a)=>"seven"===a?"male"===e?1.112-43499e-8*s+55e-8*s*s-28826e-8*t:1.097-46971e-8*s+56e-8*s*s-12828e-8*t:"male3"===a?1.10938-8267e-7*s+16e-7*s*s-2574e-7*t:1.0994921-9929e-7*s+23e-7*s*s-1392e-7*t)(n,i);if(!r||Number.isNaN(r)||r<=0)return{ok:!1,reason:"sites",missingSites:s};const d=495/r-450,o=Math.max(2,Math.min(70,d)),c="number"==typeof a?Number((a*(1-o/100)).toFixed(2)):void 0,m="number"==typeof a?Number((a*(o/100)).toFixed(2)):void 0;return{ok:!0,method:"seven"===i?"Jackson & Pollock 7-site":"male3"===i?"Jackson & Pollock 3-site (male)":"Jackson & Pollock 3-site (female)",sum:n,usedSites:s,density:r,bodyFatPct:Number(o.toFixed(2)),leanMassKg:c,fatMassKg:m}};if(i(b))return n(b,"seven");if("male"===e&&i(y))return n(y,"male3");if("female"===e&&i(N))return n(N,"female3");const r=[];return("male"===e?y:N).forEach(e=>{null==l(e)&&r.push(e)}),{ok:!1,reason:"sites",missingSites:r}}function j(){var c;const[u,b]=n.useState({id:t(),dateISO:(new Date).toISOString()}),[y,N]=n.useState([]),{push:j}=s(),w=n.useRef(null),[k,M]=n.useState(null),[F,A]=n.useState(()=>{if("undefined"==typeof window)return{sex:"male",age:30};try{const e=window.localStorage.getItem("bodyFatPrefs");if(e){const t=JSON.parse(e),s="female"===t.sex?"female":"male",a=Number(t.age);return{sex:s,age:Number.isFinite(a)&&a>0?a:0}}}catch{}return{sex:"male",age:30}}),[K,C]=n.useState({});n.useEffect(()=>{(async()=>{const e=[...await a.getAll("measurements")].sort((e,t)=>t.dateISO.localeCompare(e.dateISO));N(e);const t=(new Date).toISOString().slice(0,10),s=e.find(e=>e.dateISO.slice(0,10)===t);s?b(s):e.length&&b(t=>{var s;return{...t,heightCm:"number"!=typeof t.heightCm||Number.isNaN(t.heightCm)?null==(s=e[0])?void 0:s.heightCm:t.heightCm}})})()},[]),n.useEffect(()=>{try{window.localStorage.setItem("bodyFatPrefs",JSON.stringify(F))}catch{}},[F]);const S=n.useMemo(()=>{const e={};return p.forEach(({key:t})=>{const s=u[t];"number"!=typeof s||Number.isNaN(s)||(e[t]=s)}),e},[u]),L=n.useMemo(()=>{const e=Object.values(S).filter(e=>"number"==typeof e&&!Number.isNaN(e)),t=e.reduce((e,t)=>e+t,0);return{count:e.length,sum:t}},[S]),I=n.useMemo(()=>v({sex:F.sex,age:F.age,calipers:S,weightKg:u.weightKg}),[F.sex,F.age,S,u.weightKg]),D=n.useMemo(()=>{const e="number"!=typeof u.heightCm||Number.isNaN(u.heightCm)?void 0:u.heightCm;if(!e||e<=0)return{ok:!1,reason:"height"};const t=Number(e.toFixed(1)),s=t/100;if(!s||Number.isNaN(s)||s<=0)return{ok:!1,reason:"height"};let a,l,i;if("number"==typeof u.leanMassKg&&u.leanMassKg>0?(a=u.leanMassKg,l="recorded"):"number"==typeof u.weightKg&&u.weightKg>0&&"number"==typeof u.bodyFatPct?(a=u.weightKg*(1-u.bodyFatPct/100),l="bodyFatMeasurement",i=u.bodyFatPct):I.ok&&"number"==typeof I.leanMassKg?(a=I.leanMassKg,l="bodyFatEstimate",i=I.bodyFatPct):"number"==typeof u.weightKg&&u.weightKg>0&&I.ok&&(a=u.weightKg*(1-I.bodyFatPct/100),l="bodyFatEstimate",i=I.bodyFatPct),!a||Number.isNaN(a)||a<=0)return{ok:!1,reason:"leanMass"};const n=Number(a.toFixed(2)),r=Number((n/(s*s)).toFixed(2));return{ok:!0,ffmi:r,ffmiAdjusted:Number((r+6*(1.8-s)).toFixed(2)),heightCm:t,heightM:Number(s.toFixed(3)),leanMassKg:n,source:l??"recorded",bodyFatPctUsed:"number"==typeof i?Number(i.toFixed(2)):void 0}},[I,u.bodyFatPct,u.heightCm,u.leanMassKg,u.weightKg]),E=async e=>{try{const t=/\.txt$/i.test(e.name);let s="";if(t)s=await e.text();else{if(!/\.pdf$/i.test(e.name))return void j({message:"Unsupported file. Upload .pdf or .txt"});{const t=await e.arrayBuffer();s=await async function(e){const[{getDocument:t,GlobalWorkerOptions:s},a]=await Promise.all([r(()=>import("./pdf-BhRN_wyh.js"),[],import.meta.url),r(()=>import("./pdf.worker.min-YPdVSmqk.js"),[],import.meta.url).then(e=>e.default)]);s.workerSrc=a;const l=t({data:e,useWorkerFetch:!1,disableFontFace:!0,verbosity:0}),i=await l.promise;try{const e=i.numPages,t=[];for(let s=1;s<=e;s++){const e=await i.getPage(s),a=(await e.getTextContent()).items;a.sort((e,t)=>t.transform[5]-e.transform[5]||e.transform[4]-t.transform[4]);const l=a.map(e=>e.str??"").join("\n");t.push(l)}return t.join("\n\n")}finally{await i.destroy()}}(t)}}const{measurement:a,found:l,warnings:i,scanDateISO:n}=function(e){const t=[],s=[],a={},l=e.replace(/\[[^\]]+\]/g,""),i=l.toUpperCase(),n=(e,t)=>{const s=t.exec(i.slice(e));if(!s)return;const a=s[1]??s[0],l=Number(a.replace(/[^0-9.\-]/g,""));return isNaN(l)?void 0:{v:l,at:e+(s.index??0)+a.length}},r={status:/(\d+(?:\.\d+)?)\s*\/\s*(?:OPTIMAL|BALANCED|HIGH|UNDER|OVER|LOW)/i,percentStatus:/(\d+(?:\.\d+)?)\s*%\s*\/\s*(?:OPTIMAL|BALANCED|HIGH|UNDER|OVER|LOW)/i,plain:/(?:^|\s)(\d+(?:\.\d+)?)(?!\s*%)(?!\s*K?CAL)/i,kcal:/(\d+(?:\.\d+)?)\s*K?CAL\b/i,cm:/(\d+(?:\.\d+)?)\s*CM\b/i};{const e=i.match(/\b(\d{2})-(\d{2})-(\d{4})\s+(\d{2}):(\d{2})\b/);if(e){const t=Number(e[1]),s=Number(e[2]),l=Number(e[3]),i=new Date(l,s-1,t,12,0,0);a.__SCAN_DATE_ISO__=i.toISOString()}}{const e=i.indexOf("WEIGHT");if(e>=0){const s=l.slice(e,e+120).match(/(\d+(?:\.\d+)?)\s*kg/i);s&&(a.weightKg=Number(s[1]),t.push("weightKg"))}}const d=(e,t,s={})=>{if(/BODY WEIGHT/i.test(e)&&null!=a.weightKg)return;const i=new RegExp(e.replace(/[-/]/g,"[-/]")+"\\s*:?\\s*(\\d+(?:\\.\\d+)?)"+(s.percent?"\\s*%?":"")+(s.unit?`\\s*${s.unit}`:""),"i"),n=l.match(i);if(n){const e=Number(n[1]);isNaN(e)||t(e)}};d("Body Weight",e=>{null==a.weightKg&&(a.weightKg=e,t.push("weightKg"))},{unit:"kg"}),d("Body Fat %",e=>{null==a.bodyFatPct&&(a.bodyFatPct=e,t.push("bodyFatPct"))},{percent:!0}),d("Fat Mass",e=>{null==a.fatMassKg&&(a.fatMassKg=e,t.push("fatMassKg"))},{unit:"kg"}),d("Lean Mass",e=>{null==a.leanMassKg&&(a.leanMassKg=e,t.push("leanMassKg"))},{unit:"kg"}),d("Skeletal Muscle Mass",e=>{null==a.skeletalMuscleMassKg&&(a.skeletalMuscleMassKg=e,t.push("skeletalMuscleMassKg"))},{unit:"kg"}),d("Visceral Fat Rating",e=>{null==a.visceralFatRating&&(a.visceralFatRating=e,t.push("visceralFatRating"))}),d("BMR",e=>{null==a.bmrKcal&&(a.bmrKcal=e,t.push("bmrKcal"))},{unit:"kcal"}),d("Trunk Lean",e=>{null==a.trunkLeanKg&&(a.trunkLeanKg=e,t.push("trunkLeanKg"))}),d("Left Arm Lean",e=>{null==a.leftArmLeanKg&&(a.leftArmLeanKg=e,t.push("leftArmLeanKg"))}),d("Right Arm Lean",e=>{null==a.rightArmLeanKg&&(a.rightArmLeanKg=e,t.push("rightArmLeanKg"))}),d("Left Leg Lean",e=>{null==a.leftLegLeanKg&&(a.leftLegLeanKg=e,t.push("leftLegLeanKg"))}),d("Right Leg Lean",e=>{null==a.rightLegLeanKg&&(a.rightLegLeanKg=e,t.push("rightLegLeanKg"))});const o=(e,t,s)=>{const a=e.map(e=>i.indexOf(e));if(a.some(e=>e<0))return;let l=Math.max(...a);const d=t.map(e=>r[e]);for(let i=0;i<d.length;i++){const e=n(l,d[i]);if(!e)return;s[i](e.v),l=e.at}};o(["LEAN BODY MASS","BODY FAT MASS","VISCERAL FAT LEVEL"],["status","status","status"],[e=>{a.leanMassKg=e,t.push("leanMassKg")},e=>{a.fatMassKg=e,t.push("fatMassKg")},e=>{a.visceralFatRating=e,t.push("visceralFatRating")}]),o(["SKELETAL MUSCLE MASS","SUBCUTANEOUS FAT MASS","INTRACELLULAR FLUID"],["status","plain","plain"],[e=>{a.skeletalMuscleMassKg=e,t.push("skeletalMuscleMassKg")},e=>{a.subcutaneousFatMassKg=e,t.push("subcutaneousFatMassKg")},e=>{}]),o(["PROTEIN","VISCERAL FAT MASS","EXTRACELLULAR FLUID"],["status","plain","plain"],[e=>{a.proteinKg=e,t.push("proteinKg")},e=>{a.visceralFatMassKg=e,t.push("visceralFatMassKg")},e=>{}]),o(["MINERAL","VISCERAL FAT AREA","BMR"],["status","status","kcal"],[e=>{a.mineralKg=e,t.push("mineralKg")},e=>{a.visceralFatAreaCm2=e,t.push("visceralFatAreaCm2")},e=>{a.bmrKcal=e,t.push("bmrKcal")}]),o(["TOTAL BODY WATER","TOTAL BODY FAT PERCENTAGE","TEE"],["status","percentStatus","kcal"],[e=>{a.totalBodyWaterKg=e,t.push("totalBodyWaterKg")},e=>{a.bodyFatPct=e,t.push("bodyFatPct")},e=>{}]);{const e=i.indexOf("ABDOMINAL CIRCUMFERENCE");if(e>=0){const s=l.slice(e,e+220),i=Array.from(s.matchAll(/(\d+(?:\.\d+)?)\s*cm/gi)).map(e=>Number(e[1])).filter(e=>!isNaN(e));i.length&&(a.waist=i[i.length-1],t.push("waist"))}}{const e=i.indexOf("WAIST TO HIP RATIO");if(e>=0){const s=l.slice(e,e+220),i=Array.from(s.matchAll(/(\d+(?:\.\d+)?)\s*\/\s*(?:Optimal|Balanced|High|Under|Over|Low)/gi)).map(e=>Number(e[1])).filter(e=>!isNaN(e)),n=i.find(e=>e<=2)??i[0];null!=n&&(a.waistToHipRatio=n,t.push("waistToHipRatio"))}}const c=(e,s,n,r="first")=>{const d=i.indexOf(e);if(d<0)return;const o=["LEFT ARM","RIGHT ARM","TORSO","TRUNK","LEFT LEG","RIGHT LEG","ABDOMINAL CIRCUMFERENCE","SEGMENTAL ANALYSIS"];let c=l.length;for(const t of o){const e=i.indexOf(t,d+1);e>d&&e<c&&(c=e)}const m=l.slice(d,c).toUpperCase(),x=Array.from(m.matchAll(/LEAN\s*MASS[\s\S]{0,80}?(\d+(?:\.\d+)?)\s*\//g)).map(e=>Number(e[1])).filter(e=>!isNaN(e)),u=Array.from(m.matchAll(/FAT\s*MASS[\s\S]{0,80}?(\d+(?:\.\d+)?)\s*\//g)).map(e=>Number(e[1])).filter(e=>!isNaN(e)),g="last"===r?x[x.length-1]:x[0],h="last"===r?u[u.length-1]:u[0];null!=g&&(a[s]=g,t.push(s)),null!=h&&(a[n]=h,t.push(n))};c("LEFT ARM","leftArmLeanKg","leftArmFatKg","first"),c("RIGHT ARM","rightArmLeanKg","rightArmFatKg","last"),c("TORSO","trunkLeanKg","trunkFatKg"),c("TRUNK","trunkLeanKg","trunkFatKg"),c("LEFT LEG","leftLegLeanKg","leftLegFatKg","first"),c("RIGHT LEG","rightLegLeanKg","rightLegFatKg","last"),null!=a.weightKg&&null!=a.bodyFatPct&&(null==a.fatMassKg&&(a.fatMassKg=+(a.weightKg*(a.bodyFatPct/100)).toFixed(2)),null==a.leanMassKg&&(a.leanMassKg=+(a.weightKg-(a.fatMassKg||0)).toFixed(2))),0===t.length&&s.push("No recognizable Evolt 360 fields found");const m=a.__SCAN_DATE_ISO__;return m&&delete a.__SCAN_DATE_ISO__,{measurement:a,found:t,warnings:s,scanDateISO:m}}(s||"");if(!l.length)return void j({message:i[0]||"No recognizable Evolt fields found."});M({parsed:a,found:l,warnings:i,fileName:e.name,scanDateISO:n})}catch(t){j({message:"Import failed"})}},O=async(e,t)=>{const s=y.map(s=>s.id===e?{...s,...t}:s);N(s);const l=s.find(t=>t.id===e);await a.put("measurements",l)},[T,P]=n.useState(["weightKg","waist"]),[R,U]=n.useState(!1);n.useEffect(()=>{(async()=>{var e;const t=await l();U(!!(null==(e=t.ui)?void 0:e.smoothingDefault))})()},[]);const B=e=>y.filter(t=>null!=t[e]).map(t=>({date:t.dateISO.slice(5),value:Number(t[e]),ts:new Date(t.dateISO).getTime()})),W=B("weightKg"),_=n.useMemo(()=>{const e=[];for(let t=0;t<W.length;t++){const s=W.slice(Math.max(0,t-6),t+1),a=s.reduce((e,t)=>e+(t.value||0),0)/s.length;e.push({...W[t],avg:a})}return e},[W]),H=n.useMemo(()=>{if(W.length<2)return[];const e=W.map(e=>e.ts),t=W.map(e=>e.value),s=e.length,a=e.reduce((e,t)=>e+t,0)/s,l=t.reduce((e,t)=>e+t,0)/s;let i=0,n=0;for(let o=0;o<s;o++)i+=(e[o]-a)*(t[o]-l),n+=(e[o]-a)**2;const r=0===n?0:i/n,d=l-r*a;return W.map(e=>({date:e.date,value:r*e.ts+d}))},[W]),[$,G]=n.useState(null);n.useEffect(()=>{d().then(e=>G(e))},[]);const J=(e,t=3)=>e.length?e.map((s,a)=>{const l=e.slice(Math.max(0,a-(t-1)),a+1);return{...s,avg:l.reduce((e,t)=>e+(t.value||0),0)/l.length}}):[],V=n.useMemo(()=>{const e={};return T.forEach(t=>{const s=B(t);e[t]={raw:s,avg:J(s)}}),e},[T,y]),z=(e,t)=>{var s;const a=(null==(s=V[e])?void 0:s[R?"avg":"raw"])||W,l=a.findIndex(e=>e.date===t);if(l>0){const e=a[l-1];return(null==e?void 0:e.avg)??(null==e?void 0:e.value)}},Z=(e,t)=>{b(s=>{const a=s[e],l="number"==typeof a?a:0,i=Math.max(0,Number((l+t).toFixed(1)));return{...s,[e]:i}})},Y=D.ok?D.leanMassKg:"number"==typeof u.leanMassKg&&u.leanMassKg>0?Number(u.leanMassKg.toFixed(2)):I.ok&&"number"==typeof I.leanMassKg?Number(I.leanMassKg.toFixed(2)):"number"==typeof u.weightKg&&"number"==typeof u.bodyFatPct&&u.weightKg>0?Number((u.weightKg*(1-u.bodyFatPct/100)).toFixed(2)):void 0,X=D.ok?"recorded"===D.source?"Recorded lean mass":"bodyFatMeasurement"===D.source?"Weight × recorded body fat":"Weight × current body-fat estimate":"number"==typeof u.leanMassKg&&u.leanMassKg>0?"Recorded lean mass":"number"==typeof u.weightKg&&"number"==typeof u.bodyFatPct?"Weight × recorded body fat":I.ok&&"number"==typeof I.leanMassKg?"Body-fat estimate":null;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Measurements"}),e.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-soft space-y-3 fade-in",children:[e.jsx("input",{ref:w,type:"file",accept:".pdf,.txt",className:"hidden",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];s&&E(s),e.currentTarget.value=""}}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:["weightKg","heightCm","neck","chest","waist","hips","thigh","calf","upperArm","forearm"].map(t=>{const s=h(t),a=g[t]||"";return e.jsxs("label",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-300",children:[e.jsx("span",{children:s}),a&&e.jsx("span",{className:"text-[10px] uppercase tracking-[0.24em] text-slate-500",children:a})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"bg-slate-700 rounded px-3 py-2",onClick:()=>b(e=>({...e,[t]:Math.max(0,Number(e[t]||0)-.5)})),children:"-"}),e.jsx("input",{inputMode:"decimal",className:"w-full input-number-enhanced",value:u[t]??"",onKeyDown:e=>{"ArrowUp"===e.key?(e.preventDefault(),b(e=>({...e,[t]:Number(e[t]||0)+.5}))):"ArrowDown"===e.key&&(e.preventDefault(),b(e=>({...e,[t]:Math.max(0,Number(e[t]||0)-.5)})))},onChange:e=>{const s=e.target.value;/^\d*(?:\.\d*)?$/.test(s)&&b({...u,[t]:""===s?void 0:Number(s)})},placeholder:a}),e.jsx("button",{className:"bg-slate-700 rounded px-3 py-2",onClick:()=>b(e=>({...e,[t]:Number(e[t]||0)+.5})),children:"+"})]}),x[t]&&e.jsx("p",{className:"text-xs text-gray-400",children:x[t]})]},t)})}),e.jsxs("div",{className:"pt-3 border-t border-white/5 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-end justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-100",children:"Skinfold calipers"}),e.jsx("p",{className:"text-xs text-slate-400/80",children:"Enter skinfold thickness in millimetres to enable the body-fat calculator."})]}),e.jsx("div",{className:"text-[11px] text-slate-400/80 whitespace-nowrap",children:L.count>0?e.jsxs("span",{children:[L.count," site",1===L.count?"":"s",L.sum>0?` • Σ ${L.sum.toFixed(1)} mm`:""]}):e.jsx("span",{children:"No calipers logged yet"})})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:p.map(t=>{const s=u[t.key];return e.jsxs("label",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-200",children:[e.jsx("span",{children:t.label}),e.jsx("span",{className:"text-[10px] uppercase tracking-[0.24em] text-slate-500",children:"mm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"bg-slate-700 rounded px-2.5 py-1.5 text-sm",onClick:()=>Z(t.key,-.5),children:"-"}),e.jsx("input",{inputMode:"decimal",className:"w-full input-number-enhanced",value:s??"",onKeyDown:e=>{"ArrowUp"===e.key?(e.preventDefault(),Z(t.key,.5)):"ArrowDown"===e.key&&(e.preventDefault(),Z(t.key,-.5))},onChange:e=>{const s=e.target.value;if(!/^\d*(?:\.\d*)?$/.test(s))return;const a=""===s?void 0:Number(s);((e,t)=>{b(s=>({...s,[e]:t}))})(t.key,a)},placeholder:"mm"}),e.jsx("button",{type:"button",className:"bg-slate-700 rounded px-2.5 py-1.5 text-sm",onClick:()=>Z(t.key,.5),children:"+"})]}),e.jsx("p",{className:"text-xs text-gray-500 leading-snug",children:t.description})]},t.key)})}),e.jsxs("details",{className:"group rounded-2xl border border-white/10 bg-slate-900/40 px-4 py-3 text-sm text-slate-200",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-semibold uppercase tracking-[0.28em] text-white/60 group-open:text-white",children:"Caliper measuring guide"}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsx("ul",{className:"list-disc space-y-1 pl-4 text-xs text-slate-300/90",children:f.map(t=>e.jsx("li",{children:t},t))}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:p.map(t=>e.jsxs("div",{className:"rounded-xl border border-white/10 bg-slate-950/50 px-3 py-2",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-[0.18em] text-emerald-200",children:t.label}),e.jsx("p",{className:"mt-1 text-[11px] leading-5 text-slate-300/90",children:t.description})]},t.key))})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"w-full sm:w-auto bg-brand-600 hover:bg-brand-700 px-3 py-3 rounded-xl",onClick:async()=>{var e;await a.put("measurements",u);const s=[...await a.getAll("measurements")].sort((e,t)=>t.dateISO.localeCompare(e.dateISO));N(s);const l=(new Date).toISOString().slice(0,10),i=s.find(e=>e.dateISO.slice(0,10)===l);b(i||{id:t(),dateISO:(new Date).toISOString(),heightCm:"number"!=typeof u.heightCm||Number.isNaN(u.heightCm)?null==(e=s[0])?void 0:e.heightCm:u.heightCm})},children:"Save"}),e.jsx("button",{className:"w-full sm:w-auto bg-indigo-700 hover:bg-indigo-600 px-3 py-3 rounded-xl",onClick:()=>{var e;return null==(e=w.current)?void 0:e.click()},title:"Import Evolt 360 PDF or exported .txt",children:"Import Evolt 360"}),e.jsx("button",{className:"w-full sm:w-auto bg-slate-700 hover:bg-slate-600 px-3 py-3 rounded-xl",onClick:()=>b({id:t(),dateISO:(new Date).toISOString(),heightCm:"number"!=typeof u.heightCm||Number.isNaN(u.heightCm)?void 0:u.heightCm}),children:"Add another"}),e.jsx(o,{})]})]}),e.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-soft space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Body fat estimator"}),e.jsx("p",{className:"text-sm text-slate-300/80",children:"Jackson & Pollock formulas using your recorded skinfold sites."})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Current entry:"," ","number"==typeof u.bodyFatPct?`${u.bodyFatPct.toFixed(1)}%`:"—"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("label",{className:"space-y-1 text-sm text-slate-200",children:[e.jsx("span",{className:"block text-xs uppercase tracking-[0.28em] text-slate-400",children:"Sex"}),e.jsxs("select",{className:"input-number-enhanced bg-slate-900/70",value:F.sex,onChange:e=>A(t=>({...t,sex:"female"===e.target.value?"female":"male"})),children:[e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]})]}),e.jsxs("label",{className:"space-y-1 text-sm text-slate-200",children:[e.jsx("span",{className:"block text-xs uppercase tracking-[0.28em] text-slate-400",children:"Age"}),e.jsx("input",{className:"input-number-enhanced",inputMode:"numeric",value:F.age?String(F.age):"",onChange:e=>{const t=e.target.value,s=""===t?0:Number(t);(""===t||/^\d+$/.test(t)&&!Number.isNaN(s))&&A(e=>({...e,age:s}))},placeholder:"years"})]}),e.jsxs("div",{className:"space-y-1 text-sm text-slate-200",children:[e.jsx("span",{className:"block text-xs uppercase tracking-[0.28em] text-slate-400",children:"Caliper summary"}),e.jsx("div",{className:"rounded-xl border border-white/10 bg-slate-900/60 px-3 py-2 text-xs text-slate-300",children:L.count>0?e.jsxs("div",{children:[e.jsxs("div",{children:[L.count," site",1===L.count?"":"s"," logged"]}),e.jsxs("div",{className:"text-[11px] text-emerald-300",children:["Σ ",L.sum.toFixed(1)," mm"]})]}):e.jsx("div",{children:"No skinfold data yet."})})]})]}),I.ok?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-xl border border-emerald-400/30 bg-emerald-500/10 px-3 py-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.24em] text-emerald-200",children:"Estimated body fat"}),e.jsxs("div",{className:"text-2xl font-semibold text-emerald-100",children:[I.bodyFatPct.toFixed(2),"%"]}),e.jsx("div",{className:"text-[11px] text-emerald-200/70",children:I.method})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-slate-900/60 px-3 py-2 space-y-1 text-xs text-slate-300",children:[e.jsxs("div",{children:["Sum of sites: ",I.sum.toFixed(1)," mm"]}),e.jsxs("div",{children:["Density: ",I.density.toFixed(4)," g/cm³"]}),e.jsxs("div",{children:["Used sites:"," ",I.usedSites.map(e=>{var t;return(null==(t=p.find(t=>t.key===e))?void 0:t.label)||e}).join(", ")]})]}),"number"==typeof I.leanMassKg&&e.jsxs("div",{className:"rounded-xl border border-white/10 bg-slate-900/60 px-3 py-2 text-xs text-slate-300",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.24em] text-slate-400",children:"Lean mass"}),e.jsxs("div",{className:"text-lg font-semibold text-slate-100",children:[I.leanMassKg.toFixed(2)," kg"]})]}),"number"==typeof I.fatMassKg&&e.jsxs("div",{className:"rounded-xl border border-white/10 bg-slate-900/60 px-3 py-2 text-xs text-slate-300",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.24em] text-slate-400",children:"Fat mass"}),e.jsxs("div",{className:"text-lg font-semibold text-slate-100",children:[I.fatMassKg.toFixed(2)," kg"]})]})]}):e.jsx("div",{className:"rounded-xl border border-amber-400/30 bg-amber-500/10 px-3 py-2 text-xs text-amber-200",children:"age"===I.reason?"Enter your age to calculate body fat percentage.":(null==(c=I.missingSites)?void 0:c.length)?`Add measurements for: ${I.missingSites.map(e=>{var t;return(null==(t=p.find(t=>t.key===e))?void 0:t.label)||e}).join(", ")}`:"Add a few skinfold measurements to unlock the calculator."}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{type:"button",className:"bg-brand-600 hover:bg-brand-700 px-3 py-2 rounded-lg text-sm font-medium text-white disabled:opacity-50 disabled:cursor-not-allowed",disabled:!I.ok,onClick:()=>{I.ok&&(b(e=>({...e,bodyFatPct:Number(I.bodyFatPct.toFixed(2)),leanMassKg:"number"==typeof I.leanMassKg?Number(I.leanMassKg.toFixed(2)):e.leanMassKg,fatMassKg:"number"==typeof I.fatMassKg?Number(I.fatMassKg.toFixed(2)):e.fatMassKg,bodyDensity:Number(I.density.toFixed(4))})),j({message:"Body fat estimate applied to current measurement."}))},children:"Apply estimate to measurement"}),e.jsx("span",{className:"text-[11px] text-slate-400",children:"Save to persist the updated entry."})]})]}),e.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-soft space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"FFMI calculator"}),e.jsx("p",{className:"text-sm text-slate-300/80",children:"Uses height and lean mass to estimate your fat-free mass index."})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Current entry:"," ","number"==typeof u.ffmi?`${u.ffmi.toFixed(2)}${"number"==typeof u.ffmiAdjusted?` (${u.ffmiAdjusted.toFixed(2)} adj)`:""}`:"—"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"rounded-xl border border-white/10 bg-slate-900/60 px-3 py-2 text-xs text-slate-300",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.24em] text-slate-400",children:"Height"}),e.jsx("div",{className:"text-lg font-semibold text-slate-100",children:"number"==typeof u.heightCm?`${u.heightCm.toFixed(1)} cm`:"—"}),"number"==typeof u.heightCm&&e.jsxs("div",{className:"text-[11px] text-slate-400/80",children:[(u.heightCm/100).toFixed(2)," m"]})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-slate-900/60 px-3 py-2 text-xs text-slate-300",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.24em] text-slate-400",children:"Lean mass"}),e.jsx("div",{className:"text-lg font-semibold text-slate-100",children:"number"==typeof Y?`${Y.toFixed(2)} kg`:"—"}),X&&e.jsx("div",{className:"text-[11px] text-slate-400/80",children:X})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-slate-900/60 px-3 py-2 text-xs text-slate-300",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.24em] text-slate-400",children:"Weight"}),e.jsx("div",{className:"text-lg font-semibold text-slate-100",children:"number"==typeof u.weightKg?`${u.weightKg.toFixed(2)} kg`:"—"}),"number"==typeof u.bodyFatPct&&e.jsxs("div",{className:"text-[11px] text-slate-400/80",children:["Body fat: ",u.bodyFatPct.toFixed(1),"%"]})]})]}),D.ok?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"rounded-xl border border-sky-400/30 bg-sky-500/10 px-3 py-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.24em] text-sky-200",children:"FFMI"}),e.jsx("div",{className:"text-2xl font-semibold text-sky-100",children:D.ffmi.toFixed(2)}),e.jsx("div",{className:"text-[11px] text-sky-200/70",children:"Lean mass ÷ height²"})]}),e.jsxs("div",{className:"rounded-xl border border-sky-400/30 bg-sky-500/10 px-3 py-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.24em] text-sky-200",children:"Adjusted FFMI"}),e.jsx("div",{className:"text-2xl font-semibold text-sky-100",children:D.ffmiAdjusted.toFixed(2)}),e.jsx("div",{className:"text-[11px] text-sky-200/70",children:"Normalized to 1.80 m"})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-slate-900/60 px-3 py-2 text-xs text-slate-300 space-y-1",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.24em] text-slate-400",children:"Inputs used"}),e.jsxs("div",{children:["Height: ",D.heightCm.toFixed(1)," cm"]}),e.jsxs("div",{children:["Lean mass: ",D.leanMassKg.toFixed(2)," kg"]}),"number"==typeof D.bodyFatPctUsed&&e.jsxs("div",{children:["Body fat ref: ",D.bodyFatPctUsed.toFixed(1),"%"]})]})]}):e.jsx("div",{className:"rounded-xl border border-amber-400/30 bg-amber-500/10 px-3 py-2 text-xs text-amber-200",children:"height"===D.reason?"Add your height measurement to calculate FFMI.":"Provide lean mass (or weight with body-fat data) to compute FFMI."}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{type:"button",className:"bg-sky-600 hover:bg-sky-700 px-3 py-2 rounded-lg text-sm font-medium text-white disabled:opacity-50 disabled:cursor-not-allowed",disabled:!D.ok,onClick:()=>{D.ok&&(b(e=>({...e,ffmi:D.ffmi,ffmiAdjusted:D.ffmiAdjusted,leanMassKg:D.leanMassKg})),j({message:"FFMI calculated and applied to the measurement."}))},children:"Apply FFMI to measurement"}),e.jsx("span",{className:"text-[11px] text-slate-400",children:"Save to persist the updated entry."})]})]}),e.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-soft space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[e.jsx("span",{className:"uppercase tracking-wide text-gray-400",children:"Overlays:"}),["weightKg","waist","chest","hips","upperArm","bodyFatPct","leanMassKg","fatMassKg","ffmi","ffmiAdjusted"].map(t=>e.jsx("button",{onClick:()=>(e=>{P(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(t),className:"px-2 py-1 rounded-lg border "+(T.includes(t)?"bg-emerald-600 border-emerald-500":"bg-white/5 border-white/10"),children:h(t)},t)),e.jsx("button",{onClick:async()=>{U(e=>{const t=!e;return(async()=>{const e=await l();await i({...e,ui:{...e.ui||{},smoothingDefault:t}})})(),t})},className:"px-2 py-1 rounded-lg border "+(R?"bg-indigo-600 border-indigo-500":"bg-white/5 border-white/10"),children:R?"Smoothing On":"Smoothing Off"}),e.jsx("span",{className:"ml-auto text-[10px] text-gray-500 hidden sm:inline",children:"Tooltip shows Δ vs prev day • Toggle smoothing for rolling avg (w=3)"})]}),e.jsxs("div",{className:"h-72",children:[!$&&e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-gray-500",children:"Loading…"}),$&&e.jsx($.ResponsiveContainer,{children:e.jsxs($.LineChart,{data:W.length?W:B(T[0]||"weightKg"),children:[e.jsx($.CartesianGrid,{strokeDasharray:"3 3",stroke:"#1f2937"}),e.jsx($.XAxis,{dataKey:"date",stroke:"#9ca3af",interval:Math.ceil((W.length||30)/12)}),e.jsx($.YAxis,{stroke:"#9ca3af"}),e.jsx($.Tooltip,{content:({active:t,payload:s,label:a})=>e.jsx(m,{active:t,payload:s,label:a,context:{previousPointLookup:z}})}),e.jsx($.Legend,{}),T.map((t,s)=>{const a=V[t],l=(null==a?void 0:a.raw)||B(t),i=["#3b82f6","#ef4444","#22c55e","#f59e0b","#a855f7"];return e.jsx($.Line,{type:"monotone",name:t,data:R?a.avg:l,dataKey:R?"avg":"value",stroke:i[s%i.length],dot:!1},t)}),T.includes("weightKg")&&e.jsxs(e.Fragment,{children:[e.jsx($.Line,{type:"monotone",name:"7d avg",data:_,dataKey:"avg",stroke:"#ffffff",strokeDasharray:"4 4",dot:!1}),H.length>0&&e.jsx($.Line,{type:"monotone",name:"trend",data:H,dataKey:"value",stroke:"#22c55e",strokeDasharray:"2 6",dot:!1})]})]})})]})]}),k&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>M(null)}),e.jsxs("div",{className:"relative bg-slate-900 rounded-2xl shadow-xl w-[90vw] max-w-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Import preview"}),e.jsx("button",{className:"text-xs text-gray-400",onClick:()=>M(null),children:"Close"})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["File: ",k.fileName,k.scanDateISO?` • Scan date: ${k.scanDateISO.slice(0,10)}`:""]}),e.jsx("div",{className:"max-h-72 overflow-auto bg-slate-800/60 rounded-xl p-3",children:e.jsx("table",{className:"w-full text-sm",children:e.jsx("tbody",{children:Object.entries(k.parsed).map(([t,s])=>e.jsxs("tr",{className:"border-b border-white/5",children:[e.jsx("td",{className:"py-1 pr-2 text-gray-300 capitalize",children:t}),e.jsx("td",{className:"py-1 text-right",children:"number"==typeof s?s.toFixed(2):String(s)})]},t))})})}),!!k.warnings.length&&e.jsx("div",{className:"text-xs text-amber-400",children:k.warnings.join(" • ")}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{className:"bg-slate-700 hover:bg-slate-600 px-3 py-2 rounded-lg",onClick:()=>M(null),children:"Cancel"}),e.jsx("button",{className:"bg-brand-600 hover:bg-brand-700 px-3 py-2 rounded-lg",onClick:async()=>{if(!k)return;const{parsed:e,found:s,scanDateISO:l}=k,i=l||(new Date).toISOString(),n=i.slice(0,10),r=y.find(e=>e.dateISO.slice(0,10)===n),d={...r?{...r}:{id:t(),dateISO:i},...e};await a.put("measurements",d);const o=[...await a.getAll("measurements")].sort((e,t)=>t.dateISO.localeCompare(e.dateISO));N(o),b(d),M(null),j({message:`Imported Evolt: ${s.join(", ")}`})},children:"Confirm import"})]})]})]}),e.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-soft",children:[e.jsx("div",{className:"font-medium mb-2",children:"Entries"}),!y.length&&e.jsx("div",{className:"text-xs text-muted py-6 text-center",children:"No measurements yet. Track your first bodyweight to begin a trend."}),e.jsx("div",{className:"space-y-2",children:y.map(t=>{const s=p.map(e=>({site:e,value:t[e.key]})).filter(e=>"number"==typeof e.value&&!Number.isNaN(e.value)),i=s.reduce((e,t)=>e+t.value,0),n=!!K[t.id];return e.jsxs("div",{className:"bg-slate-800 rounded-xl px-3 py-3 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xs text-gray-400",children:t.dateISO.slice(0,10)}),e.jsxs("div",{className:"flex items-center gap-2",children:[null!=t.bodyFatPct&&e.jsxs("span",{className:"rounded-full bg-emerald-500/10 px-2 py-1 text-[11px] font-medium text-emerald-200",children:["Body fat: ",t.bodyFatPct.toFixed(1),"%"]}),null!=t.ffmi&&e.jsxs("span",{className:"rounded-full bg-sky-500/10 px-2 py-1 text-[11px] font-medium text-sky-200",children:["FFMI: ",t.ffmi.toFixed(2),null!=t.ffmiAdjusted?` (adj ${t.ffmiAdjusted.toFixed(2)})`:""]}),e.jsxs("button",{className:"text-xs bg-slate-700 hover:bg-slate-600 rounded px-3 py-2",onClick:()=>C(e=>({...e,[t.id]:!e[t.id]})),children:[n?"Hide calipers":"Calipers",s.length?` (${s.length})`:""]}),e.jsx("button",{className:"text-xs bg-red-600 hover:bg-red-500 rounded px-3 py-2",onClick:()=>(async e=>{if((await l()).confirmDestructive&&!window.confirm("Delete this measurement entry?"))return;const t=y;await a.delete("measurements",e),N(y.filter(t=>t.id!==e)),j({message:"Measurement deleted",actionLabel:"Undo",onAction:async()=>{for(const e of t)await a.put("measurements",e);N(t)}})})(t.id),children:"Delete"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-2",children:[e.jsxs("div",{className:"bg-slate-900/50 rounded-xl px-2 py-2",children:[e.jsx("div",{className:"text-[11px] text-gray-400 mb-1",children:"Weight"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"bg-slate-700 rounded px-3 py-2",onClick:()=>O(t.id,{weightKg:Math.max(0,(t.weightKg||0)-.5)}),children:"-"}),e.jsx("input",{className:"input-number-enhanced w-full",inputMode:"decimal",value:t.weightKg||"",onKeyDown:e=>{"ArrowUp"===e.key?(e.preventDefault(),O(t.id,{weightKg:(t.weightKg||0)+.5})):"ArrowDown"===e.key&&(e.preventDefault(),O(t.id,{weightKg:Math.max(0,(t.weightKg||0)-.5)}))},onChange:e=>{const s=e.target.value;/^\d*(?:\.\d*)?$/.test(s)&&O(t.id,{weightKg:""===s?void 0:Number(s)})},placeholder:"kg"}),e.jsx("button",{className:"bg-slate-700 rounded px-3 py-2",onClick:()=>O(t.id,{weightKg:(t.weightKg||0)+.5}),children:"+"})]})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-xl px-2 py-2",children:[e.jsx("div",{className:"text-[11px] text-gray-400 mb-1",children:"Height"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"bg-slate-700 rounded px-3 py-2",onClick:()=>O(t.id,{heightCm:Math.max(0,(t.heightCm||0)-.5)}),children:"-"}),e.jsx("input",{className:"input-number-enhanced w-full",inputMode:"decimal",value:t.heightCm||"",onKeyDown:e=>{"ArrowUp"===e.key?(e.preventDefault(),O(t.id,{heightCm:(t.heightCm||0)+.5})):"ArrowDown"===e.key&&(e.preventDefault(),O(t.id,{heightCm:Math.max(0,(t.heightCm||0)-.5)}))},onChange:e=>{const s=e.target.value;/^\d*(?:\.\d*)?$/.test(s)&&O(t.id,{heightCm:""===s?void 0:Number(s)})},placeholder:"cm"}),e.jsx("button",{className:"bg-slate-700 rounded px-3 py-2",onClick:()=>O(t.id,{heightCm:(t.heightCm||0)+.5}),children:"+"})]})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-xl px-2 py-2",children:[e.jsx("div",{className:"text-[11px] text-gray-400 mb-1",children:"Waist"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"bg-slate-700 rounded px-3 py-2",onClick:()=>O(t.id,{waist:Math.max(0,(t.waist||0)-.5)}),children:"-"}),e.jsx("input",{className:"input-number-enhanced w-full",inputMode:"decimal",value:t.waist||"",onKeyDown:e=>{"ArrowUp"===e.key?(e.preventDefault(),O(t.id,{waist:(t.waist||0)+.5})):"ArrowDown"===e.key&&(e.preventDefault(),O(t.id,{waist:Math.max(0,(t.waist||0)-.5)}))},onChange:e=>{const s=e.target.value;/^\d*(?:\.\d*)?$/.test(s)&&O(t.id,{waist:""===s?void 0:Number(s)})},placeholder:"waist"}),e.jsx("button",{className:"bg-slate-700 rounded px-3 py-2",onClick:()=>O(t.id,{waist:(t.waist||0)+.5}),children:"+"})]})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-xl px-2 py-2",children:[e.jsx("div",{className:"text-[11px] text-gray-400 mb-1",children:"Upper Arm"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"bg-slate-700 rounded px-3 py-2",onClick:()=>O(t.id,{upperArm:Math.max(0,(t.upperArm||0)-.5)}),children:"-"}),e.jsx("input",{className:"input-number-enhanced w-full",inputMode:"decimal",value:t.upperArm||"",onKeyDown:e=>{"ArrowUp"===e.key?(e.preventDefault(),O(t.id,{upperArm:(t.upperArm||0)+.5})):"ArrowDown"===e.key&&(e.preventDefault(),O(t.id,{upperArm:Math.max(0,(t.upperArm||0)-.5)}))},onChange:e=>{const s=e.target.value;/^\d*(?:\.\d*)?$/.test(s)&&O(t.id,{upperArm:""===s?void 0:Number(s)})},placeholder:"arm"}),e.jsx("button",{className:"bg-slate-700 rounded px-3 py-2",onClick:()=>O(t.id,{upperArm:(t.upperArm||0)+.5}),children:"+"})]})]})]}),s.length>0&&!n&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[11px] text-slate-400",children:[e.jsxs("span",{children:["Σ skinfolds: ",i.toFixed(1)," mm (",s.length," site",1===s.length?"":"s",")"]}),null!=t.bodyFatPct&&null!=t.weightKg&&e.jsxs("span",{children:["Lean mass ≈"," ",(t.weightKg*(1-t.bodyFatPct/100)).toFixed(2)," ","kg"]}),null!=t.ffmi&&e.jsxs("span",{children:["FFMI ",t.ffmi.toFixed(2),null!=t.ffmiAdjusted?` (adj ${t.ffmiAdjusted.toFixed(2)})`:""]})]}),n&&e.jsxs("div",{className:"rounded-xl border border-white/10 bg-slate-900/60 px-3 py-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-[11px] text-slate-300",children:[e.jsxs("span",{children:["Σ ",i.toFixed(1)," mm across"," ",s.length," site",1===s.length?"":"s"]}),e.jsx("span",{className:"text-slate-500",children:"Values in mm"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:p.map(s=>{const a=t[s.key];return e.jsxs("label",{className:"space-y-1 text-xs text-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between text-[11px] text-gray-300",children:[e.jsx("span",{children:s.label}),e.jsx("span",{className:"uppercase tracking-[0.24em] text-slate-500",children:"mm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"bg-slate-800 rounded px-2 py-1",onClick:()=>O(t.id,{[s.key]:Math.max(0,Number(((a??0)-.5).toFixed(1)))}),children:"-"}),e.jsx("input",{className:"input-number-enhanced w-full",inputMode:"decimal",value:a??"",onKeyDown:e=>{"ArrowUp"===e.key?(e.preventDefault(),O(t.id,{[s.key]:Number(((a??0)+.5).toFixed(1))})):"ArrowDown"===e.key&&(e.preventDefault(),O(t.id,{[s.key]:Math.max(0,Number(((a??0)-.5).toFixed(1)))}))},onChange:e=>{const a=e.target.value;if(!/^\d*(?:\.\d*)?$/.test(a))return;const l={[s.key]:""===a?void 0:Number(a)};O(t.id,l)},placeholder:"mm"}),e.jsx("button",{type:"button",className:"bg-slate-800 rounded px-2 py-1",onClick:()=>O(t.id,{[s.key]:Number(((a??0)+.5).toFixed(1))}),children:"+"})]})]},s.key)})})]})]},t.id)})})]})]})}export{j as default};
