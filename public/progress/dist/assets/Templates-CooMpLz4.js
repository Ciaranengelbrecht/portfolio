import{d as e,B as s,j as t,u as a}from"./index-CS486dXL.js";import{r as l}from"./vendor-DTtRowIX.js";import"./charts-Cu4NAUVk.js";function n(){const[n,c]=l.useState([]),[d,r]=l.useState([]),[o,x]=l.useState(""),[p,m]=l.useState(null),[u,h]=l.useState(""),[g,f]=l.useState(""),[v,b]=l.useState(!1),[j,N]=l.useState({}),y=e=>e.toLowerCase().trim().replace(/\s+/g," "),w=e=>{const s=y(e);return n.find(e=>y(e.name)===s)};l.useEffect(()=>{(async()=>{c(await e.getAll("exercises")),r(await e.getAll("templates")),s("exercises"),s("templates")})()},[]),l.useEffect(()=>{const s=s=>{var t;(null==(t=null==s?void 0:s.detail)?void 0:t.session)&&(async()=>{c(await e.getAll("exercises")),r(await e.getAll("templates"))})()};return window.addEventListener("sb-auth",s),()=>window.removeEventListener("sb-auth",s)},[]),l.useEffect(()=>{const s=s=>{var t;const a=null==(t=null==s?void 0:s.detail)?void 0:t.table;"exercises"===a&&e.getAll("exercises").then(c),"templates"===a&&e.getAll("templates").then(r)};return window.addEventListener("sb-change",s),()=>window.removeEventListener("sb-change",s)},[]);const C=e=>{var s,t;return{exerciseId:e.id,plannedSets:(null==(s=e.defaults)?void 0:s.sets)||3,repRange:(null==(t=e.defaults)?void 0:t.targetRepRange)||"8-12",progression:{scheme:"linear",incrementKg:2.5,addRepsFirst:!0}}},k=async(s,t,a)=>{const l=[...s.exerciseIds],[n]=l.splice(t,1);l.splice(a,0,n);const i={...s,exerciseIds:l};await e.put("templates",i),r(d.map(e=>e.id===s.id?i:e))},I=async(s,t)=>{if(s.exerciseIds.includes(t.id))return m(null),void h("");const a=C(t),l={...s,exerciseIds:[...s.exerciseIds,t.id],plan:[...s.plan||[],a]};await e.put("templates",l),r(d.map(e=>e.id===s.id?l:e)),m(null),h("")},R=async s=>{const t={...s,isOptional:!s.isOptional};await e.put("exercises",t),c(n.map(e=>e.id===s.id?t:e))},S=async s=>{const t=await e.get("settings","app");if((null==t?void 0:t.confirmDestructive)&&!confirm(`Delete exercise "${s.name}"? It will be removed from all templates.`))return;await e.delete("exercises",s.id);const a=n.filter(e=>e.id!==s.id);c(a);const l=[],i=d.map(e=>{if(!e.exerciseIds.includes(s.id))return e;const t={...e,exerciseIds:e.exerciseIds.filter(e=>e!==s.id)};return l.push(t),t});r(i),await Promise.all(l.map(s=>e.put("templates",s)))},A=(e,s)=>{if(e=e.toLowerCase(),(s=s.toLowerCase()).includes(e))return 4*e.length;let t=0,a=0;for(let l=0;l<s.length&&t<e.length;l++)s[l]===e[t]&&(a+=2,t++);return t===e.length?a:0},E=l.useMemo(()=>{const e=g.trim(),s=n;if(!e)return v?s:[];const t=e.split(/\s+/).slice(0,6),a=[];e:for(const l of s){const e=l.name.toLowerCase(),s=(l.tags||[]).map(e=>e.toLowerCase());let n=0;for(const a of t){const t=a.toLowerCase();if(t.startsWith("tag:")){const e=t.slice(4);if(!s.some(s=>s===e))continue e;n+=30;continue}if(t.startsWith("mg:")){const e=t.slice(3);if(!s.includes("mg:"+e))continue e;n+=25;continue}if(t.startsWith("sec:")){const e=t.slice(4);if(!s.includes("sec:"+e))continue e;n+=15;continue}const l=s.some(e=>e.includes(t)),i=A(t,e);if(0===i&&!l)continue e;n+=i+(l?10:0)}n>0&&a.push({e:l,score:n})}return a.sort((e,s)=>s.score-e.score||e.e.name.localeCompare(s.e.name)).slice(0,250).map(e=>e.e)},[g,n,v]);return t.jsxs("div",{className:"space-y-4",children:[t.jsx("h2",{className:"text-xl font-semibold",children:"Templates"}),t.jsxs("div",{className:"bg-card rounded-2xl p-3",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{className:"bg-slate-800 rounded-xl px-3 py-3 flex-1",placeholder:"New template name",value:o,onChange:e=>x(e.target.value)}),t.jsx("button",{className:"bg-brand-600 hover:bg-brand-700 px-3 py-3 rounded-xl",onClick:async()=>{const s=(o||`Template ${d.length+1}`).trim().replace(/\s+/g," ").slice(0,60)||`Template ${d.length+1}`,t=n.slice(0,4),l={id:a(),name:s,exerciseIds:t.map(e=>e.id),plan:t.map(C)};await e.put("templates",l),r([l,...d]),x("")},children:"Add"})]}),d.length>0&&t.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 text-[11px]",children:[t.jsx("button",{className:"bg-slate-800 hover:bg-slate-700 rounded-xl px-3 py-2",onClick:()=>{const e={};for(const s of d)e[s.id]=!0;N(e)},children:"Collapse All"}),t.jsx("button",{className:"bg-slate-800 hover:bg-slate-700 rounded-xl px-3 py-2",onClick:()=>N({}),disabled:0===Object.keys(j).length,children:"Expand All"})]})]}),t.jsx("div",{className:"space-y-3",children:d.map(s=>t.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-soft",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[t.jsx("button",{className:"text-xs bg-slate-800 rounded-md px-2 py-1 shrink-0",onClick:()=>N(e=>({...e,[s.id]:!e[s.id]})),title:j[s.id]?"Expand template":"Collapse template",children:j[s.id]?"▶":"▼"}),t.jsx("input",{className:"bg-transparent font-medium flex-1 min-w-0",value:s.name,onChange:t=>{const a={...s,name:t.target.value};r(d.map(e=>e.id===s.id?a:e)),e.put("templates",a)}})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsxs("div",{className:"text-[11px] opacity-70",children:[s.exerciseIds.length," ex"]}),t.jsx("button",{className:"text-xs sm:text-sm bg-slate-800 rounded-xl px-3 py-2",onClick:()=>(async s=>{const t={id:a(),name:`${s.name} (copy)`,exerciseIds:[...s.exerciseIds],plan:s.plan?s.plan.map(e=>({...e})):void 0};await e.put("templates",t),r([t,...d])})(s),children:"Duplicate"}),t.jsx("button",{className:"text-xs sm:text-sm bg-slate-800 rounded-xl px-3 py-2",onClick:()=>(async s=>{const t={...s,hidden:!s.hidden};await e.put("templates",t),r(d.map(e=>e.id===s.id?t:e))})(s),children:s.hidden?"Show":"Hide"}),t.jsx("button",{className:"text-xs sm:text-sm bg-red-600 rounded-xl px-3 py-2",onClick:()=>(async s=>{const t=await e.get("settings","app");(null==t?void 0:t.confirmDestructive)&&!confirm(`Delete template "${s.name}"? This cannot be undone.`)||(await e.delete("templates",s.id),r(d.filter(e=>e.id!==s.id)))})(s),children:"Delete"})]})]}),j[s.id]?t.jsx("div",{className:"mt-2 text-[11px] text-gray-400 line-clamp-2",children:s.exerciseIds.map(e=>{var s;return(null==(s=n.find(s=>s.id===e))?void 0:s.name)||"Unknown"}).filter(Boolean).join(", ")}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mt-2 text-sm text-gray-300",children:["Exercises: ",s.exerciseIds.length]}),t.jsx("div",{className:"mt-3 space-y-2",children:s.exerciseIds.map((a,l)=>{var i,c,o;const x=n.find(e=>e.id===a),p=null==(i=s.plan)?void 0:i.find(e=>e.exerciseId===a);return t.jsxs("div",{className:"bg-slate-800 rounded-xl px-3 py-3 space-y-2",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[t.jsx("div",{className:"w-full sm:flex-1 text-sm sm:text-base break-words",children:(null==x?void 0:x.name)||"Unknown"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("button",{className:"text-[11px] sm:text-xs bg-slate-700 rounded-xl px-2 py-1 sm:px-3 sm:py-2 disabled:opacity-50",disabled:0===l,onClick:()=>k(s,l,l-1),children:"Up"}),t.jsx("button",{className:"text-[11px] sm:text-xs bg-slate-700 rounded-xl px-2 py-1 sm:px-3 sm:py-2 disabled:opacity-50",disabled:l===s.exerciseIds.length-1,onClick:()=>k(s,l,l+1),children:"Down"}),t.jsx("button",{className:"text-[11px] sm:text-xs bg-slate-700 rounded-xl px-2 py-1 sm:px-3 sm:py-2",onClick:()=>x&&R(x),children:(null==x?void 0:x.isOptional)?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"hidden sm:inline",children:"Optional ✓"}),t.jsx("span",{className:"inline sm:hidden",children:"Opt ✓"})]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"hidden sm:inline",children:"Optional"}),t.jsx("span",{className:"inline sm:hidden",children:"Opt"})]})}),t.jsx("button",{className:"text-[11px] sm:text-xs bg-red-600 rounded-xl px-2 py-1 sm:px-3 sm:py-2",onClick:()=>(async(s,t)=>{var a;const l={...s,exerciseIds:s.exerciseIds.filter(e=>e!==t),plan:null==(a=s.plan)?void 0:a.filter(e=>e.exerciseId!==t)};await e.put("templates",l),r(d.map(e=>e.id===s.id?l:e))})(s,a),children:"Remove"}),x&&t.jsxs("button",{className:"text-[11px] sm:text-xs bg-red-700 rounded-xl px-2 py-1 sm:px-3 sm:py-2",onClick:()=>S(x),children:[t.jsx("span",{className:"hidden sm:inline",children:"Delete exercise"}),t.jsx("span",{className:"inline sm:hidden",children:"Delete"})]})]})]}),t.jsxs("div",{className:"grid sm:grid-cols-5 gap-2 text-[11px] sm:text-xs bg-slate-900/40 rounded-lg p-2",children:[t.jsxs("label",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"opacity-70",children:"Sets"}),t.jsx("input",{type:"number",min:1,max:10,value:(null==p?void 0:p.plannedSets)??(null==x?void 0:x.defaults.sets)??3,onChange:t=>{const l=Math.min(10,Math.max(1,Number(t.target.value)||1)),n=[...s.plan||[]],i=n.findIndex(e=>e.exerciseId===a);i>=0?n[i]={...n[i],plannedSets:l}:n.push({...C(x),plannedSets:l});const c={...s,plan:n};r(d.map(e=>e.id===s.id?c:e)),e.put("templates",c)},className:"bg-slate-700 rounded px-2 py-1"})]}),t.jsxs("label",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"opacity-70",children:"Rep Range"}),t.jsx("input",{type:"text",value:(null==p?void 0:p.repRange)??(null==x?void 0:x.defaults.targetRepRange)??"8-12",onChange:t=>{const l=t.target.value.replace(/[^0-9\-–]/g,"").slice(0,9),n=[...s.plan||[]],i=n.findIndex(e=>e.exerciseId===a);i>=0?n[i]={...n[i],repRange:l}:n.push({...C(x),repRange:l});const c={...s,plan:n};r(d.map(e=>e.id===s.id?c:e)),e.put("templates",c)},placeholder:"8-12",className:"bg-slate-700 rounded px-2 py-1"})]}),t.jsxs("label",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"opacity-70",children:"Increment (kg)"}),t.jsx("input",{type:"number",step:.5,value:(null==(c=null==p?void 0:p.progression)?void 0:c.incrementKg)??2.5,onChange:t=>{const l=Number(t.target.value)||0,n=[...s.plan||[]],i=n.findIndex(e=>e.exerciseId===a);i>=0?n[i]={...n[i],progression:{...n[i].progression||{scheme:"linear"},incrementKg:l}}:n.push({...C(x),progression:{scheme:"linear",incrementKg:l,addRepsFirst:!0}});const c={...s,plan:n};r(d.map(e=>e.id===s.id?c:e)),e.put("templates",c)},className:"bg-slate-700 rounded px-2 py-1"})]}),t.jsxs("label",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"opacity-70",children:"Reps First?"}),t.jsxs("select",{value:String((null==(o=null==p?void 0:p.progression)?void 0:o.addRepsFirst)??!0),onChange:t=>{const l="true"===t.target.value,n=[...s.plan||[]],i=n.findIndex(e=>e.exerciseId===a);i>=0?n[i]={...n[i],progression:{...n[i].progression||{scheme:"linear"},addRepsFirst:l}}:n.push({...C(x),progression:{scheme:"linear",incrementKg:2.5,addRepsFirst:l}});const c={...s,plan:n};r(d.map(e=>e.id===s.id?c:e)),e.put("templates",c)},className:"bg-slate-700 rounded px-2 py-1",children:[t.jsx("option",{value:"true",children:"Yes"}),t.jsx("option",{value:"false",children:"No"})]})]}),t.jsx("div",{className:"flex flex-col gap-1 text-[10px] sm:text-xs justify-end",children:t.jsx("div",{className:"opacity-60 leading-tight",children:"Guides next session progression (editable on import)"})})]})]},a)})}),t.jsx("div",{className:"mt-3",children:t.jsx("div",{className:"flex flex-wrap gap-2",children:t.jsx("button",{className:"text-xs sm:text-sm bg-slate-800 rounded-xl px-3 py-2",onClick:()=>m(s.id),children:"Add exercise"})})})]})]},s.id))}),p&&t.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 grid place-items-end sm:place-items-center",onClick:()=>m(null),children:t.jsxs("div",{className:"bg-card rounded-t-2xl sm:rounded-2xl p-4 shadow-soft w-full sm:max-w-md",onClick:e=>e.stopPropagation(),children:[t.jsx("div",{className:"font-medium mb-2",children:"Add exercise"}),t.jsx("input",{autoFocus:!0,className:"w-full bg-slate-800 rounded-xl px-3 py-3",placeholder:"Search or create exercise",value:u,onChange:e=>h(e.target.value)}),t.jsxs("div",{className:"mt-3 max-h-[60vh] overflow-y-auto space-y-2",children:[(()=>{const s=u.trim();if(!s)return null;return w(s)?null:t.jsxs("button",{className:"w-full text-left px-3 py-3 rounded-xl bg-brand-600 hover:bg-brand-700",onClick:async()=>{const t=d.find(e=>e.id===p),l=await(async s=>{const t=s.trim();if(!t)throw new Error("Exercise name required");const l=w(t);if(l)return l;const i={id:a(),name:t,muscleGroup:"other",defaults:{sets:3,targetRepRange:"8-12"},active:!0};return await e.put("exercises",i),c([i,...n]),i})(s);await I(t,l)},children:["Create “",s,"”"]})})(),n.filter(e=>e.name.toLowerCase().includes(u.toLowerCase())).map(e=>t.jsx("button",{className:"w-full text-left px-3 py-3 bg-slate-800 rounded-xl",onClick:()=>{const s=d.find(e=>e.id===p);I(s,e)},children:e.name},e.id))]})]})}),t.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-soft",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2 gap-2",children:[t.jsx("div",{className:"font-medium",children:"Exercise Library"}),t.jsx("input",{className:"bg-slate-800 rounded-xl px-3 py-3",placeholder:"Search",value:g,onChange:e=>f(e.target.value)})]}),t.jsxs("div",{className:"text-xs text-gray-500 mb-2 flex items-center gap-3 flex-wrap",children:[t.jsxs("span",{children:[g?E.length:v?n.length:0," exercise",1===(g?E.length:v?n.length:0)?"":"s"," shown"]}),t.jsx("button",{className:"badge-secondary",onClick:()=>b(e=>!e),children:v?"Hide All":"Show All"})]}),t.jsx("div",{className:"grid gap-2",children:E.map(s=>t.jsxs("div",{className:"flex items-center gap-2 bg-slate-800 rounded-xl px-3 py-3",children:[t.jsxs("div",{className:"flex-1 min-w-[140px]",children:[t.jsx("div",{className:"truncate text-sm",children:s.name}),t.jsxs("div",{className:"mt-1 flex items-center gap-2 text-[10px] text-gray-400",children:[t.jsx("select",{value:s.muscleGroup,onChange:async t=>{const a={...s,muscleGroup:t.target.value};await e.put("exercises",a),c(e=>e.map(e=>e.id===s.id?a:e))},className:"bg-slate-700 rounded px-1 py-0.5",children:["chest","back","shoulders","triceps","biceps","legs","hamstrings","quads","glutes","calves","core","other"].map(e=>t.jsx("option",{value:e,children:e},e))}),t.jsxs("div",{className:"flex flex-wrap gap-1 items-center",children:[(s.secondaryMuscles||[]).map(a=>t.jsxs("span",{className:"text-[10px] bg-slate-700 px-1.5 py-0.5 rounded flex items-center gap-1",children:[a,t.jsx("button",{className:"opacity-70 hover:opacity-100",onClick:async()=>{const t={...s,secondaryMuscles:(s.secondaryMuscles||[]).filter(e=>e!==a)};await e.put("exercises",t),c(e=>e.map(e=>e.id===s.id?t:e))},children:"×"})]},a)),t.jsx(i,{ex:s,update:async t=>{await e.put("exercises",t),c(e=>e.map(e=>e.id===s.id?t:e))}})]})]}),s.tags&&s.tags.length>0&&t.jsx("div",{className:"mt-1 flex flex-wrap gap-1 max-w-full",children:s.tags.slice(0,12).map(e=>t.jsx("span",{className:"text-[9px] bg-slate-700/70 px-1.5 py-0.5 rounded",children:e},e))})]}),t.jsx("button",{className:"text-xs sm:text-sm bg-slate-700 rounded-xl px-3 py-2",onClick:()=>R(s),children:s.isOptional?"Optional ✓":"Optional"}),t.jsx("button",{className:"text-xs sm:text-sm bg-red-600 rounded-xl px-3 py-2",onClick:()=>S(s),children:"Delete"})]},s.id))})]})]})}function i({ex:e,update:s}){const a=["chest","back","shoulders","triceps","biceps","legs","hamstrings","quads","glutes","calves","core","other"].filter(s=>s!==e.muscleGroup&&!(e.secondaryMuscles||[]).includes(s)),[n,i]=l.useState(!1);return n?t.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.map(a=>t.jsx("button",{className:"text-[10px] bg-slate-700 hover:bg-slate-600 px-1.5 py-0.5 rounded",onClick:()=>{const t={...e,secondaryMuscles:[...e.secondaryMuscles||[],a]};s(t)},children:a},a)),t.jsx("button",{className:"text-[10px] text-red-400 px-1.5",onClick:()=>i(!1),children:"×"})]}):t.jsx("button",{className:"text-[10px] bg-slate-700/60 hover:bg-slate-700 px-2 py-0.5 rounded",onClick:()=>i(!0),children:"+ add"})}export{n as default};
