import{e,j as s}from"./index-CS486dXL.js";import{r as t}from"./vendor-DTtRowIX.js";import{M as a}from"./muscles-BJCGbWqM.js";import"./charts-Cu4NAUVk.js";const r={forearms:24,biceps:36,triceps:36,shoulders:48,calves:48,core:48,chest:48,back:60,quads:72,hamstrings:72,glutes:72,other:48},n={forearms:.7,biceps:.8,triceps:.8,shoulders:.9,calves:.9,core:.85,chest:1,back:1.1,quads:1.2,hamstrings:1.15,glutes:1.15,other:1},i=/(curl|extension|raise|fly|pullover|pressdown|lateral|reverse fly|cable cross|rear delt)/i;function l(e,s,t,a){if(!e.reps||!e.weightKg||e.reps<=0||e.weightKg<=0)return[];const r=e.reps,l=e.weightKg,o=r*l*(.5+Math.log(l+1)/Math.log(150)*.7)/600,c=Math.min(o,2.5),d=i.test(s.name)?.7:1;return[t,...(s.secondaryMuscles||[]).filter(Boolean)].map((e,s)=>({muscle:e,startMs:a,s0:.9*c*d*(n[e]*(0===s?1:.35))}))}async function o(s){const[t,a]=await Promise.all([e("sessions",{swr:!0}),e("exercises",{swr:!0})]),i=s??Date.now(),o=new Map;a.forEach(e=>o.set(e.id,e));const c=i-6048e5,d=[];for(const e of t)for(const s of e.entries){const t=o.get(s.exerciseId);if(!t)continue;const a=t.muscleGroup||"other";for(const r of s.sets){const s=r.completedAt?Date.parse(r.completedAt):e.loggedEndAt?Date.parse(e.loggedEndAt):Date.parse(e.dateISO);s&&!isNaN(s)&&(s<c||d.push(...l(r,t,a,s)))}}const u={chest:[],back:[],shoulders:[],biceps:[],triceps:[],forearms:[],quads:[],hamstrings:[],glutes:[],calves:[],core:[],other:[]};d.forEach(e=>{u[e.muscle].push(e)});const m=[];Object.keys(u).forEach(e=>{const s=u[e],t=function(e){return 4.5*n[e]}(e);if(!s.length)return void m.push({muscle:e,percent:100,remaining:0,threshold:t,etaFull:i,status:"Ready"});const a=r[e],l=3600*a*1e3/4.6;let o=0,c=0;for(const r of s){const e=i-r.startMs;if(e<0)continue;o+=r.s0*Math.exp(-e/l),r.startMs>c&&(c=r.startMs)}const d=Math.min(1,o/t),h=Math.max(0,Math.min(100,100*(1-Math.pow(d,.75))));let g,f;if(o<=.05*t)g=i;else if(o>0){const e=.05*t,s=l*Math.log(Math.max(1,o/e));if(isFinite(s)&&s>0){const e=2*a*3600*1e3,t=Math.min(s,e);g=i+t}else g=c+3600*a*1e3}f=h>=90?"Ready":h>=70?"Near":h>=45?"Caution":"Not Ready",m.push({muscle:e,percent:h,remaining:o,threshold:t,etaFull:g,status:f})}),m.sort((e,s)=>e.muscle.localeCompare(s.muscle));const h=m.reduce((e,s)=>(e[s.muscle]=s,e),{});return{updatedAt:i,muscles:m,byMuscle:h}}let c=null,d=null,u=0;"undefined"!=typeof window&&(window.addEventListener("cache-refresh",e=>{var s;const t=null==(s=null==e?void 0:e.detail)?void 0:s.store;"sessions"!==t&&"exercises"!==t||(c=null,u=0)}),window.addEventListener("sb-change",e=>{var s;const t=null==(s=null==e?void 0:e.detail)?void 0:s.table;"sessions"!==t&&"exercises"!==t||(c=null,u=0)}));const m=["chest","back","shoulders","biceps","triceps","forearms","quads","hamstrings","glutes","calves","core","other"];function h(e){if(!e)return"";const s=Date.now();if(e<=s)return"Ready";const t=e-s,a=Math.floor(t/36e5),r=Math.floor(t%36e5/6e4);return a<=0?`${r}m`:a<10?`${a}h ${r}m`:`${a}h`}function g(e){switch(e){case"Ready":return"from-emerald-400/70 to-emerald-500/70";case"Near":return"from-lime-300/70 to-amber-300/70";case"Caution":return"from-amber-400/60 to-orange-500/70";case"Not Ready":return"from-rose-500/70 to-red-600/70"}}function f(e){switch(e){case"Ready":return"bg-emerald-500/25";case"Near":return"bg-lime-400/25";case"Caution":return"bg-amber-500/25";case"Not Ready":return"bg-red-600/25"}}function p(){const[e,r]=t.useState({loading:!0,muscles:[]}),n=t.useCallback(async e=>{try{const s=await async function(e){const s=Date.now();return!e&&c&&s-u<6e5?c:d||(d=o().then(e=>(c=e,u=Date.now(),d=null,e)).catch(e=>{throw d=null,e}),d)}(e);r({loading:!1,muscles:s.muscles,updatedAt:s.updatedAt})}catch(s){r(e=>({...e,loading:!1,error:(null==s?void 0:s.message)||"Failed to compute recovery"}))}},[]);return t.useEffect(()=>{n()},[n]),t.useEffect(()=>{const e=setInterval(()=>n(!0),36e5),s=()=>{"visible"===document.visibilityState&&n()};return document.addEventListener("visibilitychange",s),()=>{clearInterval(e),document.removeEventListener("visibilitychange",s)}},[n]),s.jsxs("div",{className:"space-y-6 pb-24",children:[s.jsxs("header",{className:"flex items-baseline gap-4 flex-wrap",children:[s.jsx("h1",{className:"text-xl font-semibold tracking-tight",children:"Recovery"}),e.updatedAt&&s.jsxs("span",{className:"text-xs text-slate-400",children:["Updated ",new Date(e.updatedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),s.jsx("button",{onClick:()=>n(!0),className:"ml-auto text-xs rounded-md bg-white/5 hover:bg-white/10 px-2 py-1 font-medium text-slate-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400/60",children:"Refresh"})]}),e.error&&s.jsx("div",{className:"text-sm text-red-400",children:e.error}),s.jsx("div",{className:"grid gap-4 sm:grid-cols-2 xl:grid-cols-3",children:m.map(t=>{const r=e.muscles.find(e=>e.muscle===t),n=r?r.percent:100,i=r?r.status:"Ready",l=null==r?void 0:r.etaFull;return s.jsxs("div",{className:"relative rounded-xl border border-white/10 bg-gradient-to-br from-slate-800/40 to-slate-900/60 p-4 flex flex-col gap-3 shadow-inner shadow-black/30",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("img",{src:a[t],alt:"",className:"w-10 h-10 object-contain opacity-80"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h2",{className:"text-base font-medium capitalize tracking-wide",children:t}),s.jsx("span",{className:`text-[10px] font-semibold px-1.5 py-0.5 rounded-md bg-gradient-to-r ${g(i)} text-slate-900 shadow`,children:i})]}),s.jsx("div",{className:"text-[11px] text-slate-400 mt-0.5 leading-tight",children:"Ready"===i?"Fully recovered or low residual fatigue":"Near"===i?"Approaching readiness":"Caution"===i?"Moderate residual fatigue":"High residual fatigue"})]}),s.jsxs("div",{className:"text-right text-sm font-semibold tabular-nums w-12",children:[n.toFixed(0),"%"]})]}),s.jsxs("div",{className:"relative h-3 rounded-md overflow-hidden bg-slate-700/40",children:[s.jsx("div",{className:`absolute inset-y-0 left-0 ${f(i)} bg-gradient-to-r ${g(i)} backdrop-blur-sm`,style:{width:n+"%"}}),s.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(90deg,rgba(255,255,255,0)_0%,rgba(255,255,255,0.15)_50%,rgba(255,255,255,0)_100%)] bg-[length:180px_100%] animate-[shimmer_4s_linear_infinite] opacity-30 mix-blend-overlay"})]}),s.jsxs("div",{className:"text-[11px] text-slate-400 flex items-center justify-between",children:[s.jsx("span",{children:n>=99?"Ready to train":n>=90?"Trainable w/ normal volume":n>=75?"Light / technique work OK":n>=50?"Maybe isolate or low load":"Consider rest or deload"}),s.jsx("span",{className:"text-slate-300 font-medium",children:h(l)})]})]},t)})}),s.jsx("footer",{className:"pt-2 text-[10px] text-slate-500 leading-relaxed max-w-2xl",children:s.jsxs("p",{children:[s.jsx("strong",{className:"font-semibold text-slate-300",children:"Smart Recovery Algorithm:"})," Uses intelligent exponential decay modeling based on training volume, intensity, and exercise type. Recovery times account for muscle size, training frequency, and realistic fatigue accumulation. Small muscles (biceps, triceps): 24-48h. Large muscles (quads, back): 60-72h. Actual recovery varies with sleep, nutrition, stress, and genetics. Use as guidance, not prescription."]})})]})}export{p as default};
