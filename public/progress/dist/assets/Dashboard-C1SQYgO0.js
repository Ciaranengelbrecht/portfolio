import{d as e,g as t,a as s,r as a,s as l,b as i,j as n,G as r,c as o,e as c,f as d,A as m,m as x,h as u,i as h}from"./index-99Z_m9z_.js";import{r as p}from"./vendor-DTtRowIX.js";import{l as g}from"./loadRecharts-BTZDNLeK.js";import{c as f}from"./volume-BJI1l3a6.js";import{u as v}from"./useAggregates-Ce1MKSDU.js";import"./charts-Cu4NAUVk.js";const b=["4w","8w","12w","all"],j=[{key:"topWeight",label:"Top Weight"},{key:"avgWeight",label:"Avg Weight"},{key:"repsTotal",label:"Reps"},{key:"volume",label:"Volume"}];function N({kind:o}){const[c,d]=p.useState([]),[m,x]=p.useState("waist"),[u,h]=p.useState(""),[f,v]=p.useState("8w"),[N,y]=p.useState(["topWeight"]),[w,k]=p.useState([]),[S,W]=p.useState([]),[,$]=p.useState(0);p.useEffect(()=>{(async()=>{d(await e.getAll("exercises"));const s=await t();s.exerciseId&&h(s.exerciseId),s.measurementKey&&x(s.measurementKey),s.range&&v(s.range)})()},[]),p.useEffect(()=>{(async()=>{var e;if("exercise"===o){const t=u||(null==(e=c[0])?void 0:e.id);if(!t)return;h(t);const i=await s(t,f);k(i),await a(t);const n=i.map(e=>e.topWeight),r=Math.max(0,...n);W(i.map(e=>e.topWeight>=r?e.topWeight:0)),await l({exerciseId:t,range:f})}else{const e=await i(m,f);k(e),await l({measurementKey:m,range:f})}})()},[o,u,m,f,c]),p.useEffect(()=>{const e=()=>$(e=>e+1);return window.addEventListener("theme-change",e),()=>window.removeEventListener("theme-change",e)},[]);const C=getComputedStyle(document.documentElement),F=C.getPropertyValue("--chart-1").trim()||"#3b82f6",L=C.getPropertyValue("--chart-2").trim()||"#22c55e",T=C.getPropertyValue("--chart-grid").trim()||"#1f2937",M=getComputedStyle(document.documentElement).getPropertyValue("--text-muted").trim()||"#9ca3af",A="exercise"===o?j:[{key:"value",label:"Value"}],V=C.getPropertyValue("--glow").trim(),[E,O]=p.useState(null);p.useEffect(()=>{let e=!0;return g().then(t=>{e&&O(t)}),()=>{e=!1}},[]);const B=n.jsx("div",{className:"h-60 flex items-center justify-center text-xs text-gray-500",children:"Loading chart…"});return n.jsxs(r,{children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:["exercise"===o?n.jsx("select",{className:"input-app rounded-xl px-2 py-1",value:u,onChange:e=>h(e.target.value),children:c.map(e=>n.jsx("option",{value:e.id,children:e.name},e.id))}):n.jsx("select",{className:"input-app rounded-xl px-2 py-1",value:m,onChange:e=>x(e.target.value),children:["weightKg","waist","upperArm","chest","thigh","calf"].map(e=>n.jsx("option",{value:e,children:e},e))}),n.jsx("div",{className:"flex gap-1 ml-auto flex-wrap",children:b.map(e=>n.jsx("button",{className:"text-xs px-2 py-1 rounded-xl "+(f===e?"btn-primary":"btn-outline"),onClick:()=>v(e),children:e.toUpperCase()},e))})]}),n.jsx("div",{className:"flex gap-2 mb-2 flex-wrap",children:A.map(e=>n.jsxs("label",{className:"text-xs input-app rounded-xl px-2 py-1 flex items-center gap-1",children:[n.jsx("input",{type:"checkbox",checked:N.includes(e.key),onChange:t=>y(t.target.checked?[...N,e.key]:N.filter(t=>t!==e.key))})," ",e.label]},e.key))}),n.jsxs("div",{className:"h-60",children:[!E&&B,E&&n.jsx(E.ResponsiveContainer,{children:n.jsxs(E.LineChart,{data:w,margin:{left:8,right:8,top:8,bottom:8},children:[n.jsx(E.CartesianGrid,{strokeDasharray:"3 3",stroke:T}),n.jsx(E.XAxis,{dataKey:"date",stroke:M}),n.jsx(E.YAxis,{stroke:M}),n.jsx(E.Tooltip,{}),"exercise"===o?N.map((e,t)=>n.jsx(E.Line,{type:"monotone",dataKey:e,stroke:t%2==0?F:L,dot:!1,strokeWidth:0===t?2:1.5,filter:0===t&&V?"url(#glow)":void 0},e)):n.jsx(E.Line,{type:"monotone",dataKey:"value",stroke:F,dot:!1,strokeWidth:2}),"exercise"===o&&S.some(Boolean)&&n.jsx(E.Scatter,{data:w.map((e,t)=>S[t]?{date:e.date,y:e.topWeight}:null).filter(Boolean),fill:L}),n.jsx("defs",{children:n.jsxs("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{stdDeviation:"2.5",result:"coloredBlur"}),n.jsxs("feMerge",{children:[n.jsx("feMergeNode",{in:"coloredBlur"}),n.jsx("feMergeNode",{in:"SourceGraphic"})]})]})})]})})]})]})}const y=new Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1});function w(e){return Number.isFinite(e)&&0!==e?y.format(e).replace(/\.0([A-Za-z])/,"$1").replace(/\.0$/,""):"0"}function k(e){if(!Number.isFinite(e)||e<=0)return"0h";if(e>=100)return`${Math.round(e)}h`;if(e>=10)return`${e.toFixed(1)}h`;if(e>=1)return`${e.toFixed(1)}h`;return`${Math.round(60*e)}m`}function S(e){return!Number.isFinite(e)||e<=0?"0":e>=1e3?w(e):Math.round(e).toLocaleString()}function W(e){const t=e=>Math.max(0,Math.min(e,432e5)),s=e.workLog;if(s&&Object.keys(s).length){const e=Object.values(s).filter(Boolean).map(e=>({first:new Date(e.first||0).getTime(),last:new Date(e.last||0).getTime()})).filter(e=>!Number.isNaN(e.first)&&!Number.isNaN(e.last)&&e.last>=e.first).sort((e,t)=>t.last-t.first)[0];if(e)return t(e.last-e.first)}if(e.loggedStartAt&&e.loggedEndAt){const s=new Date(e.loggedStartAt).getTime(),a=new Date(e.loggedEndAt).getTime();if(!Number.isNaN(s)&&!Number.isNaN(a)&&a>=s)return t(a-s)}return 0}function $(){var e;const[s,a]=p.useState(1),[i,b]=p.useState(1),[j,y]=p.useState({}),[$,C]=p.useState({}),[F,L]=p.useState({}),[T,M]=p.useState({}),[A,V]=p.useState({}),[E,O]=p.useState([]),[B,K]=p.useState([]),[P,D]=p.useState(0),[z,_]=p.useState(null),[G,I]=p.useState({}),[R,H]=p.useState(null),[U,X]=p.useState([]),[Y,Z]=p.useState(null),[q,J]=p.useState(!0),[Q,ee]=p.useState(null),[te,se]=p.useState("kg"),[ae,le]=p.useState({workouts:0,sets:0,hours:0,tonnage:0}),[ie,ne]=p.useState({workouts:0,sets:0,hours:0,tonnage:0,weekNumber:null,phaseNumber:null}),{data:re}=v();p.useEffect(()=>{(async()=>{var e,s;const l=await t();l.lastLocation&&(a(l.lastLocation.phaseNumber),b(l.lastLocation.weekNumber)),V(l.hidden||{});const i=(null==(e=l.lastLocation)?void 0:e.phaseNumber)||1,n=await o();ee(n),L(n.volumeTargets||{});const[r,m]=await Promise.all([c("sessions"),c("exercises")]);K(r);const{perWeek:x,totals:u}=await f(i,{sessions:r,exercises:m});M(x);const h={};r.filter(e=>(e.phaseNumber||e.phase||1)===i).forEach(e=>{const t=e.weekNumber,s=Number((e.id||"").split("-")[2])||0;let a=0;for(const l of e.entries||[])for(const e of l.sets||[])"number"==typeof e.weightKg&&"number"==typeof e.reps&&(e.weightKg||0)>0&&(e.reps||0)>0&&(a+=(e.weightKg||0)*(e.reps||0));h[t]||(h[t]={}),h[t][s]=(h[t][s]||0)+a}),I(h);try{const e=await d();H(e)}catch{}g().then(e=>Z(e));const p=(null==(s=l.lastLocation)?void 0:s.weekNumber)||1;if(re){const e=`P${i}-W${p}`;y(re.weeklyVolume[e]||{})}else y(x[p]||{});C(u);const v=re?re.weeklyVolume[`P${i}-W${p}`]||{}:x[p]||{};O(Object.entries(v).map(([e,t])=>({muscle:e,value:t})).sort((e,t)=>t.value-e.value)),J(!1)})()},[]),p.useEffect(()=>{const e=e=>{var t;["sessions","exercises","settings"].includes(null==(t=null==e?void 0:e.detail)?void 0:t.table)&&(async()=>{const e=await o();ee(e),L(e.volumeTargets||{});const[t,a]=await Promise.all([c("sessions",{force:!0}),c("exercises",{force:!0})]);K(t);const{perWeek:l,totals:n}=await f(s,{sessions:t,exercises:a});M(l),y(l[i]||{}),C(n);const r=l[i]||{};O(Object.entries(r).map(([e,t])=>({muscle:e,value:t})).sort((e,t)=>t.value-e.value));const d={};t.filter(e=>(e.phaseNumber||e.phase||1)===s).forEach(e=>{const t=e.weekNumber,s=Number((e.id||"").split("-")[2])||0;let a=0;for(const l of e.entries||[])for(const e of l.sets||[])"number"==typeof e.weightKg&&"number"==typeof e.reps&&(e.weightKg||0)>0&&(e.reps||0)>0&&(a+=(e.weightKg||0)*(e.reps||0));d[t]||(d[t]={}),d[t][s]=(d[t][s]||0)+a}),I(d)})()};return window.addEventListener("sb-change",e),()=>window.removeEventListener("sb-change",e)},[s,i]),p.useEffect(()=>{if(null==R?void 0:R.weeklySplit)X(R.weeklySplit.map(e=>e.customLabel||e.type));else{const e=Array.from(new Set(Object.values(G).flatMap(e=>Object.keys(e).map(Number)))).sort((e,t)=>e-t);X(e.map(e=>`D${e+1}`))}},[null==R?void 0:R.id,null==(e=null==R?void 0:R.weeklySplit)?void 0:e.length,Object.keys(G).length]),p.useEffect(()=>{const e=Array.isArray(B)?B:[],t=Number.isFinite(i)?i:null,a=Number.isFinite(s)?s:null,l="lb"===((null==Q?void 0:Q.unit)??"kg"),n=l?2.2046226218:1;if(se(l?"lb":"kg"),!e.length)return le({workouts:0,sets:0,hours:0,tonnage:0}),void ne({workouts:0,sets:0,hours:0,tonnage:0,weekNumber:t,phaseNumber:a});let r=0,o=0,c=0,d=0,m=0,x=0,u=0,h=0;for(const s of e){if(!s||s.deletedAt)continue;let e=0,l=0,i=!1;for(const t of s.entries||[])for(const s of t.sets||[]){const t=Math.max(0,(null==s?void 0:s.reps)??0),a=Math.max(0,(null==s?void 0:s.weightKg)??0);0===t&&0===a||(i=!0,e+=1,o+=1,t>0&&a>0&&(l+=a*t))}if(!i)continue;const n=W(s)||0;r+=1,c+=l,d+=n,null==t||s.weekNumber!==t||null!=a&&(s.phaseNumber??s.phase??a)!==a||(m+=1,x+=e,u+=l,h+=n)}le({workouts:r,sets:o,hours:d/36e5,tonnage:c*n}),ne({workouts:m,sets:x,hours:h/36e5,tonnage:u*n,weekNumber:t,phaseNumber:a})},[B,i,s,Q]);const oe=({label:e,flag:t})=>n.jsx("button",{onClick:()=>(async e=>{const t={...A||{},[e]:!(null==A?void 0:A[e])};V(t),await l({hidden:t})})(t),className:"text-xs px-2.5 py-1 rounded-lg border font-medium transition-all "+((null==A?void 0:A[t])?"bg-slate-800 text-gray-400 border-white/5":"badge-primary"),children:(null==A?void 0:A[t])?`Show ${e}`:`Hide ${e}`}),ce=ae.workouts>0||ae.sets>0||ae.tonnage>0||ae.hours>0,de=ie.workouts>0||ie.sets>0||ie.tonnage>0||ie.hours>0,me=p.useMemo(()=>[{key:"workouts",label:"Workouts",value:S(ae.workouts),caption:"sessions"},{key:"sets",label:"Sets",value:S(ae.sets),caption:"logged"},{key:"hours",label:"Active Time",value:k(ae.hours),caption:"tracked"},{key:"volume",label:"Volume",value:w(ae.tonnage),caption:`${te} lifted`}],[ae,te]),xe=p.useMemo(()=>[{key:"workouts",label:"Workouts",value:S(ie.workouts),caption:"logged"},{key:"sets",label:"Sets",value:S(ie.sets),caption:"valid"},{key:"hours",label:"Active Time",value:k(ie.hours),caption:"this week"},{key:"volume",label:"Volume",value:w(ie.tonnage),caption:`${te} lifted`}],[ie,te]),ue=p.useMemo(()=>ie.weekNumber?ie.phaseNumber?`Phase ${ie.phaseNumber} • Week ${ie.weekNumber}`:`Week ${ie.weekNumber}`:"Current Week",[ie.phaseNumber,ie.weekNumber]),he=()=>n.jsxs(r,{children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("div",{className:"font-medium text-sm",children:"Weekly Muscle Volume"}),n.jsx(oe,{label:"Weekly Bar",flag:"weeklyMuscleBar"})]}),n.jsxs("div",{className:"h-48 flex items-end gap-2 overflow-x-auto pb-2",children:[E.map(e=>{const t=Math.max(1,...E.map(e=>e.value)),s=e.value/t*100;return n.jsxs("div",{className:"flex flex-col items-center w-10",children:[n.jsx("div",{className:"w-full bg-slate-700/50 rounded-t-md relative",style:{height:`${s}%`},children:n.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-[9px] font-medium text-white/80",children:e.value.toFixed(1)})}),n.jsx("div",{className:"text-[9px] mt-1 capitalize truncate w-full text-center",children:e.muscle})]},e.muscle)}),!E.length&&n.jsx("div",{className:"text-[11px] text-gray-500",children:"No data."})]})]});return n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"grid gap-4 lg:grid-cols-[minmax(0,2fr)_minmax(0,1.2fr)]",children:[n.jsxs("div",{className:"relative overflow-hidden rounded-3xl border border-white/10 bg-gradient-to-br from-slate-950 via-slate-900/70 to-slate-950 p-6 text-slate-100 shadow-[0_30px_80px_-45px_rgba(56,189,248,0.6)]",children:[n.jsx("div",{className:"pointer-events-none absolute -left-24 top-0 h-64 w-64 rounded-full bg-cyan-500/10 blur-3xl"}),n.jsx("div",{className:"pointer-events-none absolute -right-12 -bottom-16 h-52 w-52 rounded-full bg-indigo-500/10 blur-3xl"}),n.jsxs("div",{className:"relative z-10 flex flex-col gap-6",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-[11px] uppercase tracking-[0.38em] text-white/60",children:"Lifetime"}),n.jsx("h2",{className:"mt-2 text-3xl font-semibold tracking-tight text-white",children:"Training Ledger"})]}),ce?n.jsx("div",{className:"grid gap-6 sm:grid-cols-2 xl:grid-cols-4",children:me.map(e=>n.jsxs("div",{className:"space-y-2",children:[n.jsx("span",{className:"text-[10px] uppercase tracking-[0.4em] text-white/40",children:e.label}),n.jsxs("div",{className:"flex items-baseline gap-2",children:[n.jsx("span",{className:"text-4xl font-semibold text-white/90",children:e.value}),e.caption&&n.jsx("span",{className:"text-xs uppercase tracking-[0.32em] text-white/50",children:e.caption})]})]},e.key))}):n.jsx("p",{className:"text-sm text-white/70",children:"Log your first session to unlock lifetime insights."})]})]}),n.jsxs("div",{className:"relative overflow-hidden rounded-3xl border border-white/5 bg-slate-900/85 p-6 text-slate-100 shadow-[0_25px_70px_-50px_rgba(59,130,246,0.55)]",children:[n.jsx("div",{className:"pointer-events-none absolute -right-16 top-8 h-44 w-44 rounded-full bg-emerald-500/20 blur-3xl"}),n.jsxs("div",{className:"relative z-10 flex flex-col gap-5",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-[11px] uppercase tracking-[0.38em] text-emerald-200/70",children:"Current Focus"}),n.jsx("h2",{className:"mt-2 text-2xl font-semibold text-white/90",children:ue})]}),de?n.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:xe.map(e=>n.jsxs("div",{className:"space-y-2 rounded-2xl border border-white/10 bg-slate-900/70 px-4 py-3",children:[n.jsx("span",{className:"text-[10px] uppercase tracking-[0.35em] text-white/40",children:e.label}),n.jsxs("div",{className:"flex items-baseline gap-2",children:[n.jsx("span",{className:"text-3xl font-semibold text-white",children:e.value}),e.caption&&n.jsx("span",{className:"text-[11px] uppercase tracking-[0.28em] text-white/50",children:e.caption})]})]},e.key))}):n.jsx("p",{className:"text-sm text-slate-300/80",children:"No tracked sessions for this week yet. Log a workout to see trends instantly."})]})]})]}),n.jsxs("div",{className:"flex flex-wrap gap-2 text-label",children:[n.jsx(oe,{label:"Training",flag:"trainingChart"}),n.jsx(oe,{label:"Body",flag:"bodyChart"}),n.jsx(oe,{label:"Week Volume",flag:"weekVolume"}),n.jsx(oe,{label:"Phase Totals",flag:"phaseTotals"}),n.jsx(oe,{label:"Compliance",flag:"compliance"}),n.jsx(oe,{label:"Weekly Bar",flag:"weeklyMuscleBar"}),n.jsx(oe,{label:"Session Volume",flag:"sessionVolumeTrend"})]}),n.jsxs(m,{initial:!1,children:[!(null==A?void 0:A.trainingChart)&&n.jsxs(x.div,{className:"space-y-2",variants:u(h),initial:"initial",animate:"animate",exit:"exit",children:[n.jsx("div",{className:"text-subtitle",children:"Training"}),q?n.jsx("div",{className:"h-60 rounded-xl bg-white/5 animate-pulse"}):n.jsx(N,{kind:"exercise"})]},"training"),!(null==A?void 0:A.bodyChart)&&n.jsxs(x.div,{className:"space-y-2",variants:u(h),initial:"initial",animate:"animate",exit:"exit",children:[n.jsx("div",{className:"text-subtitle",children:"Body"}),q?n.jsx("div",{className:"h-60 rounded-xl bg-white/5 animate-pulse"}):n.jsx(N,{kind:"measurement"})]},"body"),!(null==A?void 0:A.weekVolume)&&n.jsxs(x.div,{className:"space-y-3",variants:u(h),initial:"initial",animate:"animate",exit:"exit",children:[n.jsxs("div",{className:"text-title",children:["Week ",i," Logged Volume"," ",n.jsx("span",{className:"text-body-sm text-slate-400 ml-1 align-middle",children:"(Weighted Sets)"})]}),n.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:[Object.entries(j).sort((e,t)=>t[1]-e[1]).map(([e,t])=>{const s=F[e]||0,a=s?Math.min(100,t/s*100):100,l=s?t>=s?"bg-emerald-500":"bg-amber-500":"bg-emerald-500",r=T[i-1]&&T[i-1][e]||0,o=t-r,c=o>0?"▲":o<0?"▼":"–",d=o>0?"text-emerald-400":o<0?"text-red-400":"text-gray-400";return n.jsxs(x.div,{className:"bg-white/5 rounded-lg px-2 py-2 space-y-1",initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,y:4},transition:{duration:.25},title:`Prev Week: ${r.toFixed(1)} | Delta: ${o>=0?"+":""}${o.toFixed(1)}`,children:[n.jsxs("div",{className:"flex items-center justify-between text-[10px] text-gray-400",children:[n.jsxs("span",{className:"capitalize flex items-center gap-1",children:[e,n.jsxs("span",{className:`inline-flex items-center gap-0.5 ${d} font-medium`,children:[n.jsx("span",{className:"leading-none",children:c}),n.jsx("span",{className:"tabular-nums",children:0===o?"0.0":`${o>0?"+":""}${o.toFixed(1)}`})]})]}),n.jsxs("span",{className:"tabular-nums",children:[t.toFixed(1),s?`/${s}`:""]})]}),n.jsxs("div",{className:"h-2 w-full bg-slate-700/40 rounded overflow-hidden relative",children:[n.jsx(x.div,{className:`h-full ${l}`,initial:{width:0},animate:{width:`${a}%`},transition:{type:"spring",stiffness:150,damping:26}}),s?n.jsxs("span",{className:"absolute inset-y-0 right-0 text-[8px] text-white/60 pr-1 flex items-center",children:[Math.round(a),"%"]}):null]})]},e)}),!Object.keys(j).length&&n.jsx("div",{className:"col-span-full text-[11px] text-gray-500",children:"No logged sets yet."})]})]},"weekVol"),!(null==A?void 0:A.phaseTotals)&&n.jsxs(x.div,{className:"space-y-3",variants:u(h),initial:"initial",animate:"animate",exit:"exit",children:[n.jsxs("div",{className:"text-title",children:["Phase Totals"," ",n.jsx("span",{className:"text-body-sm text-slate-400 ml-1 align-middle",children:"(Weighted Sets)"})]}),n.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:[Object.entries($).sort((e,t)=>t[1]-e[1]).map(([e,t])=>{const s=t/Math.max(1,...Object.values($))*100;return n.jsxs(x.div,{className:"bg-white/5 rounded-lg px-2 py-2 space-y-1",initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,y:4},transition:{duration:.25},children:[n.jsxs("div",{className:"flex items-center justify-between text-[10px] text-gray-400",children:[n.jsx("span",{className:"capitalize",children:e}),n.jsx("span",{className:"tabular-nums",children:t.toFixed(1)})]}),n.jsx("div",{className:"h-2 w-full bg-slate-700/40 rounded overflow-hidden",children:n.jsx(x.div,{className:"h-full bg-indigo-500",initial:{width:0},animate:{width:`${s}%`},transition:{type:"spring",stiffness:150,damping:26}})})]},e)}),!Object.keys($).length&&n.jsx("div",{className:"col-span-full text-[11px] text-gray-500",children:"No logged sets yet."})]})]},"phaseTotals"),!(null==A?void 0:A.weeklyMuscleBar)&&n.jsx(x.div,{className:"space-y-3",variants:u(h),initial:"initial",animate:"animate",exit:"exit",children:n.jsx(he,{})},"weeklyBar"),!(null==A?void 0:A.sessionVolumeTrend)&&n.jsx(x.div,{className:"space-y-3",variants:u(h),initial:"initial",animate:"animate",exit:"exit",children:n.jsxs(r,{children:[n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-2",children:[n.jsxs("div",{className:"font-medium text-sm",children:["Session Tonnage Trend"," ",n.jsx("span",{className:"text-xs text-slate-400 ml-1",children:"(per selected day across weeks)"})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[10px]",children:[n.jsxs("label",{className:"flex items-center gap-1",children:["Day",n.jsx("select",{className:"bg-slate-700 rounded px-1 py-0.5",value:P,onChange:e=>{D(Number(e.target.value))},children:U.map((e,t)=>n.jsx("option",{value:t,children:e},t))})]}),n.jsxs("label",{className:"flex items-center gap-1",children:["Highlight",n.jsxs("select",{className:"bg-slate-700 rounded px-1 py-0.5",value:z??"",onChange:e=>_(e.target.value?Number(e.target.value):null),children:[n.jsx("option",{value:"",children:"None"}),Object.keys(G).map(e=>n.jsxs("option",{value:e,children:["W",e]},e))]})]}),n.jsx("button",{onClick:()=>_(Object.keys(G).map(Number).sort((e,t)=>e-t).pop()||null),className:"px-2 py-0.5 rounded bg-slate-700 hover:bg-slate-600",children:"Last"})]})]}),(()=>{const e=Object.keys(G).map(Number).sort((e,t)=>e-t).map(e=>{var t;return{week:e,vol:(null==(t=G[e])?void 0:t[P])||0}}),t=e.map(e=>e.vol).filter(e=>e>0),s=t.length?t.reduce((e,t)=>e+t,0)/t.length:0,a=t.length?Math.max(...t):0,l=e.length?e[e.length-1].vol:0,i=e.length>1?e[e.length-2].vol:0,r=i?(l-i)/i*100:0;let o=0;if(e.length>1){const t=e.length,s=e.reduce((e,t)=>e+t.week,0),a=e.reduce((e,t)=>e+t.vol,0),l=e.reduce((e,t)=>e+t.week*t.week,0);o=(t*e.reduce((e,t)=>e+t.week*t.vol,0)-s*a)/(t*l-s*s||1)}const c=s,d=null==Y?void 0:Y.BarChart,m=null==Y?void 0:Y.Bar,x=null==Y?void 0:Y.XAxis,u=null==Y?void 0:Y.YAxis,h=null==Y?void 0:Y.Tooltip,p=null==Y?void 0:Y.ResponsiveContainer,g=null==Y?void 0:Y.ReferenceLine,f=null==Y?void 0:Y.CartesianGrid;return n.jsxs("div",{children:[n.jsxs("div",{className:"flex flex-wrap gap-4 text-[10px] text-slate-400 mb-2",children:[n.jsxs("div",{children:["Avg"," ",n.jsx("span",{className:"text-slate-200 font-medium tabular-nums",children:s.toFixed(0)})]}),n.jsxs("div",{children:["Best"," ",n.jsx("span",{className:"text-slate-200 font-medium tabular-nums",children:a.toFixed(0)})]}),n.jsxs("div",{children:["Last"," ",n.jsx("span",{className:"text-slate-200 font-medium tabular-nums",children:l.toFixed(0)})]}),n.jsxs("div",{children:["ΔPrev"," ",n.jsx("span",{className:"font-medium tabular-nums "+(r>0?"text-emerald-400":r<0?"text-red-400":"text-slate-300"),children:i?(r>0?"+":"")+r.toFixed(1)+"%":"–"})]}),n.jsxs("div",{children:["Slope"," ",n.jsx("span",{className:"font-medium tabular-nums "+(o>0?"text-emerald-400":o<0?"text-red-400":"text-slate-300"),children:o.toFixed(1)})]})]}),n.jsx("div",{className:"h-56",children:Y&&e.length?n.jsx(p,{width:"100%",height:"100%",children:n.jsxs(d,{data:e,margin:{left:4,right:4,top:10,bottom:4},barSize:32,children:[n.jsx(f,{stroke:"rgba(255,255,255,0.08)",vertical:!1}),n.jsx(x,{dataKey:"week",tick:{fill:"#94a3b8",fontSize:10},tickFormatter:e=>"W"+e,axisLine:!1,tickLine:!1}),n.jsx(u,{tick:{fill:"#94a3b8",fontSize:10},width:40,axisLine:!1,tickLine:!1,tickFormatter:e=>e>=1e3?(e/1e3).toFixed(1)+"k":e.toFixed(0)}),n.jsx(h,{cursor:{fill:"rgba(255,255,255,0.06)"},content:({active:t,payload:a,label:l})=>{if(!t||!(null==a?void 0:a.length))return null;const i=a[0].payload,r=e.findIndex(e=>e.week===i.week)-1,o=r>=0?e[r].vol:0,c=o?(i.vol-o)/o*100:0;return n.jsxs("div",{className:"text-[11px] bg-slate-800/90 backdrop-blur-md border border-white/10 rounded-md px-2 py-1 space-y-0.5",children:[n.jsxs("div",{className:"font-medium text-slate-200",children:["Week ",i.week]}),n.jsxs("div",{className:"tabular-nums",children:["Tonnage:"," ",n.jsx("span",{className:"text-slate-100 font-semibold",children:i.vol.toFixed(0)})]}),n.jsxs("div",{className:"tabular-nums",children:["ΔPrev:"," ",n.jsx("span",{className:c>0?"text-emerald-400":c<0?"text-red-400":"text-slate-300",children:o?(c>0?"+":"")+c.toFixed(1)+"%":"–"})]}),n.jsxs("div",{className:"tabular-nums",children:["vs Avg:"," ",n.jsx("span",{className:i.vol>=s?"text-emerald-400":"text-amber-400",children:s?((i.vol-s)/s*100).toFixed(1)+"%":"–"})]})]})}}),n.jsx(g,{y:c,stroke:"#10b981",strokeDasharray:"3 3",ifOverflow:"extendDomain"}),n.jsx(m,{dataKey:"vol",radius:[4,4,0,0],fill:"#6366f1",children:e.map((e,t)=>{const s=z===e.week;return n.jsx(Y.Cell,{fill:s?"url(#gradHighlight)":e.vol===a?"#10b981":"#6366f1"},e.week)})}),n.jsx("defs",{children:n.jsxs("linearGradient",{id:"gradHighlight",x1:"0",x2:"0",y1:"0",y2:"1",children:[n.jsx("stop",{offset:"0%",stopColor:"#059669"}),n.jsx("stop",{offset:"100%",stopColor:"#065f46"})]})})]})}):n.jsx("div",{className:"h-full flex items-center justify-center text-[11px] text-gray-500",children:e.length?"Loading chart...":"No data."})})]})})()]})},"sessionVolTrend"),!(null==A?void 0:A.compliance)&&n.jsxs(x.div,{className:"bg-card rounded-2xl p-5 shadow-soft space-y-4",variants:u(h),initial:"initial",animate:"animate",exit:"exit",children:[n.jsx("div",{className:"text-title",children:"Phase Weekly Compliance"}),n.jsx("div",{className:"text-body-sm text-gray-400",children:"Color shows adherence vs target (green >=100%, amber 70-99%, red <70%)."}),n.jsx("div",{className:"space-y-2",children:Object.keys(F).filter(e=>F[e]>0).sort().map(e=>{const t=Object.entries(T).sort((e,t)=>Number(e[0])-Number(t[0]));return n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"text-label text-gray-500 flex justify-between",children:[n.jsx("span",{children:e}),n.jsx("span",{className:"tabular-nums",children:F[e]})]}),n.jsx("div",{className:"flex gap-1",children:t.map(([t,s])=>{const a=s[e]||0,l=F[e],i=l?a/l:1,r=i>=1?"bg-emerald-600":i>=.7?"bg-amber-500":"bg-red-600";return n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"h-8 rounded-md relative overflow-hidden bg-slate-700/40",children:[n.jsx(x.div,{className:`${r} absolute bottom-0 left-0 w-full`,initial:{height:0},animate:{height:`${Math.min(100,100*i)}%`},transition:{type:"spring",stiffness:150,damping:26}}),n.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-[9px] text-white/80 font-medium",children:a.toFixed(1)})]}),n.jsxs("div",{className:"text-center text-[8px] mt-0.5 text-gray-500",children:["W",t]})]},t)})})]},e)})})]},"compliance")]})]})}export{$ as default};
