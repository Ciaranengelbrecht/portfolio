const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-99Z_m9z_.js","./vendor-DTtRowIX.js","./charts-Cu4NAUVk.js","./index-DcAUyRax.css"])))=>i.map(i=>d[i]);
import{c as e,u as t,v as s,w as n,x as r,d as a,j as i,y as l,A as o,m as d,z as c,e as u,B as m,h as p,C as x,D as h,i as g,r as f}from"./index-99Z_m9z_.js";import{_ as b,r as v,a as w}from"./vendor-DTtRowIX.js";import{unlockAudio as y,setBeepVolumeScalar as N,playBeepStyle as j}from"./audio-C_woF4xN.js";import{c as S}from"./charts-Cu4NAUVk.js";import{g as k}from"./muscles-BJCGbWqM.js";function I(e){if(!e)return null;const t=e.match(/(\d+)\s*[-–]\s*(\d+)/);return t?[Number(t[1]),Number(t[2])]:null}function $(e){var t;const{recentSessions:s,exercise:n,repRange:r,incrementKg:a=2.5,addRepsFirst:i=!0,adaptive:l=!0,requireDoubleTop:o=!0,lookbackSessions:d=6,minDeloadPct:c=.07}=e;if(!s.length)return null;const u=I(r)||I(n.defaults.targetRepRange)||[8,12],[m,p]=u,x=[];for(let S=s.length-1;S>=0&&x.length<d;S--){const e=s[S].entries.find(e=>e.exerciseId===n.id);if(!e)continue;const t=e.sets.filter(e=>(e.reps||0)>0&&(e.weightKg||0)>0);if(!t.length)continue;const r=t.slice().sort((e,t)=>(t.weightKg||0)*(t.reps||0)-(e.weightKg||0)*(e.reps||0))[0];x.push({weight:r.weightKg||0,reps:r.reps||0})}if(!x.length)return null;const h=x[0],g=x[1],f=x[2];if(!l)return i?h.reps<p?{weightKg:h.weight,reps:Math.min(p,h.reps+1)}:{weightKg:h.weight+a,reps:m}:0===h.weight?{weightKg:(null==(t=null==n?void 0:n.defaults)?void 0:t.startWeight)||0,reps:m}:h.reps<((m+p)/2|0)?{weightKg:h.weight,reps:h.reps+1}:{weightKg:h.weight+a,reps:m};const b=h.reps>=p,v=!!g&&g.reps>=p,w=!!g&&h.weight===g.weight,y=!!f&&h.weight===f.weight,N=w&&y&&g&&f&&h.reps===g.reps&&g.reps===f.reps&&h.reps<p,j=h.reps<m;if(j&&g&&g.reps<m){const e=Math.max(a,Math.round(h.weight*c*2)/2);return{weightKg:Math.max(0,h.weight-e),reps:m}}if(j){const e=Math.min(m,h.reps+1);return{weightKg:h.weight,reps:e}}if(b)return!o||v&&w?{weightKg:h.weight+a,reps:m}:{weightKg:h.weight,reps:p};if(N){const e=a/2;if(e>=1)return{weightKg:h.weight+e,reps:Math.max(m,Math.min(p,h.reps))};if(h.reps<p)return{weightKg:h.weight,reps:Math.min(p,h.reps+1)}}return h.reps<p?{weightKg:h.weight,reps:Math.min(p,h.reps+1)}:{weightKg:h.weight+a,reps:m}}function C(e,t,s,n){const r={},a=e=>(e.phaseNumber||e.phase||1)<s,i=e=>(e.weightKg||0)>0||(e.reps||0)>0,l=(e,t)=>(t.phaseNumber||t.phase||1)-(e.phaseNumber||e.phase||1)||t.weekNumber-e.weekNumber,o=e=>{const t=[...e].sort(l);for(const s of t){if(null!=n){if(Number(String(s.id).split("-")[2]||0)!==n)continue}for(const e of s.entries){if(r[e.exerciseId])continue;const t=[...e.sets].filter(i).sort((e,t)=>{const s=t.weightKg??0,n=e.weightKg??0;return s!==n?s-n:(t.reps??0)-(e.reps??0)})[0];t&&(r[e.exerciseId]={week:s.weekNumber,set:t})}}if(null!=n){const t=[...e].sort(l);for(const e of t)for(const t of e.entries){if(r[t.exerciseId])continue;const s=[...t.sets].filter(i).sort((e,t)=>{const s=t.weightKg??0,n=e.weightKg??0;return s!==n?s-n:(t.reps??0)-(e.reps??0)})[0];s&&(r[t.exerciseId]={week:e.weekNumber,set:s})}}};if(o(e.filter(e=>(e=>(e.phaseNumber||e.phase||1)===s)(e)&&e.weekNumber<t)),0===Object.keys(r).length){o(e.filter(a))}return r}function D(e){if(null==e)return null;const t=e.trim().replace(",",".");if(""===t)return null;if(/^[+-]?\d+\.$/.test(t))return null;if(!/^[-+]?\d*(?:\.\d+)?$/.test(t))return null;const s=Number(t);return isNaN(s)?null:s}function A(e){if(!e.length)return 0;const t=[...e].sort((e,t)=>e-t),s=Math.floor(t.length/2);return t.length%2?t[s]:Math.round((t[s-1]+t[s])/2)}function M({open:l,onClose:o,session:d,weekNumber:c,onImported:u}){const[m,p]=v.useState([]),[x,h]=v.useState([]),[g,f]=v.useState(""),[w,y]=v.useState(!0),[N,j]=v.useState(!1),{program:S}=n(),k=S?r(S):void 0;v.useEffect(()=>{l&&(a.getAll("templates").then(p),a.getAll("exercises").then(h))},[l]);return l?i.jsx("div",{className:"fixed inset-0 bg-black/60 grid place-items-center",onClick:o,children:i.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-soft w-full max-w-sm",onClick:e=>e.stopPropagation(),children:[i.jsx("div",{className:"font-medium mb-2",children:"Import from Template"}),i.jsxs("label",{className:"space-y-1 block mb-2",children:[i.jsx("div",{className:"text-sm text-gray-300",children:"Template"}),i.jsxs("select",{className:"w-full bg-slate-800 rounded-xl px-3 py-2",value:g,onChange:e=>f(e.target.value),children:[i.jsx("option",{value:"",children:"Select…"}),m.map(e=>i.jsx("option",{value:e.id,children:e.name},e.id))]})]}),i.jsxs("label",{className:"flex items-center gap-2 mb-3 text-sm",children:[i.jsx("input",{type:"checkbox",checked:w,onChange:e=>y(e.target.checked)}),"Append to existing entries"]}),!w&&N&&i.jsx("div",{className:"bg-amber-900/30 border border-amber-700 text-amber-300 text-sm rounded p-2 mb-2",children:"This will replace all exercises for this session."}),i.jsxs("div",{className:"flex justify-end gap-2",children:[i.jsx("button",{className:"bg-slate-700 px-3 py-2 rounded-xl",onClick:o,children:"Cancel"}),i.jsx("button",{className:"bg-brand-600 hover:bg-brand-700 px-3 py-2 rounded-xl disabled:opacity-50",disabled:!g,onClick:async()=>{const n=m.find(e=>e.id===g);if(!n)return;if(!w&&!N)return void j(!0);const r=await async function(n,r,a,i){var l,o;const d=await e(),c=new Map(a.map(e=>[e.id,e]));let u;if(i.deloadWeeks&&i.deloadWeeks.has(i.weekNumber)){const e=await b(()=>import("./index-99Z_m9z_.js").then(e=>e._),__vite__mapDeps([0,1,2,3]),import.meta.url).then(e=>e.db.getAll("sessions"));u={sessions:e,exercises:a,settings:d}}const m=async e=>{var t,n;const a=null==(t=r.plan)?void 0:t.find(t=>t.exerciseId===e);if(i.deloadWeeks&&i.deloadWeeks.has(i.weekNumber)){const t=await s(e,i.weekNumber,{deloadWeeks:i.deloadWeeks},u);if(!t.inactive){const e=8;return Array.from({length:t.targetSets},(s,n)=>({setNumber:n+1,weightKg:t.targetWeight,reps:e}))}}const l=null==a?void 0:a.plannedSets,o=d.defaultSetRows??(null==(n=c.get(e))?void 0:n.defaults.sets)??3,m=null!=l?l:o,p=Math.min(12,Math.max(0,m));return 0===p?[]:Array.from({length:p},(e,t)=>({setNumber:t+1,weightKg:null,reps:null}))},p=[];for(const e of r.exerciseIds){const s=null==(l=r.plan)?void 0:l.find(t=>t.exerciseId===e),n={id:t(),exerciseId:e,sets:await m(e),targetRepRange:(null==s?void 0:s.repRange)||(null==(o=c.get(e))?void 0:o.defaults.targetRepRange)};p.push(n)}const x=i.append?[...n.entries||[],...p]:p;return{...n,entries:x}}(d,n,x,{append:w,weekNumber:c,deloadWeeks:k});await a.put("sessions",r),u(r,n.exerciseIds.length,n.name),o()},children:"Import"})]})]})}):null}function E({open:e,onClose:s,session:n,onSaved:r}){const[l,o]=v.useState(""),[d,c]=v.useState(!1);v.useEffect(()=>{if(e&&n){const e=(()=>{if(n.localDate)return`Workout ${n.localDate}`;return n.entries[0]?"Custom Workout":"Empty Workout"})();o(e)}},[e,null==n?void 0:n.id]);const u=!n||!n.entries.length||!l.trim();return e?i.jsx("div",{className:"fixed inset-0 bg-black/60 grid place-items-center z-50",onClick:s,children:i.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-soft w-full max-w-sm",onClick:e=>e.stopPropagation(),children:[i.jsx("div",{className:"font-medium mb-2",children:"Save as Template"}),i.jsxs("label",{className:"space-y-1 block mb-3",children:[i.jsx("div",{className:"text-sm text-gray-300",children:"Template name"}),i.jsx("input",{className:"w-full bg-slate-800 rounded-xl px-3 py-2",value:l,onChange:e=>o(e.target.value),placeholder:"My Push Day",maxLength:60,autoFocus:!0})]}),i.jsxs("div",{className:"text-xs text-gray-400 mb-4",children:[null==n?void 0:n.entries.length," exercises will be saved with their set counts."]}),i.jsxs("div",{className:"flex justify-end gap-2",children:[i.jsx("button",{className:"bg-slate-700 px-3 py-2 rounded-xl",onClick:s,disabled:d,children:"Cancel"}),i.jsx("button",{className:"bg-brand-600 hover:bg-brand-700 px-3 py-2 rounded-xl disabled:opacity-50",disabled:u||d,onClick:async()=>{if(!u){c(!0);try{const e=[],i=[];for(const t of n.entries)e.push(t.exerciseId),i.push({exerciseId:t.exerciseId,plannedSets:t.sets.length,repRange:t.targetRepRange||"?",progression:void 0});const o={id:t(),name:l.trim().slice(0,60),exerciseIds:e,plan:i};await a.put("templates",o),r(o),s()}catch(e){}finally{c(!1)}}},children:d?"Saving…":"Save"})]})]})}):null}let K=null;function L({value:t,onChange:s,variant:n="default"}){const[r,a]=v.useState(t??1),[o,d]=v.useState("");v.useEffect(()=>{"number"==typeof t&&a(t)},[t]);const c=async n=>{var i;const o=t??r,c=function(e,t=1){return Math.max(t,Math.round(e))}(n);if(c>o){if(!window.confirm("Move to phase "+c+"? You should only advance after completing current phase."))return}else if(c<o&&!window.confirm("Revert to phase "+c+"? Progress indicators will recalc based on earlier data."))return;a(c),d(c!==n?"Min phase is 1":""),null==s||s(c);const u=await e();await l({...u,currentPhase:c,dashboardPrefs:{...u.dashboardPrefs||{},lastLocation:{...(null==(i=u.dashboardPrefs)?void 0:i.lastLocation)||{weekNumber:1,dayId:0},phaseNumber:c}}})};return"compact"===n?i.jsxs("div",{className:"flex flex-col gap-1 text-[11px] text-white/70",children:[i.jsxs("div",{className:"flex items-center gap-1.5 rounded-full border border-white/10 bg-slate-950/60 px-2 py-1 shadow-[0_6px_20px_-18px_rgba(59,130,246,0.8)]",children:[i.jsx("button",{type:"button","aria-label":"Previous phase",className:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-slate-900/70 text-sm text-white/80 transition hover:bg-slate-800 hover:text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-400/60 active:scale-95",onClick:()=>c(r-1),children:"−"}),i.jsx("div",{className:"flex items-center gap-1 px-1 text-[10px] uppercase tracking-[0.32em] text-white/40",children:"Phase"}),i.jsx("input",{className:"h-6 w-12 rounded-md border border-white/10 bg-slate-900/70 px-2 text-center text-sm font-semibold text-white/90 transition focus:border-emerald-400/60 focus:outline-none focus:ring-1 focus:ring-emerald-400/40",inputMode:"numeric",value:r,"aria-label":"Current phase",onChange:e=>{const t=e.target.value;/^\d*$/.test(t)&&a(Number(t||"1"))},onBlur:()=>c(r),onKeyDown:e=>{"Enter"===e.key&&c(r),"ArrowUp"===e.key&&c(r+1),"ArrowDown"===e.key&&c(r-1)}}),i.jsx("button",{type:"button","aria-label":"Next phase",className:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-emerald-400/20 text-sm font-semibold text-emerald-200 transition hover:bg-emerald-400/30 hover:text-emerald-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-400/60 active:scale-95",onClick:()=>c(r+1),children:"+"})]}),o&&i.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-medium text-amber-200/80",children:[i.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-amber-300"}),o]})]}):i.jsxs("div",{className:"flex flex-wrap items-center gap-2 rounded-xl border border-white/8 bg-slate-950/65 px-2 py-2 shadow-[0_10px_30px_-24px_rgba(59,130,246,0.75)]",children:[i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsxs("button",{type:"button","aria-label":"Previous phase",className:S("group relative inline-flex h-9 w-9 items-center justify-center overflow-hidden rounded-full border border-white/10 bg-slate-900/70 text-base font-semibold text-white/90 transition-all duration-150","hover:border-white/25 hover:text-white focus-visible:outline focus-visible:outline-[rgba(99,102,241,0.75)] focus-visible:outline-offset-2 active:scale-95"),onClick:()=>c(r-1),children:[i.jsx("span",{className:"relative z-10",children:"−"}),i.jsx("span",{className:"absolute inset-0 opacity-0 transition-opacity duration-150 group-hover:opacity-100 bg-[radial-gradient(circle_at_center,rgba(148,163,255,0.28),transparent_70%)]"})]}),i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"pointer-events-none absolute inset-x-2 top-0 h-0.5 bg-gradient-to-r from-transparent via-white/25 to-transparent"}),i.jsx("input",{className:"h-9 w-16 rounded-lg border border-white/10 bg-slate-900/70 px-3 text-center text-sm font-semibold tracking-wide text-white/90 transition focus:border-[var(--accent)]/60 focus:outline-none focus:ring-2 focus:ring-[var(--accent)]/35",inputMode:"numeric",value:r,"aria-label":"Current phase",onChange:e=>{const t=e.target.value;/^\d*$/.test(t)&&a(Number(t||"1"))},onBlur:()=>c(r),onKeyDown:e=>{"Enter"===e.key&&c(r),"ArrowUp"===e.key&&c(r+1),"ArrowDown"===e.key&&c(r-1)}})]}),i.jsxs("button",{type:"button","aria-label":"Next phase",className:S("group relative inline-flex h-9 w-9 items-center justify-center overflow-hidden rounded-full border border-white/10 bg-gradient-to-br from-sky-500 via-[var(--accent)] to-indigo-500 text-base font-semibold text-slate-950 transition-all duration-150","hover:brightness-105 focus-visible:outline focus-visible:outline-[rgba(59,130,246,0.55)] focus-visible:outline-offset-2 active:scale-95"),onClick:()=>c(r+1),children:[i.jsx("span",{className:"relative z-10",children:"+"}),i.jsx("span",{className:"absolute inset-0 opacity-0 transition-opacity duration-150 group-active:opacity-100 bg-[radial-gradient(circle_at_center,rgba(255,255,255,0.26),transparent_70%)]"})]})]}),o&&i.jsxs("div",{className:"flex items-center gap-1 rounded-full border border-amber-400/30 bg-amber-500/10 px-3 py-1 text-[11px] font-medium text-amber-200",children:[i.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-amber-300"}),o]})]})}const R="undefined"!=typeof document?document.body:null;function P({open:e,title:t,description:s,onClose:n,searchValue:r,onSearchChange:a,searchPlaceholder:l,searchLabel:c,initialFocus:u="search",options:m,emptyState:p,highlight:x,footer:h,primaryAction:g,maxListHeight:f=520}){const b=v.useRef(null),y=v.useRef(null),N=v.useRef(null),j=v.useId(),S=v.useRef(n);v.useEffect(()=>{S.current=n},[n]),v.useEffect(()=>{if(!e)return;N.current=document.activeElement;const t=(null==R?void 0:R.style.overflow)||"";R&&(R.style.overflow="hidden");const s=e=>{var t;"Escape"===e.key&&(e.preventDefault(),null==(t=S.current)||t.call(S))};document.addEventListener("keydown",s);const n="search"===u?b:y;return requestAnimationFrame(()=>{var e;const t=n.current;if(t)if(t instanceof HTMLInputElement)document.activeElement!==t&&(t.focus({preventScroll:!0}),null==(e=t.select)||e.call(t));else{const e=t.querySelector("[data-option]");e&&document.activeElement!==e&&e.focus()}}),()=>{var e,n;document.removeEventListener("keydown",s),R&&(R.style.overflow=t),null==(n=null==(e=N.current)?void 0:e.focus)||n.call(e,{preventScroll:!0}),N.current=null}},[e,u]);const k=v.useMemo(()=>e?i.jsx(o,{children:e?i.jsxs(d.div,{className:"fixed inset-0 z-[1200] flex items-end sm:items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[i.jsx(d.div,{className:"absolute inset-0 bg-slate-950/80 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.18},onClick:n}),i.jsx(d.div,{className:"relative z-10 w-full max-h-[92vh] overflow-hidden rounded-t-3xl border border-white/10 bg-slate-950/95 backdrop-blur-sm shadow-[0_24px_70px_-30px_rgba(15,118,110,0.7)] sm:max-w-2xl sm:rounded-3xl",role:"dialog","aria-modal":"true","aria-labelledby":j,initial:{y:48,opacity:0},animate:{y:0,opacity:1},exit:{y:40,opacity:0},transition:{type:"spring",stiffness:300,damping:34},children:i.jsxs("div",{className:"flex flex-col gap-4 p-5",children:[i.jsxs("header",{className:"flex flex-col gap-2 pr-8",children:[i.jsxs("div",{className:"flex items-center justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("h2",{id:j,className:"text-lg font-semibold text-white",children:t}),s?i.jsx("p",{className:"mt-1 text-sm text-slate-300/80",children:s}):null]}),i.jsx("button",{className:"shrink-0 rounded-full border border-white/10 bg-white/10 px-3 py-1 text-xs font-medium text-white/80 transition hover:bg-white/20 hover:text-white",onClick:n,children:"Close"})]}),a?i.jsxs("label",{className:"block text-xs font-medium uppercase tracking-[0.3em] text-white/40",children:[c||"Search",i.jsx("input",{ref:b,className:"mt-1 w-full rounded-2xl border border-white/10 bg-slate-900/70 px-3 py-2 text-sm text-white/90 placeholder:text-white/40 focus:border-emerald-400/60 focus:outline-none focus:ring-2 focus:ring-emerald-400/40",placeholder:l,value:r,onChange:e=>null==a?void 0:a(e.target.value),type:"search",spellCheck:!1})]}):null,x]}),i.jsxs("div",{ref:y,tabIndex:-1,className:"relative -mx-2 flex-1 overflow-y-auto px-2 pb-2",style:{maxHeight:`min(68vh, ${f}px)`},children:[i.jsx("div",{className:"pointer-events-none absolute inset-x-2 top-0 h-4 bg-gradient-to-b from-slate-950/95 to-transparent"}),i.jsx("div",{className:"pointer-events-none absolute inset-x-2 bottom-0 h-6 bg-gradient-to-t from-slate-950/95 to-transparent"}),i.jsxs("div",{className:"relative space-y-2 pb-4",children:[0===m.length&&p,m.map(e=>i.jsx(v.Fragment,{children:i.jsx("button",{"data-option":!0,type:"button",disabled:e.disabled,onClick:()=>{e.disabled||e.onSelect()},className:`group w-full rounded-2xl border border-white/10 px-4 py-3 text-left transition focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400/50 focus-visible:ring-offset-0 ${e.selected?"border-emerald-400/60 bg-emerald-400/10 shadow-[0_0_0_1px_rgba(16,185,129,0.45)]":"bg-white/5 hover:border-white/20 hover:bg-white/10"} ${e.disabled?"opacity-50":""}`,children:i.jsxs("div",{className:"flex items-start gap-3",children:[e.icon?i.jsx("div",{className:"mt-0.5 text-white/80",children:e.icon}):null,i.jsxs("div",{className:"min-w-0 flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"truncate text-base font-medium text-white",children:e.label}),e.badge?i.jsx("span",{className:"rounded-full bg-white/10 px-2 py-0.5 text-[11px] font-medium uppercase tracking-wide text-white/70",children:e.badge}):null]}),e.description?i.jsx("p",{className:"mt-1 text-sm text-white/70",children:e.description}):null,e.hint?i.jsx("p",{className:"mt-1 text-xs uppercase tracking-[0.25em] text-white/40",children:e.hint}):null,e.detail?i.jsx("div",{className:"mt-3 space-y-1 text-sm text-white/80",children:e.detail}):null]}),e.trailing?i.jsx("div",{className:"text-xs text-white/60",children:e.trailing}):null]})})},e.id))]})]}),g?i.jsx("button",{type:"button",className:"rounded-2xl border border-emerald-400/40 bg-emerald-500/20 px-4 py-3 text-sm font-semibold text-emerald-100 transition hover:bg-emerald-500/30",onClick:g.onClick,children:g.label}):null,h]})})]},"option-sheet"):null}):null,[e,n,t,s,r,a,l,c,x,m,p,g,h,f]);return R?w.createPortal(k,R):null}const T=2.2046226218;function _({session:e,exMap:t,exNameCache:s}){const n=v.useMemo(()=>{const s=function(e,t){var s;if(!e)return{};const n={};for(const r of e.entries){const e=t.get(r.exerciseId);if(!e)continue;const a=r.sets.filter(e=>e.completedAt&&(e.reps||0)>0).length;if(0!==a&&(e.muscleGroup&&(n[e.muscleGroup]=(n[e.muscleGroup]||0)+a),null==(s=e.secondaryMuscles)?void 0:s.length)){const t=.5;for(const s of e.secondaryMuscles)n[s]=(n[s]||0)+a*t}}return n}(e,t),n=["chest","back","shoulders","biceps","triceps","forearms","quads","hamstrings","glutes","calves","core","other"];return Object.entries(s).filter(([,e])=>e>0).sort((e,t)=>n.indexOf(e[0])-n.indexOf(t[0]))},[e.id,e.entries.length,t]);return 0===e.entries.length?null:i.jsxs("div",{className:"sticky top-0 z-20 -mt-1 mb-1 pt-1 space-y-1",children:[n.length>0&&i.jsx("div",{className:"flex gap-1.5 overflow-x-auto scrollbar-none px-1 py-1 rounded-xl bg-slate-900/70 backdrop-blur supports-[backdrop-filter]:bg-slate-900/50 border border-white/5",children:n.map(([e,t])=>{const s=k(e);return i.jsxs("div",{className:"badge-muscle icon-glow","aria-label":`${e} working sets ${t}`,children:[s?i.jsx("img",{src:s,alt:e,className:"w-6 h-6 object-contain"}):i.jsx("span",{className:"w-6 h-6"}),i.jsx("span",{className:"tabular-nums leading-none",children:t})]},e)})}),i.jsx("div",{className:"flex gap-1 overflow-x-auto scrollbar-none px-1 py-1 rounded-xl bg-slate-900/60 backdrop-blur supports-[backdrop-filter]:bg-slate-900/40 border border-white/5",children:e.entries.map((e,n)=>{const r=t.get(e.exerciseId),a=(null==r?void 0:r.name)||s[e.exerciseId]||`Ex ${n+1}`,l=a.length>18?a.slice(0,16)+"…":a;return i.jsx("button",{onClick:()=>{const t=document.getElementById(`exercise-${e.id}`);t&&t.scrollIntoView({behavior:"smooth",block:"start"})},className:"text-[10px] leading-none px-2 py-1 rounded-lg bg-slate-700/60 hover:bg-slate-600/70 active:scale-95 transition text-slate-200 whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-emerald-500/50",children:l},e.id)})})]})}const O=["Upper A","Lower A","Upper B","Lower B","Upper C","Lower C","Rest"],F={chest:"Chest",back:"Back",shoulders:"Shoulders",biceps:"Biceps",triceps:"Triceps",forearms:"Forearms",quads:"Quads",hamstrings:"Hamstrings",glutes:"Glutes",calves:"Calves",core:"Core",traps:"Traps",lats:"Lats",delts:"Delts",upper_back:"Upper Back",lower_back:"Lower Back",abs:"Abs",cardio:"Cardio",conditioning:"Conditioning",mobility:"Mobility",other:"Other"},W=e=>e?F[e]||e.replace(/[-_]/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"General";function B(){var f,b,w,S;const{program:I}=n(),[R,F]=v.useState(1),[B,J]=v.useState(1),[Q,X]=v.useState(!1),Z=v.useRef(null),[ee,te]=v.useState(0),[se,ne]=v.useState(!1),[re,ae]=v.useState([]),[ie,le]=v.useState([]),[oe,de]=v.useState({}),[ce,ue]=v.useState(new Map),[me,pe]=v.useState(null),[xe,he]=v.useState(!1),[ge,fe]=v.useState(""),[be,ve]=v.useState("all"),[we,ye]=v.useState(null),{push:Ne}=c(),[je,Se]=v.useState(!1),[ke,Ie]=v.useState(!1),[$e,Ce]=v.useState(!1),[De,Ae]=v.useState(null),[Me,Ee]=v.useState(!1),[Ke,Le]=v.useState(null),Re=v.useRef(0),[Pe,Te]=v.useState(null),[_e,Oe]=v.useState(""),[Fe,We]=v.useState("group");v.useEffect(()=>{if(!Pe)return We("group"),void Oe("");We("group"),Oe("")},[null==Pe?void 0:Pe.entryId]);const[Be,Ue]=v.useState(null),[ze,Ge]=v.useState(!0),[Ve,He]=v.useState({}),[Ye,qe]=v.useState(null),[Je,Qe]=v.useState(!1),[Xe,Ze]=v.useState(null),[et,tt]=v.useState({}),[st,nt]=v.useState(!1),[rt,at]=v.useState(!1),[it,lt]=v.useState(!1),ot=v.useRef(!1),[dt,ct]=v.useState({}),ut=3e5,[mt,pt]=v.useState(0),[xt,ht]=v.useState(!1),[gt,ft]=v.useState(""),[bt,vt]=v.useState(!1),[wt,yt]=v.useState(!1),Nt=v.useRef(null),jt=v.useRef({}),St=v.useRef({}),[kt,It]=v.useState({}),[$t,Ct]=v.useState(!1),[Dt,At]=v.useState(null),Mt=v.useRef(null),Et=e=>It(t=>({...t,[e]:!t[e]})),[Kt,Lt]=v.useState(null),Rt=v.useRef(!1);v.useEffect(()=>{if(null==me?void 0:me.id)try{const e=sessionStorage.getItem(`collapsedEntries:${me.id}`);e&&It(JSON.parse(e))}catch{}},[null==me?void 0:me.id,null==I?void 0:I.id,null==I?void 0:I.mesoWeeks,null==I?void 0:I.deload]),v.useEffect(()=>{if((null==me?void 0:me.id)&&!$t)try{sessionStorage.setItem(`collapsedEntries:${me.id}`,JSON.stringify(kt))}catch{}},[kt,null==me?void 0:me.id,$t]);const Pt=()=>{if(!me)return;$t&&(Ct(!1),At(null),Mt.current=null);const e={};for(const t of me.entries)e[t.id]=!0;It(e)},Tt=()=>{if(!me)return;$t&&(Ct(!1),At(null),Mt.current=null);const e={};for(const t of me.entries)e[t.id]=!1;It(e)};v.useMemo(()=>Object.values(kt).some(e=>e),[kt]);const _t=v.useMemo(()=>!!(null==me?void 0:me.entries.length)&&me.entries.every(e=>kt[e.id]),[kt,null==me?void 0:me.entries.length]),Ot=v.useCallback(()=>{Ct(!1),At(null),It(e=>{const t=Mt.current;if(t){const e={};for(const s of Object.keys(t))e[s]=t[s];if(null==me?void 0:me.entries)for(const t of me.entries)void 0===e[t.id]&&(e[t.id]=!1);return e}if(null==me?void 0:me.entries){const e={};for(const t of me.entries)e[t.id]=!1;return e}return e}),Mt.current=null},[me]),Ft=v.useCallback(e=>{var t;if("undefined"==typeof window)return;const s=document.getElementById(`exercise-${e}`);if(!s)return;let n=0;try{const e=getComputedStyle(document.documentElement).getPropertyValue("--app-header-h").trim(),t=parseFloat(e);Number.isNaN(t)||(n=t)}catch{}const r=n+((null==(t=Nt.current)?void 0:t.offsetHeight)??0)+16,a=s.getBoundingClientRect().top+window.scrollY-r;window.scrollTo({top:Math.max(0,a),behavior:"smooth"})},[]),Wt=v.useCallback(e=>{if(!me)return;if($t&&e===Dt)return void Ot();$t||(Mt.current={...kt}),Ct(!0),At(e);const t={};for(const s of me.entries)t[s.id]=s.id!==e;It(t),requestAnimationFrame(()=>Ft(e))},[me,$t,Dt,kt,Ot,Ft]);v.useEffect(()=>{$t&&(me?Dt&&!me.entries.some(e=>e.id===Dt)&&Ot():Ot())},[$t,me,Dt,Ot]);const Bt=function(e){const t=v.useMemo(()=>e.map(e=>e.id).join(","),[e]);return v.useMemo(()=>new Map(e.map(e=>[e.id,e])),[t])}(ie),Ut=v.useMemo(()=>{var e,t,s;if(!me||0===me.entries.length)return null;const n=new Map;if(me.templateId){const t=re.find(e=>e.id===me.templateId);if(null==(e=null==t?void 0:t.plan)?void 0:e.length)for(const e of t.plan)n.set(e.exerciseId,{plannedSets:e.plannedSets,repRange:e.repRange})}let r=0,a=0,i=0,l=0,o=0,d=0;const c=[],u=new Map;let m=0;for(const h of me.entries){const e=Bt.get(h.exerciseId),p=(null==e?void 0:e.name)||oe[h.exerciseId]||"Untitled",x=(null==e?void 0:e.muscleGroup)||"other",g=(null==(t=n.get(h.exerciseId))?void 0:t.plannedSets)??h.sets.length,f=h.sets.filter(e=>(e.reps||0)>0||(e.weightKg||0)>0).length,b=Math.max(0,g-f),v=h.sets.reduce((e,t)=>e+(t.weightKg||0)*(t.reps||0),0);f>0&&d++,r+=g,a+=f,i+=Math.min(f,g),l+=v;for(const t of h.sets){const n=(t.weightKg||0)*(t.reps||0);n>0&&n>=50*((null==(s=null==e?void 0:e.defaults)?void 0:s.sets)||3)&&o++}const w=u.get(x)||{workingSets:0,totalSets:0,tonnage:0};w.workingSets+=f,w.totalSets+=g,w.tonnage+=v,u.set(x,w),b>0&&c.push({entryId:h.id,name:p,missingSets:b,totalSets:g,muscle:x,order:m,workingSets:f}),m+=1}const p=Array.from(u.entries()).map(([e,t])=>({muscle:e,workingSets:t.workingSets,totalSets:t.totalSets,tonnage:t.tonnage})).sort((e,t)=>t.workingSets-e.workingSets||t.tonnage-e.tonnage),x=r?Math.round(i/r*100):a>0?100:0;return{plannedSets:r,completedSets:a,completionPct:Math.max(0,Math.min(100,x)),totalVolume:l,prSignals:o,totalExercises:me.entries.length,completedExercises:d,muscleLoad:p,incompleteExercises:c}},[me,re,Bt,oe]),zt=v.useRef(!1);v.useEffect(()=>{try{zt.current="1"===localStorage.getItem("debugSessions")}catch{}},[]),v.useEffect(()=>{(async()=>{var t;try{const s=new Promise((e,t)=>setTimeout(()=>t(new Error("getSettings timeout")),5e3)),n=await Promise.race([e(),s]);let r=!1;try{r="1"===sessionStorage.getItem("lastLocationIntent"),sessionStorage.removeItem("lastLocationIntent")}catch{}if(!Rt.current||r){J(n.currentPhase||1);const e=null==(t=n.dashboardPrefs)?void 0:t.lastLocation;e&&(zt.current,F(e.weekNumber),te(e.dayId)),zt.current,r&&(Rt.current=!0)}}catch(s){}finally{ne(!0)}})()},[]),v.useEffect(()=>{try{const e=localStorage.getItem("exerciseNamesCache");e&&de(JSON.parse(e))}catch{}},[]),v.useEffect(()=>{if(!me)return;if(!ie.length)return;const e=new Map(ie.map(e=>[e.id,e.name])),t={};for(const s of me.entries){const n=e.get(s.exerciseId);n&&oe[s.exerciseId]!==n&&(t[s.exerciseId]=n)}if(Object.keys(t).length){const e={...oe,...t};de(e);try{localStorage.setItem("exerciseNamesCache",JSON.stringify(e))}catch{}}},[ie,null==me?void 0:me.id,null==(f=null==me?void 0:me.entries)?void 0:f.length]),v.useMemo(()=>!!me&&(!(!ie.length&&me.entries.length>0)&&me.entries.every(e=>Bt.has(e.exerciseId))),[null==me?void 0:me.id,null==(b=null==me?void 0:me.entries)?void 0:b.length,ie.length,Bt]),v.useEffect(()=>{try{const e=localStorage.getItem("weeklyLabelsCache");e&&Lt(JSON.parse(e))}catch{}},[]),v.useEffect(()=>{try{if((null==I?void 0:I.weeklySplit)&&Array.isArray(I.weeklySplit)){const e=I.weeklySplit.map(e=>(null==e?void 0:e.customLabel)||(null==e?void 0:e.type)||"Day");Lt(e),localStorage.setItem("weeklyLabelsCache",JSON.stringify(e))}}catch{}},[null==I?void 0:I.id,null==(w=null==I?void 0:I.weeklySplit)?void 0:w.length]),v.useEffect(()=>{(async()=>{var e;if(null==(e=null==Xe?void 0:Xe.progress)?void 0:e.autoProgression){if(me)try{const[e,t]=await Promise.all([u("exercises",{swr:!0}),u("sessions",{swr:!0})]),s=me.entries.map(e=>e.exerciseId),n=e.filter(e=>s.includes(e.id)),a=I?r(I):new Set,i=function(e,t,s={}){var n;const r=s.window??6,a=e=>e.phaseNumber??e.phase??1,i=e=>e.weekNumber??0,l=e=>e&&Date.parse(e)||0;let o=t.filter(e=>!e.deletedAt);s.matchTemplateId?o=o.filter(e=>e.templateId===s.matchTemplateId):s.matchDayName&&(o=o.filter(e=>e.dayName===s.matchDayName)),o=o.slice().sort((e,t)=>{const s=a(e)-a(t);if(0!==s)return s;const n=i(e)-i(t);if(0!==n)return n;const r=l(e.dateISO)-l(t.dateISO);return 0!==r?r:l(e.updatedAt)-l(t.updatedAt)});const d=s.currentSession||null;if(d){const e=a(d),t=i(d);if(o=o.filter(s=>{const n=a(s),r=i(s);return!(n>e||n===e&&r>=t)}),1===t&&(null==(n=s.deloadWeeks)?void 0:n.size)){const n=o.slice();for(;n.length;){const r=n[n.length-1],l=a(r),o=i(r);if(l===e&&o>=t)n.pop();else{if(!(l<e&&s.deloadWeeks.has(o)))break;n.pop()}}o=n}}const c=o.slice(-r),u=s.onlyExerciseIds?new Set(s.onlyExerciseIds):null,m=new Map;for(const p of e){if(u&&!u.has(p.id))continue;const e=$({recentSessions:c,exercise:p,addRepsFirst:s.addRepsFirst,adaptive:s.adaptive});e&&m.set(p.id,e)}return m}(n,t,{matchTemplateId:me.templateId,matchDayName:me.templateId?void 0:me.dayName,onlyExerciseIds:s,adaptive:!0,currentSession:me,deloadWeeks:a});ue(i)}catch{}}else ue(new Map)})()},[null==me?void 0:me.id,null==me?void 0:me.templateId,null==me?void 0:me.dayName,null==me?void 0:me.weekNumber,null==me?void 0:me.phaseNumber,null==(S=null==Xe?void 0:Xe.progress)?void 0:S.autoProgression,null==I?void 0:I.id,null==I?void 0:I.mesoWeeks,null==I?void 0:I.deload]),v.useEffect(()=>{let e=!1;const t=async()=>{if(e)return;await y()&&(e=!0,window.removeEventListener("pointerdown",t),window.removeEventListener("keydown",t),window.removeEventListener("touchstart",t))};return window.addEventListener("pointerdown",t,{passive:!0}),window.addEventListener("touchstart",t,{passive:!0}),window.addEventListener("keydown",t),()=>{window.removeEventListener("pointerdown",t),window.removeEventListener("touchstart",t),window.removeEventListener("keydown",t)}},[]),v.useEffect(()=>{(async()=>{if(!ot.current){try{if("1"===sessionStorage.getItem("lastLocationIntent"))return void(Rt.current=!0)}catch{}try{const t=await a.getAll("sessions");let s=!1;const n=e=>{var t;return null==(t=e.entries)?void 0:t.some(e=>e.sets.some(e=>(e.weightKg||0)>0||(e.reps||0)>0))};for(const e of t)n(e)&&!e.loggedEndAt&&(e.loggedEndAt=e.updatedAt||e.createdAt||e.dateISO,s=!0),n(e)&&!e.loggedStartAt&&(e.loggedStartAt=e.loggedEndAt||e.updatedAt||e.createdAt||e.dateISO,s=!0);if(s)for(const e of t)if(e.loggedEndAt&&e.loggedStartAt)try{await a.put("sessions",e)}catch{}const r=e=>{var t;const s=(e.localDate||(null==(t=e.dateISO)?void 0:t.slice(0,10))||"").replace(/-/g,"");return/^\d{8}$/.test(s)?Number(s):0},i=e=>{const t=e=>e&&new Date(e).getTime()||0;return Math.max(t(e.loggedEndAt),t(e.loggedStartAt),t(e.updatedAt),t(e.createdAt),t(e.dateISO))},o=t.filter(n);if(!o.length)return void(ot.current=!0);o.sort((e,t)=>{const s=r(t)-r(e);if(0!==s)return s;const n=i(t)-i(e);if(0!==n)return n;if((t.weekNumber||0)!==(e.weekNumber||0))return(t.weekNumber||0)-(e.weekNumber||0);const a=Number(e.id.split("-")[2]||0);return Number(t.id.split("-")[2]||0)-a});const d=o[0];if(zt.current){o.find(e=>r(e)>r(d))}if(zt.current)try{o.slice(0,12).forEach(e=>{})}catch{}const c=d.id.split("-");if(3===c.length){const e=Number(c[0]),t=Number(c[1]),s=Number(c[2]);isNaN(e)||isNaN(t)||isNaN(s)||(J(e),F(t),te(s))}ot.current=!0,Rt.current=!0;try{const t=await e();await l({...t,dashboardPrefs:{...t.dashboardPrefs||{},lastLocation:{phaseNumber:Number(c[0])||d.phaseNumber||d.phase||1,weekNumber:Number(c[1])||d.weekNumber,dayId:Number(c[2])||0,sessionId:d.id}}})}catch{}}catch(t){}}})()},[]),v.useEffect(()=>{(async()=>{if(it)return;const e=await a.getAll("sessions");if(!e.length)return void lt(!0);const t=e.filter(e=>(e.phaseNumber||e.phase||1)===B),s=e=>{const t=e=>e&&new Date(e).getTime()||0;return Math.max(t(e.loggedEndAt),t(e.loggedStartAt),t(e.updatedAt),t(e.createdAt),t(e.dateISO))},n=new Map;for(const a of t){if(!a.entries.some(e=>e.sets.some(e=>(e.weightKg||0)>0||(e.reps||0)>0))||"number"!=typeof a.weekNumber)continue;const e=s(a);e>(n.get(a.weekNumber)??-1/0)&&n.set(a.weekNumber,e)}if(!n.size)return void lt(!0);let r=R,i=-1/0;for(const[a,l]of n.entries())(l>i||l===i&&a>r)&&(r=a,i=l);r!==R&&F(r),lt(!0)})()},[B,it,R]),v.useEffect(()=>{(async()=>{if(Q)return;const t=await a.getAll("sessions"),s=t.filter(e=>(e.phaseNumber||e.phase||1)===B);if(B>1){if(!s.some(e=>e.entries.some(e=>e.sets.some(e=>(e.weightKg||0)>0||(e.reps||0)>0)))){const s=new Set;for(const e of t)e.entries.some(e=>e.sets.some(e=>(e.weightKg||0)>0||(e.reps||0)>0))&&s.add(e.phaseNumber||e.phase||1);if(s.size){const t=[...s].sort((e,t)=>t-e)[0];if(t!==B){J(t);const s=await e();await l({...s})}}}}})()},[B,Q]),v.useEffect(()=>{(async()=>{if(!I)return void pt(0);const e=(await a.getAll("sessions")).filter(e=>(e.phaseNumber||e.phase||1)===B),t=new Set;for(const s of e)s.entries.some(e=>e.sets.some(e=>(e.weightKg||0)>0||(e.reps||0)>0))&&t.add(s.weekNumber);pt(Math.min(100,Math.round(t.size/(I.mesoWeeks||1)*100)))})()},[B,R,null==me?void 0:me.id,I]),v.useEffect(()=>{const e=e=>{if("/"!==e.key||e.metaKey||e.ctrlKey||(e.preventDefault(),he(!0)),"Enter"===e.key&&e.shiftKey){const t=document.activeElement;if("INPUT"===(null==t?void 0:t.tagName)){const s=[...document.querySelectorAll('input[data-set-input="true"]')],n=s.indexOf(t);n>=0&&n<s.length-1&&(s[n+1].focus(),e.preventDefault())}}if((e.metaKey||e.ctrlKey)&&"d"===e.key.toLowerCase()){const t=document.activeElement,s=null==t?void 0:t.dataset.entryId,n=Number(null==t?void 0:t.dataset.setNumber);if(s&&n){const t=null==me?void 0:me.entries.find(e=>e.id===s),r=null==t?void 0:t.sets.find(e=>e.setNumber===n);if(t&&r){const s={...r,setNumber:t.sets.length+1};!function(e){if(!me)return;const t=me.entries.find(t=>t.id===e.id);let s=e;if(t){const n=me.dateISO.slice(0,10);s={...e,sets:e.sets.map((e,s)=>{const r=t.sets[s];if(r&&((r.weightKg||0)!==(e.weightKg||0)||(r.reps||0)!==(e.reps||0))){const t=new Date,[s,r,a]=n.split("-").map(Number);t.setFullYear(s,(r||1)-1,a||t.getDate());const i=t.toISOString();return{...e,completedAt:i}}return e})}}const n={...me,entries:me.entries.map(t=>t.id===e.id?s:t)};Yt(me,n)}({...t,sets:[...t.sets,s]}),e.preventDefault()}}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[me]),v.useEffect(()=>{let e;const t=()=>{ct(e=>{var t;const s=Date.now(),n=1e3*((null==Xe?void 0:Xe.restTimerTargetSeconds)||90),r={};for(const[a,i]of Object.entries(e)){if(i.finished){s-(i.start+i.elapsed)<1200&&(r[a]=i);continue}if(!i.running){r[a]=i;continue}let e=i.start;e<1e10&&(e=s-i.elapsed);const l=s-e;if(l>=ut)r[a]={...i,start:e,elapsed:ut,running:!1,finished:!0,alerted:!0};else if(l>=n&&!i.alerted){if(!1!==(null==Xe?void 0:Xe.haptics))try{null==(t=navigator.vibrate)||t.call(navigator,[16,70,18,70,18])}catch{}!1!==(null==Xe?void 0:Xe.restTimerBeep)&&(async()=>{try{await y();const e=Math.max(30,Math.min(300,(null==Xe?void 0:Xe.restTimerBeepVolume)??140));N(e/100);const t=(null==Xe?void 0:Xe.restTimerBeepStyle)??"gentle",s=Math.max(1,Math.min(5,(null==Xe?void 0:Xe.restTimerBeepCount)??2));j(t,s)}catch{}})(),r[a]={...i,start:e,elapsed:l,alerted:!0}}else r[a]={...i,start:e,elapsed:l}}return r}),e=requestAnimationFrame(t)};return e=requestAnimationFrame(t),()=>cancelAnimationFrame(e)},[null==Xe?void 0:Xe.restTimerTargetSeconds,null==Xe?void 0:Xe.haptics,null==Xe?void 0:Xe.restTimerBeep,null==Xe?void 0:Xe.restTimerBeepStyle,null==Xe?void 0:Xe.restTimerBeepCount,null==Xe?void 0:Xe.restTimerBeepVolume]);const Gt=e=>{var t;if(ct(()=>({[e]:{start:Date.now(),elapsed:0,running:!0}})),!1!==(null==Xe?void 0:Xe.haptics))try{null==(t=navigator.vibrate)||t.call(navigator,[8,30,14])}catch{}},Vt=e=>{var t;if(ct(t=>{const s={...t};return s[e]&&delete s[e],s}),!1!==(null==Xe?void 0:Xe.haptics))try{null==(t=navigator.vibrate)||t.call(navigator,12)}catch{}},Ht=e=>{const t=dt[e];if(!t)return null;const s=t.elapsed,n=s/1e3,r=Math.floor(n/60),a=Math.floor(n)%60,l=Math.floor(s%1e3/10),o=(null==Xe?void 0:Xe.restTimerTargetSeconds)||90,d=!1!==(null==Xe?void 0:Xe.restTimerStrongAlert),c=!0===(null==Xe?void 0:Xe.restTimerScreenFlash),u=n>=o,m=u&&!t.finished?"animate-[timerPulseFast_900ms_ease-in-out_infinite]":t.finished?"animate-[timerFinishPop_900ms_ease-in-out_forwards]":t.running?"animate-[timerPulse_1800ms_ease-in-out_infinite]":"",p=Math.min(n/o*157,157);if(u&&!t.alerted&&c)try{document.body.classList.add("rest-screen-flash"),setTimeout(()=>document.body.classList.remove("rest-screen-flash"),520)}catch{}return i.jsxs("div",{className:"relative inline-flex items-center justify-center w-[52px] h-[52px]",children:[i.jsxs("svg",{className:"absolute inset-0 w-full h-full -rotate-90 pointer-events-none",viewBox:"0 0 60 60",children:[i.jsx("circle",{cx:"30",cy:"30",r:"25",fill:"none",stroke:"currentColor",strokeWidth:"4",className:"text-slate-700/30"}),i.jsx("circle",{cx:"30",cy:"30",r:"25",fill:"none",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round",className:"transition-all duration-1000 ease-linear "+(u?"text-rose-400":"text-emerald-500"),strokeDasharray:`${p} 157`,style:{filter:u?"drop-shadow(0 0 4px rgba(244, 63, 94, 0.6))":"drop-shadow(0 0 3px rgba(34, 197, 94, 0.4))"}})]}),i.jsx("span",{"aria-live":u?"assertive":"off","aria-label":`Rest time ${r} minutes ${a} seconds ${l} centiseconds${u?" – rest complete":""}`,className:`rest-timer relative font-mono tabular-nums select-none rounded-full w-[52px] h-[52px] flex flex-col items-center justify-center text-center leading-none ${u?"text-rose-300":"text-emerald-300"} ${m} ${u&&d?"rest-strong-alert":""} bg-[rgba(15,23,42,0.90)] shadow-lg backdrop-blur-sm`,children:t.running?i.jsxs(i.Fragment,{children:[i.jsxs("span",{className:"rest-timer-value relative z-10 font-bold tracking-tight text-base "+(u?"drop-shadow-[0_0_8px_rgba(255,255,255,0.6)] transition-transform":"transition-transform"),children:[r,":",String(a).padStart(2,"0")]}),i.jsxs("div",{className:"text-[7px] text-slate-500 mt-0.5 tabular-nums leading-none",children:[".",String(l).padStart(2,"0")]})]}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"text-[8px] uppercase tracking-wider text-slate-400 mb-0.5 font-medium leading-none",children:"Rest"}),i.jsxs("span",{className:"rest-timer-value relative z-10 font-bold tracking-tight text-sm "+(u?"drop-shadow-[0_0_8px_rgba(255,255,255,0.6)] transition-transform":"transition-transform"),children:[r,":",String(a).padStart(2,"0")]}),i.jsxs("div",{className:"text-[7px] text-slate-500 mt-0.5 tabular-nums leading-none",children:[".",String(l).padStart(2,"0")]})]})})]})};v.useEffect(()=>{I&&(R>I.mesoWeeks&&F(1),ee>=I.weekLengthDays&&te(0))},[I]),v.useEffect(()=>{(async()=>{var s;if(se)try{const i=`${B}-${R}-${ee}`;let o=await a.get("sessions",i);if(!o){const e=`${R}-${ee}`,t=await a.get("sessions",e);t&&(o={...t,id:i,phase:B},await a.delete("sessions",e),await a.put("sessions",o))}if(!o){const e=(await a.getAll("sessions")).filter(e=>{var t;return(null==(t=e.dateISO)?void 0:t.slice(0,10))===(new Date).toISOString().slice(0,10)}).find(e=>e.id===i);e&&(o=e)}if(!o){const s=I?I.weeklySplit[ee]:void 0,r=s?s.customLabel||s.type||"Day":O[ee],l=new Date,d=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`,c=(new Date).toISOString();if(o={id:i,dateISO:(()=>{const e=new Date;return e.setHours(0,0,0,0),e.toISOString()})(),localDate:d,weekNumber:R,phase:B,phaseNumber:B,dayName:r,entries:[],templateId:null==s?void 0:s.templateId,programId:null==I?void 0:I.id,createdAt:c,updatedAt:c},await a.put("sessions",o),null==s?void 0:s.templateId)try{const n=await a.get("templates",s.templateId);if(n){const r=await a.getAll("exercises"),i=await e(),l=new Map(r.map(e=>[e.id,e])),d=e=>{var t;const s=i.defaultSetRows??(null==(t=l.get(e))?void 0:t.defaults.sets)??3;return Math.min(6,Math.max(0,s))},c=(n.exerciseIds||[]).map(e=>({id:t(),exerciseId:e,sets:(()=>{const t=d(e);return 0===t?[]:Array.from({length:t},(e,t)=>({setNumber:t+1,weightKg:0,reps:0}))})()}));o={...o,entries:c,autoImportedTemplateId:s.templateId},await a.put("sessions",o)}}catch(n){}}pe(o);try{const t=await e(),n=null==(s=t.dashboardPrefs)?void 0:s.lastLocation,r={phaseNumber:B,weekNumber:R,dayId:ee,sessionId:o.id},a=n&&`${n.phaseNumber}-${n.weekNumber}-${n.dayId}`==`${r.phaseNumber}-${r.weekNumber}-${r.dayId}`;n&&!a||await l({...t,dashboardPrefs:{...t.dashboardPrefs||{},lastLocation:r}})}catch(r){}}catch(i){const e=`${B}-${R}-${ee}`,t=I?I.weeklySplit[ee]:void 0,s=t?t.customLabel||t.type||"Day":O[ee],n=new Date,r=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`,l=(new Date).toISOString(),o={id:e,dateISO:(()=>{const e=new Date;return e.setHours(0,0,0,0),e.toISOString()})(),localDate:r,weekNumber:R,phase:B,phaseNumber:B,dayName:s,entries:[],templateId:null==t?void 0:t.templateId,programId:null==I?void 0:I.id,createdAt:l,updatedAt:l};pe(o),setTimeout(async()=>{try{await a.put("sessions",o)}catch(e){}},1e3)}})()},[B,R,ee,se]),v.useEffect(()=>()=>{X(!1),Z.current=null},[]);const Yt=async(e,t)=>{const s=(new Date).toISOString();let n=!1;const r=e.entries.some(e=>e.sets.some(e=>(e.weightKg||0)>0||(e.reps||0)>0)),i=t.entries.some(e=>e.sets.some(e=>(e.weightKg||0)>0||(e.reps||0)>0));!i||r||t.loggedStartAt||(t.loggedStartAt=s,n=!0),i&&(t.loggedEndAt=s,n=!0);try{const e=new Date,n=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,r={...t.workLog||{}},a=r[n];r[n]=a?{...a,last:s,count:a.count+1}:{first:s,last:s,count:1},t.workLog=r}catch{}t.updatedAt=s,n=!0,n&&await a.put("sessions",t),t.updatedAt=(new Date).toISOString(),ms.current=Date.now(),pe(t)};const[qt,Jt]=v.useState(!0),Qt=v.useRef(!1),[Xt,Zt]=v.useState(0),[es,ts]=v.useState(new Set);v.useEffect(()=>{(async()=>{if(qt)return;if(Qt.current&&ie.length>0)return;let e=[];try{e=await a.getAll("sessions")}catch{return}if(!e.length)return;const t=new Set;for(const a of e)if(Array.isArray(a.entries))for(const e of a.entries)(null==e?void 0:e.exerciseId)&&t.add(e.exerciseId);if(!t.size)return void(Qt.current=!0);const s=new Set(ie.map(e=>e.id)),n=[...t].filter(e=>!s.has(e));if(!n.length)return void(Qt.current=!0);let r=0;const i=[];for(const l of n)try{if(await a.get("exercises",l))continue;const e=oe[l]||`Recovered ${l.slice(0,6)}`,t={id:l,name:e,muscleGroup:"other",defaults:{sets:3,targetRepRange:"8-12"},isOptional:!0};await a.put("exercises",t),r++,i.push(l)}catch{}if(r)try{const e=await a.getAll("exercises");le(e),Zt(r),ts(e=>new Set([...Array.from(e),...i]));try{window.dispatchEvent(new CustomEvent("sb-change",{detail:{table:"exercises"}}))}catch{}Ne({message:`Recovered ${r} exercise${r>1?"s":""}`})}catch{}Qt.current=!0})()},[qt,ie.length,oe,Ne]),v.useEffect(()=>{(async()=>{try{const[t,s]=await Promise.all([u("templates"),u("exercises")]);ae(t),le(s),Ge(!0);const n=await u("sessions");Ue(C(n,R,B,ee)),Ge(!1);const r=await e();Ze(r),Jt(!1),m("sessions"),m("exercises"),m("templates")}catch(t){ae([]),le([]),Ue(null),Ge(!1),Jt(!1);try{m("sessions"),m("exercises"),m("templates")}catch{}}})()},[]),v.useEffect(()=>{const e=e=>{var t;(null==(t=null==e?void 0:e.detail)?void 0:t.session)&&(async()=>{const[e,t]=await Promise.all([u("templates",{force:!0}),u("exercises",{force:!0})]);if(ae(e),le(t),me){const e=await a.get("sessions",me.id),t=(null==e?void 0:e.updatedAt)?Date.parse(e.updatedAt):0,s=ds.current||us.current&&us.current.size>0;e&&!s&&t>(ms.current||0)&&pe(e)}})()};return window.addEventListener("sb-auth",e),()=>window.removeEventListener("sb-auth",e)},[null==me?void 0:me.id]),v.useEffect(()=>{const e=e=>{var t;const s=null==(t=null==e?void 0:e.detail)?void 0:t.table;if("templates"===s&&u("templates",{force:!0}).then(ae),"exercises"===s&&u("exercises",{force:!0}).then(le),"sessions"===s&&me){if(ds.current||us.current&&us.current.size>0)return;a.get("sessions",me.id).then(e=>{if(!e)return;(e.updatedAt?Date.parse(e.updatedAt):0)<=(ms.current||0)||(pe(e),Ge(!0),u("sessions",{force:!0}).then(e=>{Ue(C(e,R,B,ee)),Ge(!1)}),ss(e))})}};return window.addEventListener("sb-change",e),()=>window.removeEventListener("sb-change",e)},[null==me?void 0:me.id]),v.useEffect(()=>{const e=e=>{var t;"sessions"===(null==(t=null==e?void 0:e.detail)?void 0:t.store)&&(async()=>{try{Ge(!0);const e=await a.getAll("sessions");Ue(C(e,R,B,ee)),Ge(!1)}catch{}await ss(me)})()};return window.addEventListener("cache-refresh",e),()=>window.removeEventListener("cache-refresh",e)},[null==me?void 0:me.id,R,B,ee,null==I?void 0:I.id,null==I?void 0:I.mesoWeeks,null==I?void 0:I.deload]),v.useEffect(()=>{(async()=>{Ge(!0);try{const e=await a.getAll("sessions");Ue(C(e,R,B,ee))}catch(e){Ue(null)}finally{Ge(!1)}})()},[R,B,ee]);const ss=async e=>{Qe(!0);try{if(!e)return He({}),void qe(null);const t=e=>e.phaseNumber??e.phase??1,s=e=>e.weekNumber??0,n=t=>e.templateId&&t.templateId?t.templateId===e.templateId:!(e.templateId||!e.dayName||!t.dayName)&&t.dayName===e.dayName,i=t=>!e.programId||!t.programId||t.programId===e.programId,l=I?r(I):new Set,o=t(e),d=s(e),c=await a.getAll("sessions"),u=c.filter(t=>t.id!==e.id).filter(n).filter(i).filter(e=>{const n=t(e),r=s(e);return!(n>o)&&!(n===o&&r>=d)}).sort((e,n)=>{const r=t(n)-t(e);if(0!==r)return r;const a=s(n)-s(e);if(0!==a)return a;const i=(Date.parse(n.dateISO)||0)-(Date.parse(e.dateISO)||0);return 0!==i?i:(Date.parse(n.updatedAt||"")||0)-(Date.parse(e.updatedAt||"")||0)}).find(e=>!l.has(s(e)));if(!u)return He({}),void qe(null);const m={};u.entries.forEach(e=>{m[e.exerciseId]=e.sets.slice().sort((e,t)=>(e.setNumber||0)-(t.setNumber||0)).map(e=>({weightKg:null==e.weightKg?null:e.weightKg,reps:null==e.reps?null:e.reps}))}),He(m),qe(u.weekNumber??null)}catch{He({}),qe(null)}finally{Qe(!1)}};v.useEffect(()=>{(async()=>{await ss(me)})()},[null==me?void 0:me.id,null==me?void 0:me.weekNumber,null==me?void 0:me.phaseNumber,null==me?void 0:me.templateId,null==me?void 0:me.dayName,null==me?void 0:me.programId,null==I?void 0:I.id,null==I?void 0:I.mesoWeeks,null==I?void 0:I.deload]);const ns=v.useMemo(()=>I?r(I):new Set,[I]),rs=ns.has(R),as=v.useMemo(()=>{var e;return(null==(e=null==me?void 0:me.entries)?void 0:e.length)?me.entries.map(e=>e.exerciseId).sort().join("|"):""},[null==me?void 0:me.entries]);v.useEffect(()=>{(async()=>{if(me&&I&&!me.programId){const e={...me,programId:I.id};await a.put("sessions",e),pe(e)}})()},[null==me?void 0:me.id,null==I?void 0:I.id]),v.useEffect(()=>{let t=!1;return(async()=>{var s;if(rs&&(null==(s=null==me?void 0:me.entries)?void 0:s.length))try{nt(!0),at(!1);const s=Array.from(new Set(me.entries.map(e=>e.exerciseId))),[n,r,a]=await Promise.all([u("sessions",{swr:!0}),ie.length?Promise.resolve(ie):u("exercises",{swr:!0}),Xe?Promise.resolve(Xe):e()]),i=await x(s,R,{deloadWeeks:ns},{sessions:n,exercises:r,settings:a});t||(tt(i),nt(!1))}catch(n){t||(tt({}),nt(!1),at(!0))}else t||(tt({}),nt(!1),at(!1))})(),()=>{t=!0}},[rs,as,null==me?void 0:me.id,R,ie,Xe,ns]);const is=t=>{if(!me)return;const s=[...t.sets].sort((e,t)=>(e.setNumber||0)-(t.setNumber||0)).slice(-1)[0],n={setNumber:t.sets.length+1,weightKg:(null==s?void 0:s.weightKg)??null,reps:(null==s?void 0:s.reps)??null,rpe:null==s?void 0:s.rpe,addedAt:(new Date).toISOString()},r={...t,sets:[...t.sets,n]},a=me.entries.map(e=>e.id===t.id?r:e);let i={...me,entries:a};const o=a.some(e=>e.sets.some(e=>(e.reps||0)>0||(e.weightKg||0)>0));if(o){const e=(new Date).toISOString();i.loggedStartAt||(i.loggedStartAt=e),i.loggedEndAt=e}i.updatedAt=(new Date).toISOString();try{const e=new Date,t=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,s={...i.workLog||{}},n=s[t];s[t]=n?{...n,last:i.updatedAt,count:n.count+1}:{first:i.updatedAt,last:i.updatedAt,count:1},i.workLog=s}catch{}ms.current=Date.now(),pe(i),cs.current=i,xs(),o&&Z.current===B&&(async()=>{try{const t=await e();await l({...t,currentPhase:B})}catch{}X(!1),Z.current=null})();try{Gt(t.id)}catch{}},ls=(e,t)=>{e.sets[t];const s=e.sets.filter((e,s)=>s!==t).map((e,t)=>({...e,setNumber:t+1})),n=me;hs({...e,sets:s}),Ne({message:"Set deleted",actionLabel:"Undo",onAction:async()=>{n&&(await a.put("sessions",n),pe(n))}})},os=(e,t,s)=>{const n=[...e.sets],[r]=n.splice(t,1);n.splice(s,0,r);const a=n.map((e,t)=>({...e,setNumber:t+1}));hs({...e,sets:a})},ds=v.useRef(null),cs=v.useRef(null),us=v.useRef(new Set),ms=v.useRef(0);v.useEffect(()=>{cs.current=me||null},[me]);const ps=async()=>{const t=cs.current;if(!t)return;await a.put("sessions",t);try{window.dispatchEvent(new CustomEvent("sb-change",{detail:{table:"sessions"}}))}catch{}if(0===us.current.size){const e=await a.get("sessions",t.id);if(e){if((e.updatedAt?Date.parse(e.updatedAt):0)>ms.current){pe(e),Ge(!0);const t=await u("sessions",{force:!0});Ue(C(t,R,B,ee)),Ge(!1)}}}const s=await e();await l({...s,dashboardPrefs:{...s.dashboardPrefs||{},lastLocation:{phaseNumber:B,weekNumber:R,dayId:ee,sessionId:t.id}}})},xs=()=>{ds.current&&window.clearTimeout(ds.current),ds.current=window.setTimeout(()=>{ps(),ds.current=null},1e3)};v.useEffect(()=>{const e=()=>{document.hidden&&ds.current&&ps()},t=()=>{ds.current&&ps()};return document.addEventListener("visibilitychange",e),window.addEventListener("beforeunload",t),()=>{document.removeEventListener("visibilitychange",e),window.removeEventListener("beforeunload",t)}},[]);const hs=t=>{if(!me)return;const s=me;me.entries.find(e=>e.id===t.id);const n=me.entries.map(e=>e.id===t.id?t:e);let r={...me,entries:n};const a=s.entries.some(e=>e.sets.some(e=>(e.reps||0)>0||(e.weightKg||0)>0)),i=n.some(e=>e.sets.some(e=>(e.reps||0)>0||(e.weightKg||0)>0));if(!a&&i){const e=new Date,t=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`;if((s.localDate||s.dateISO.slice(0,10))!==t){const e=new Date;e.setHours(0,0,0,0),r={...r,dateISO:e.toISOString(),localDate:t}}}if(i){const e=(new Date).toISOString();r.loggedStartAt||(r.loggedStartAt=e),r.loggedEndAt=e}r.updatedAt=(new Date).toISOString();try{const e=new Date,t=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,s={...r.workLog||{}},n=s[t];s[t]=n?{...n,last:r.updatedAt,count:n.count+1}:{first:r.updatedAt,last:r.updatedAt,count:1},r.workLog=s}catch{}ms.current=Date.now(),pe(r),cs.current=r,xs(),i&&Z.current===B&&(async()=>{try{const t=await e();await l({...t,currentPhase:B})}catch{}X(!1),Z.current=null})()},gs=async t=>{var s;if(!me)return;if((await e()).confirmDestructive){const e=(null==(s=ie.find(e=>{var s;return e.id===(null==(s=me.entries.find(e=>e.id===t))?void 0:s.exerciseId)}))?void 0:s.name)||"exercise";if(!window.confirm(`Remove ${e} from this session?`))return}const n=me,r={...me,entries:me.entries.filter(e=>e.id!==t)};pe(r),await a.put("sessions",r);const i=async()=>{pe(n),await a.put("sessions",n)};K={undo:i},Ne({message:"Exercise removed",actionLabel:"Undo",onAction:i})},fs=async n=>{if(!me)return;let r=[];const i=await h(n.id,R,B);if(rs){const e=await s(n.id,R,{deloadWeeks:ns}),t=i.length?Math.round(i.reduce((e,t)=>e+(t.reps||8),0)/i.length):8;r=Array.from({length:e.targetSets},(s,n)=>({setNumber:n+1,weightKg:e.targetWeight,reps:t}))}else r=i.length?i:[{setNumber:1,weightKg:null,reps:null}];const o={id:t(),exerciseId:n.id,sets:r},d={...me,entries:[...me.entries,o]};if(d.entries.some(e=>e.sets.some(e=>(e.reps||0)>0||(e.weightKg||0)>0))){const e=(new Date).toISOString();d.loggedStartAt||(d.loggedStartAt=e),d.loggedEndAt=e}d.updatedAt=(new Date).toISOString();try{const e=new Date,t=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,s={...d.workLog||{}},n=s[t];s[t]=n?{...n,last:d.updatedAt,count:n.count+1}:{first:d.updatedAt,last:d.updatedAt,count:1},d.workLog=s}catch{}ms.current=Date.now(),pe(d),await a.put("sessions",d);try{window.dispatchEvent(new CustomEvent("sb-change",{detail:{table:"sessions"}}))}catch{}const c=await e();await l({...c,dashboardPrefs:{...c.dashboardPrefs||{},lastLocation:{phaseNumber:B,weekNumber:R,dayId:ee,sessionId:d.id}}})},bs=async(e,t)=>{var s,n,r;if(!me)return;if(e.sets.some(e=>(e.weightKg||0)>0||(e.reps||0)>0)){if(!window.confirm("This exercise has logged sets. Switching will clear these set values. Continue?"))return}const a=e.sets.length||(null==(s=t.defaults)?void 0:s.sets)||3,i=Math.max(0,a),l=0===i?[]:Array.from({length:i},(t,s)=>{var n;return{setNumber:s+1,weightKg:null,reps:null,rpe:null==(n=e.sets[s])?void 0:n.rpe}}),o={...e,exerciseId:t.id,targetRepRange:(null==(n=null==t?void 0:t.defaults)?void 0:n.targetRepRange)??e.targetRepRange,sets:l};hs(o),Te(null);try{null==(r=navigator.vibrate)||r.call(navigator,10)}catch{}Ne({message:`Switched to ${t.name}`})},vs=v.useMemo(()=>me?new Set(me.entries.map(e=>e.exerciseId)):new Set,[null==me?void 0:me.id,null==me?void 0:me.entries]),ws=v.useMemo(()=>{if(!me)return[];const e=new Set,t=[];for(let s=me.entries.length-1;s>=0;s--){const n=me.entries[s];if(e.has(n.exerciseId))continue;const r=Bt.get(n.exerciseId);if(r&&(t.push(r),e.add(n.exerciseId)),6===t.length)break}return t},[null==me?void 0:me.entries,Bt]),ys=v.useMemo(()=>{const e=new Set;for(const t of ie)t.muscleGroup&&e.add(t.muscleGroup);return["all",...Array.from(e).sort((e,t)=>W(e).localeCompare(W(t)))]},[ie]),Ns=v.useMemo(()=>{const e=ge.trim().toLowerCase();return ie.filter(e=>"all"===be||e.muscleGroup===be).filter(t=>!e||t.name.toLowerCase().includes(e)).sort((e,t)=>e.name.localeCompare(t.name)).slice(0,200).map(e=>{const t=e.secondaryMuscles&&e.secondaryMuscles.length?`Secondary: ${e.secondaryMuscles.map(e=>W(e)).join(", ")}`:void 0,s=vs.has(e.id);return{id:e.id,label:e.name,description:W(e.muscleGroup),hint:t,selected:s,trailing:s?"In session":void 0,onSelect:()=>{fs(e),he(!1),fe(""),ve("all")}}})},[ie,be,ge,vs,fs]),js=(ys.length>1||ws.length>0)&&i.jsxs("div",{className:"flex flex-col gap-2 pt-1 text-xs text-white/70",children:[ys.length>1&&i.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[i.jsx("span",{className:"text-[10px] uppercase tracking-[0.28em] text-white/35",children:"Filter"}),ys.map(e=>{const t="all"===e?"All muscles":W(e),s=be===e;return i.jsx("button",{type:"button",className:"rounded-full border px-3 py-1 text-xs transition "+(s?"border-emerald-400/60 bg-emerald-500/20 text-emerald-100":"border-white/10 bg-white/5 text-white/70 hover:border-white/20 hover:text-white"),onClick:()=>ve(e),children:t},e)})]}),ws.length>0&&i.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[i.jsx("span",{className:"text-[10px] uppercase tracking-[0.28em] text-white/35",children:"Recent"}),ws.map(e=>i.jsx("button",{type:"button",className:"rounded-full border border-white/10 bg-white/5 px-3 py-1 text-xs text-white/80 transition hover:border-emerald-400/60 hover:bg-emerald-400/15 hover:text-white",onClick:()=>{fs(e),he(!1),fe(""),ve("all")},children:e.name},e.id))]})]}),Ss=v.useMemo(()=>{if(!Pe||!me)return null;const e=me.entries.find(e=>e.id===Pe.entryId);if(!e)return null;const t=Bt.get(e.exerciseId),s=(null==t?void 0:t.muscleGroup)||null,n=_e.trim().toLowerCase(),r=ie.filter(e=>e.id!==(null==t?void 0:t.id)),a="group"===Fe&&s?r.filter(e=>e.muscleGroup===s):r,i=a.filter(e=>!n||e.name.toLowerCase().includes(n)).sort((e,t)=>e.name.localeCompare(t.name)).slice(0,160).map(t=>{const s=t.secondaryMuscles&&t.secondaryMuscles.length?`Secondary: ${t.secondaryMuscles.map(e=>W(e)).join(", ")}`:void 0;return{id:t.id,label:t.name,description:W(t.muscleGroup),hint:s,onSelect:()=>bs(e,t)}});return{entry:e,currentEx:t,group:s,options:i,scopedCount:a.length,totalCount:r.length}},[null==Pe?void 0:Pe.entryId,null==me?void 0:me.entries,Bt,ie,_e,Fe,bs]),ks=Ss&&i.jsxs("div",{className:"flex flex-wrap items-center gap-2 pt-1 text-xs text-white/70",children:[i.jsx("span",{className:"text-[10px] uppercase tracking-[0.28em] text-white/35",children:"Scope"}),i.jsx("button",{type:"button",className:"rounded-full border px-3 py-1 text-xs transition "+("group"===Fe?"border-emerald-400/60 bg-emerald-500/20 text-emerald-100":"border-white/10 bg-white/5 text-white/70 hover:border-white/20 hover:text-white"),onClick:()=>We("group"),children:"Same muscle"}),i.jsx("button",{type:"button",className:"rounded-full border px-3 py-1 text-xs transition "+("all"===Fe?"border-emerald-400/60 bg-emerald-500/20 text-emerald-100":"border-white/10 bg-white/5 text-white/70 hover:border-white/20 hover:text-white"),onClick:()=>We("all"),children:"Show all"}),Ss.group?i.jsxs("span",{className:"ml-auto text-[11px] text-white/50",children:["Targeting ",W(Ss.group)]}):null]}),Is="lb"===(null==Xe?void 0:Xe.unit)?"lb":"kg",$s=v.useCallback(e=>{if(!Number.isFinite(e??null)||null==e||e<=0)return"BW";const t="lb"===Is?e*T:e;return t>=200?`${Math.round(t)}${Is}`:t>=20?`${t.toFixed(1)}${Is}`:`${t.toFixed(2)}${Is}`},[Is]),Cs=v.useCallback(e=>{if(!Number.isFinite(e)||e<=0)return null;const t="lb"===Is?e*T:e;return t>=1e4||t>=1e3?`${(t/1e3).toFixed(1)}k${Is}`:`${Math.round(t)}${Is}`},[Is]),Ds=v.useCallback(e=>{const t=e.dateISO||(e.localDate?`${e.localDate}T00:00:00`:null);if(!t)return"Undated session";const s=new Date(t);return Number.isNaN(s.getTime())?"Undated session":new Intl.DateTimeFormat(void 0,{weekday:"short",month:"short",day:"numeric",year:"numeric"}).format(s)},[]),As=v.useMemo(()=>{var e;return(null==(e=null==De?void 0:De.entries)?void 0:e.length)?De.entries.map((e,t)=>{const s=[];e.phaseNumber&&s.push(`Phase ${e.phaseNumber}`),e.weekNumber&&s.push(`Week ${e.weekNumber}`),e.dayName&&s.push(e.dayName);const n=s.join(" • "),r=e.sets.filter(e=>(e.reps||0)>0||(e.weightKg||0)>0),a=(r.length?r:e.sets).map((t,s)=>{const n=(t.weightKg||0)>0?$s(t.weightKg||0):"BW",r=null!=t.reps?t.reps:"—";return i.jsxs("div",{className:"flex flex-wrap items-center gap-3 rounded-xl border border-white/5 bg-white/5 px-3 py-2",children:[i.jsxs("span",{className:"text-[10px] uppercase tracking-[0.28em] text-white/45",children:["Set ",s+1]}),i.jsx("span",{className:"text-sm font-semibold text-white",children:n}),i.jsxs("span",{className:"text-sm text-white/80",children:["× ",r]}),null!=t.rpe?i.jsxs("span",{className:"text-xs text-white/60",children:["RPE ",t.rpe]}):null]},`${e.sessionId}-${e.entryId}-set-${s}`)}),l=a.length?i.jsx("div",{className:"space-y-1",children:a}):i.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-xs text-white/60",children:"No sets logged in this session."});return{id:`${e.sessionId}-${e.entryId}-${t}`,label:Ds(e),description:n||void 0,detail:l,selected:0===t,onSelect:()=>{}}}):[]},[null==De?void 0:De.entries,$s,Ds]),Ms=v.useMemo(()=>{if(!De||Me||Ke)return null;if(!De.entries.length)return null;const e=De.entries.reduce((e,t)=>e+t.tonnageKg,0),t=De.entries.reduce((e,t)=>e+t.workingSets,0);let s=null;for(const r of De.entries)r.bestSet&&(!s||(r.bestSet.weightKg||0)>((null==s?void 0:s.weightKg)||0))&&(s=r.bestSet);const n=Cs(e);return i.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-xs text-white/70",children:[i.jsxs("div",{className:"flex items-start justify-between gap-3",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-[11px] uppercase tracking-[0.32em] text-white/40",children:"Exercise"}),i.jsx("p",{className:"text-sm font-semibold text-white",children:De.name})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("p",{className:"text-[11px] uppercase tracking-[0.32em] text-white/40",children:"Sessions"}),i.jsx("p",{className:"text-lg font-semibold text-white",children:De.entries.length})]})]}),i.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-[10px] uppercase tracking-[0.32em] text-white/35",children:"Sets logged"}),i.jsx("p",{className:"mt-1 text-sm font-medium text-white",children:t})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[10px] uppercase tracking-[0.32em] text-white/35",children:"Volume"}),i.jsx("p",{className:"mt-1 text-sm font-medium text-white",children:n??"—"})]}),s?i.jsxs("div",{className:"col-span-2",children:[i.jsx("p",{className:"text-[10px] uppercase tracking-[0.32em] text-white/35",children:"Heaviest set"}),i.jsxs("p",{className:"mt-1 text-sm font-medium text-white",children:[$s(s.weightKg),"×",s.reps,null!=s.rpe?` · RPE ${s.rpe}`:""]})]}):null]})]})},[De,Me,Ke,Cs,$s]),Es=Me?"Loading history…":Ke??"No logged sessions yet for this exercise.",Ks=v.useCallback((e,t)=>{var s;const n=(null==(s=Bt.get(e))?void 0:s.name)||oe[e]||t,r=++Re.current;Ce(!0),Ee(!0),Le(null),Ae({exerciseId:e,name:n,entries:[]}),(async()=>{try{const t=await u("sessions",{swr:!0}),s=[];for(const n of t){if(!Array.isArray(n.entries))continue;const t=n.entries.find(t=>t.exerciseId===e);if(!t)continue;const r=Array.isArray(t.sets)?t.sets:[],a=r.filter(e=>(e.reps||0)>0||(e.weightKg||0)>0).length;if(0===a)continue;const i=r.reduce((e,t)=>e+(t.weightKg||0)*(t.reps||0),0);let l=null;for(const e of r){const t=e.weightKg||0,s=e.reps||0;t<=0||s<=0||(!l||t>(l.weightKg||0))&&(l={weightKg:t,reps:s,rpe:e.rpe??null})}s.push({exerciseId:e,sessionId:n.id,entryId:t.id,dateISO:n.dateISO,localDate:n.localDate??null,weekNumber:n.weekNumber??n.weekNumber??n.loggedWeek??null,phaseNumber:n.phaseNumber??n.phaseNumber??n.phase??null,dayName:n.dayName??n.dayName??null,sets:r,workingSets:a,totalSets:r.length,tonnageKg:i,bestSet:l})}const a=e=>{if(e.dateISO){const t=Date.parse(e.dateISO);if(!Number.isNaN(t))return t}if(e.localDate){const t=Date.parse(`${e.localDate}T00:00:00`);if(!Number.isNaN(t))return t}return 0};if(s.sort((e,t)=>a(t)-a(e)),Re.current!==r)return;Ae({exerciseId:e,name:n,entries:s})}catch(t){if(Re.current!==r)return;Le("Unable to load history right now.")}finally{Re.current===r&&Ee(!1)}})()},[Bt,oe]),Ls=v.useCallback(()=>{Ce(!1)},[]),Rs=async(e,t)=>{if(!me||e===t||e<0||t<0||e>=me.entries.length||t>=me.entries.length)return;const s=[...me.entries],[n]=s.splice(e,1);s.splice(t,0,n);const r={...me,entries:s};pe(r),await a.put("sessions",r)},Ps=async()=>{var e;if(!me)return;const t=new Date,s=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`,n=new Date;if(n.setHours(0,0,0,0),me.localDate===s)return void Ne({message:"Already stamped for today"});const r=me,i={...me,dateISO:n.toISOString(),localDate:s};pe(i),await a.put("sessions",i);try{window.dispatchEvent(new CustomEvent("sb-change",{detail:{table:"sessions"}}))}catch{}try{null==(e=navigator.vibrate)||e.call(navigator,15)}catch{}Ne({message:`Session dated ${Ts(s)}`,actionLabel:"Undo",onAction:async()=>{await a.put("sessions",r),pe(r)}})},Ts=e=>{if(!e)return"";if(/\d{4}-\d{2}-\d{2}/.test(e)){const[t,s,n]=e.split("-");return`${n}/${s}/${t}`}return e},_s=(()=>{var e;const t=null==me?void 0:me.workLog;if(t&&Object.keys(t).length){const s=Object.entries(t);s.sort((e,t)=>{var s,n,r,a,i,l;const o=(null==(s=e[1])?void 0:s.count)||0,d=(null==(n=t[1])?void 0:n.count)||0;if(d!==o)return d-o;const c=new Date((null==(r=e[1])?void 0:r.last)||0).getTime()-new Date((null==(a=e[1])?void 0:a.first)||0).getTime();return new Date((null==(i=t[1])?void 0:i.last)||0).getTime()-new Date((null==(l=t[1])?void 0:l.first)||0).getTime()-c});const n=null==(e=s[0])?void 0:e[1];if((null==n?void 0:n.first)&&(null==n?void 0:n.last)){const e=new Date(n.first).getTime(),t=new Date(n.last).getTime();if(!isNaN(e)&&!isNaN(t)&&t>=e){const s=Math.max(0,Math.min(t-e,432e4)),n=Math.floor(s/6e4),r=Math.floor(n/60);return r>0?`${r}h ${n%60}m`:`${n}m`}}}if(!(null==me?void 0:me.loggedStartAt)||!me.loggedEndAt)return null;const s=new Date(me.loggedStartAt).getTime(),n=new Date(me.loggedEndAt).getTime();if(isNaN(s)||isNaN(n)||n<s)return null;const r=n-s,a=Math.floor(r/6e4),i=Math.floor(a/60);return i>0?`${i}h ${a%60}m`:`${a}m`})(),Os=v.useMemo(()=>me?function(e){const t=[];for(const n of e.entries){const e=n.sets.map(e=>e.completedAt).filter(Boolean),s=[];for(let t=1;t<e.length;t++){const n=new Date(e[t-1]).getTime(),r=new Date(e[t]).getTime();if(!isNaN(n)&&!isNaN(r)&&r>=n){const e=r-n;e<=27e5&&s.push(e)}}const r=s.length?Math.round(s.reduce((e,t)=>e+t,0)/s.length):0,a=A(s),i=s.length?Math.max(...s):0;t.push({exerciseId:n.exerciseId,intervals:s,averageMs:r,medianMs:a,longestMs:i,count:s.length})}const s=t.flatMap(e=>e.intervals);return{exercises:t,overall:{averageMs:s.length?Math.round(s.reduce((e,t)=>e+t,0)/s.length):0,medianMs:A(s),longestMs:s.length?Math.max(...s):0,count:s.length}}}(me):null,[null==me?void 0:me.id,null==me?void 0:me.entries.length]),Fs=!qt&&null!=me&&null!=Ut,Ws=e=>{if(!e)return"–";const t=Math.floor(e/6e4),s=Math.round(e%6e4/1e3);return t>=1?`${t}m ${s.toString().padStart(2,"0")}s`:`${s}s`},[Bs,Us]=v.useState(!1),[zs,Gs]=v.useState({});return i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{id:"sessions-top-anchor","aria-hidden":"true",style:{position:"relative",height:0}}),i.jsx("section",{className:"px-4","aria-label":"Session controls",ref:Nt,children:i.jsxs("div",{className:"rounded-2xl border border-white/10 bg-[rgba(15,23,42,0.82)] backdrop-blur px-4 py-4 sm:px-6 sm:py-5 shadow-[0_20px_48px_rgba(15,23,42,0.55)] space-y-4 min-w-0",children:[i.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[i.jsxs("div",{className:"min-w-0",children:[i.jsx("h2",{className:"text-xl font-semibold tracking-tight text-slate-50",children:"Sessions"}),i.jsx("p",{className:"mt-0.5 text-[12px] text-slate-300/70",children:"Log today’s work, adjust weeks, and keep progressing."})]}),me&&!!me.entries.length&&i.jsxs("button",{className:"inline-flex items-center justify-center gap-1 rounded-xl border border-white/15 bg-slate-800/80 px-3 py-1.5 text-[11px] font-medium text-slate-200 shadow-sm transition hover:bg-slate-700/80","aria-label":_t?"Expand all exercises":"Collapse all exercises",title:_t?"Expand all exercises":"Collapse all exercises",onClick:()=>{var e;_t?Tt():Pt();try{null==(e=navigator.vibrate)||e.call(navigator,8)}catch{}},children:[i.jsx("span",{className:"text-base leading-none",children:_t?"↓":"↑"}),i.jsx("span",{className:"hidden sm:inline",children:_t?"Expand":"Collapse"})]})]}),i.jsxs("div",{className:"grid grid-cols-1 items-start gap-3 sm:grid-cols-[minmax(0,1.2fr)_minmax(0,0.9fr)_minmax(0,1fr)]",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("span",{className:"text-[11px] uppercase tracking-[0.32em] text-slate-300/60",children:"Workout day"}),i.jsx(U,{labels:I?I.weeklySplit.map(e=>e.customLabel||e.type):Kt||O,value:ee,onChange:e=>{te(e),lt(!0),X(!0)}})]}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("span",{className:"text-[11px] uppercase tracking-[0.32em] text-slate-300/60",children:"Week"}),i.jsx("select",{className:"bg-slate-900/70 text-slate-100 rounded-xl border border-white/10 px-3 py-2 text-sm shadow-inner",value:R,onChange:e=>{F(Number(e.target.value)),lt(!0),X(!0)},children:(I?Array.from({length:I.mesoWeeks},(e,t)=>t+1):Array.from({length:9},(e,t)=>t+1)).map(e=>i.jsxs("option",{value:e,children:["Week ",e,I&&ns.has(e)?" (Deload)":""]},e))}),i.jsx(L,{variant:"compact",value:B,onChange:async t=>{var s;J(t),X(!0),Z.current=t;const n=await e();await l({...n,dashboardPrefs:{...n.dashboardPrefs||{},lastLocation:{...(null==(s=n.dashboardPrefs)?void 0:s.lastLocation)||{weekNumber:1,dayId:0},phaseNumber:t}}})}})]}),me&&i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("span",{className:"text-[11px] uppercase tracking-[0.32em] text-slate-300/60",children:"Session date"}),i.jsxs("div",{className:"flex flex-wrap items-center gap-1 rounded-xl border border-white/10 bg-slate-900/70 px-3 py-2 text-[11px] text-slate-100",title:"Current assigned date (edit or stamp)",children:[!xt&&i.jsx("span",{className:"font-mono tracking-tight",title:me.localDate||me.dateISO.slice(0,10),children:Ts(me.localDate||me.dateISO.slice(0,10))}),xt&&i.jsxs("div",{className:"flex flex-wrap items-center gap-1",children:[i.jsx("input",{type:"date",className:"rounded px-2 py-1 text-[11px] text-slate-200 bg-slate-800/90",value:gt,onChange:e=>ft(e.target.value)}),i.jsx("button",{className:"rounded bg-emerald-600/80 px-2 py-1 text-[10px] text-emerald-50 transition hover:bg-emerald-600",onClick:async()=>{if(!me)return;if(!/\d{4}-\d{2}-\d{2}/.test(gt))return void Ne({message:"Invalid date"});if(me.localDate===gt)return void ht(!1);const e=me,t=new Date(gt+"T00:00:00");t.setHours(0,0,0,0);const s={...me,dateISO:t.toISOString(),localDate:gt};pe(s),await a.put("sessions",s);try{window.dispatchEvent(new CustomEvent("sb-change",{detail:{table:"sessions"}}))}catch{}ht(!1),Ne({message:`Date set to ${gt}`,actionLabel:"Undo",onAction:async()=>{await a.put("sessions",e),pe(e);try{window.dispatchEvent(new CustomEvent("sb-change",{detail:{table:"sessions"}}))}catch{}}})},children:"Save"}),i.jsx("button",{className:"rounded bg-slate-700/80 px-2 py-1 text-[10px] text-slate-200 transition hover:bg-slate-600",onClick:()=>ht(!1),children:"Cancel"})]}),i.jsx("button",{type:"button",className:"ml-auto rounded-lg border border-white/10 bg-white/10 px-2 py-1 text-[10px] uppercase tracking-[0.28em] text-white/60 transition hover:border-white/20 hover:bg-white/15 hover:text-white",onClick:()=>ht(e=>!e),children:xt?"Cancel":"Edit"})]}),!xt&&i.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[i.jsx("button",{className:"rounded bg-slate-700 px-2 py-1 text-[10px] transition hover:bg-slate-600 "+(bt?"animate-stamp":""),onClick:()=>{vt(!0),setTimeout(()=>vt(!1),360),Ps()},"aria-label":"Stamp with today's date",children:i.jsx("span",{className:"select-none",children:"Stamp"})}),i.jsx("button",{"aria-label":"Edit date",className:"rounded bg-slate-700 px-2 py-1 text-[10px] transition hover:bg-slate-600",onClick:()=>{ft(me.localDate||me.dateISO.slice(0,10)),ht(!0)},children:"✎"}),_s&&i.jsxs("span",{className:"ml-1 rounded bg-indigo-600/40 px-2 py-1 text-indigo-200",title:"Active logging duration (first to last non-zero set)",children:["⏱ ",_s]})]}),_s&&xt&&i.jsxs("span",{className:"ml-auto rounded bg-indigo-600/40 px-2 py-1 text-indigo-200",title:"Active logging duration (first to last non-zero set)",children:["⏱ ",_s]})]})]}),i.jsx("div",{className:"flex flex-wrap items-center gap-2 text-[11px] text-slate-200",children:i.jsxs("button",{className:"inline-flex items-center gap-2 rounded-xl border border-white/15 bg-slate-800/70 px-3 py-1.5 font-medium text-slate-100 shadow-sm transition hover:bg-slate-700/80",onClick:()=>yt(e=>!e),"aria-expanded":wt,"aria-controls":"session-tools-panel",type:"button",children:[i.jsx("span",{children:wt?"Hide tools":"Show tools"}),i.jsx("span",{className:"text-base leading-none transition-transform duration-150 "+(wt?"rotate-180":""),"aria-hidden":"true",children:"▾"})]})}),i.jsx(o,{initial:!1,children:wt&&i.jsxs(d.div,{id:"session-tools-panel",className:"flex flex-wrap items-center gap-2 text-[11px] text-slate-200",initial:{opacity:0,y:-6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:{duration:.18,ease:[.32,.72,.33,1]},children:[me&&i.jsxs(i.Fragment,{children:[i.jsx("button",{className:"tool-btn !px-3 !py-1.5",onClick:()=>{vt(!0),setTimeout(()=>vt(!1),360),Ps()},title:"Stamp with today's date",children:"Stamp"}),i.jsx("button",{className:"tool-btn !px-3 !py-1.5",onClick:()=>Se(!0),title:"Import from template",children:"Import"}),i.jsx("button",{className:"tool-btn !px-3 !py-1.5",disabled:!me.entries.length,onClick:()=>Ie(!0),title:me.entries.length?"Save this session as template":"No exercises to save",children:"Save"}),i.jsx("button",{className:"tool-btn !px-3 !py-1.5",onClick:()=>Pt(),title:"Collapse all exercises",children:"Collapse All"}),i.jsx("button",{className:"tool-btn !px-3 !py-1.5",onClick:()=>Tt(),title:"Expand all exercises",children:"Expand All"}),i.jsx("button",{className:"tool-btn !px-3 !py-1.5",onClick:async()=>{const e=`${B}-${Math.max(1,R-1)}-${ee}`;let s=await a.get("sessions",e);if(!s&&1===R&&B>1&&(s=await a.get("sessions",`${B-1}-9-${ee}`)),s){const e={...me,entries:s.entries.map(e=>({...e,id:t(),sets:e.sets.map((e,t)=>({...e,setNumber:t+1}))}))};pe(e),await a.put("sessions",e)}},title:"Copy previous session",children:"Copy Last"})]}),i.jsx("button",{className:"tool-btn !px-3 !py-1.5",onClick:async()=>{var t;const s=await e(),n=(s.currentPhase||1)+1;J(n),F(1),te(0),X(!0),Z.current=n,await l({...s,dashboardPrefs:{...s.dashboardPrefs||{},lastLocation:{...(null==(t=s.dashboardPrefs)?void 0:t.lastLocation)||{},phaseNumber:n,weekNumber:1,dayId:0}}})},title:"Next phase",children:"Next →"}),B>1&&i.jsx("button",{className:"tool-btn !px-3 !py-1.5",onClick:async()=>{var t;if(!window.confirm(`Go to phase ${B-1} (view only)?`))return;const s=await e(),n=Math.max(1,B-1);J(n),F(1),te(0),X(!0),Z.current=n,await l({...s,dashboardPrefs:{...s.dashboardPrefs||{},lastLocation:{...(null==(t=s.dashboardPrefs)?void 0:t.lastLocation)||{},phaseNumber:n,weekNumber:1,dayId:0}}})},title:"Previous phase",children:"← Prev"}),_s&&i.jsxs("span",{className:"ml-auto rounded-lg border border-indigo-500/30 bg-indigo-500/10 px-3 py-1 text-indigo-200",children:["⏱ ",_s]})]},"session-tools")}),$t&&i.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-emerald-400/30 bg-emerald-500/10 px-3 py-1 text-[11px] text-emerald-100 shadow-[0_6px_18px_-12px_rgba(16,185,129,0.6)]",children:[i.jsx("span",{className:"uppercase tracking-[0.24em] text-emerald-200/80",children:"Focus mode"}),i.jsx("button",{className:"rounded-full bg-emerald-400/20 px-2 py-0.5 text-[10px] text-emerald-50 transition-colors hover:bg-emerald-400/30",onClick:()=>Ot(),children:"Exit"})]})]})}),!qt&&me&&Ut&&i.jsx(z,{analytics:Ut,onFocusRequest:Wt,focusedEntryId:Dt}),me&&Os&&Os.overall.count>0&&i.jsxs("div",{className:"mx-4 mt-3 bg-[rgba(30,41,59,0.65)] rounded-xl p-3 space-y-2 border border-white/5",children:[i.jsxs("div",{className:"flex items-center justify-between text-[11px] text-slate-300",children:[i.jsx("span",{className:"font-semibold tracking-wide",children:"Pacing"}),i.jsx("button",{className:"text-[10px] underline text-slate-400",onClick:()=>Us(e=>!e),children:Bs?"Hide Details":"Show Details"})]}),i.jsxs("div",{className:"flex flex-wrap gap-3 text-[10px] text-slate-400",children:[i.jsxs("div",{children:["Sets:"," ",i.jsx("span",{className:"text-slate-200 font-medium",children:Os.overall.count})]}),i.jsxs("div",{children:["Avg Rest:"," ",i.jsx("span",{className:"text-slate-200 font-medium",children:Ws(Os.overall.averageMs)})]}),i.jsxs("div",{children:["Median:"," ",i.jsx("span",{className:"text-slate-200 font-medium",children:Ws(Os.overall.medianMs)})]}),i.jsxs("div",{children:["Longest:"," ",i.jsx("span",{className:"text-slate-200 font-medium",children:Ws(Os.overall.longestMs)})]}),_s&&i.jsxs("div",{children:["Session Span:"," ",i.jsx("span",{className:"text-slate-200 font-medium",children:_s})]})]}),Bs&&i.jsxs("div",{className:"space-y-1 max-h-64 overflow-auto pr-1",children:[Os.exercises.filter(e=>e.count>0).map(e=>{const t=Bt.get(e.exerciseId),s=(null==t?void 0:t.name)||oe[e.exerciseId]||e.exerciseId;return i.jsxs("div",{className:"flex items-center justify-between gap-2 text-[10px] bg-slate-800/50 rounded-lg px-2 py-1",children:[i.jsx("div",{className:"flex-1 min-w-0",children:i.jsx("button",{onClick:()=>{return t=e.exerciseId,Gs(e=>({...e,[t]:!e[t]}));var t},className:"text-left w-full truncate hover:whitespace-normal hover:line-clamp-none focus:outline-none",children:i.jsx("span",{className:"capitalize "+(zs[e.exerciseId]?"whitespace-normal break-words":""),children:s})})}),i.jsxs("div",{className:"flex gap-3 text-[9px] tabular-nums text-slate-300",children:[i.jsxs("span",{children:["n",e.count]}),i.jsxs("span",{children:["avg ",Ws(e.averageMs)]}),i.jsxs("span",{children:["med ",Ws(e.medianMs)]}),i.jsxs("span",{children:["max ",Ws(e.longestMs)]})]})]},e.exerciseId)}),!Os.exercises.some(e=>e.count>0)&&i.jsx("div",{className:"text-[10px] text-slate-500",children:"No rest intervals yet."})]})]}),i.jsx("div",{className:`flex flex-wrap items-center gap-2 ${Fs?"mt-0":"-mt-6"} sm:mt-0`,children:i.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[i.jsx("button",{className:"btn-primary-enhanced btn-enhanced px-4 py-2.5 rounded-xl font-medium text-white",onClick:()=>Se(!0),children:"Import from Template"}),i.jsx("button",{className:"bg-slate-700 hover:bg-slate-600 px-4 py-2.5 rounded-xl disabled:opacity-40 font-medium transition-all duration-200 hover:scale-[1.02] active:scale-95",disabled:!me||!me.entries.length,onClick:()=>Ie(!0),title:"Save current session as a reusable template",children:"Save as Template"}),i.jsx("button",{className:"bg-emerald-700 px-3 py-2 rounded-xl",title:"Start next 9-week phase",onClick:async()=>{if((await a.getAll("sessions")).filter(e=>(e.phaseNumber||e.phase||1)===B).some(e=>e.entries.some(e=>e.sets.some(e=>(e.weightKg||0)>0||(e.reps||0)>0)))){if(!window.confirm("Advance to next phase? This will reset week to 1."))return}else if(!window.confirm("No real training data logged in this phase. Advance anyway?"))return;const t=await e(),s=(t.currentPhase||1)+1;await l({...t,currentPhase:s}),J(s),F(1),te(0)},children:"Next phase →"}),B>1&&i.jsx("button",{className:"bg-slate-700 px-3 py-2 rounded-xl",title:"Revert to previous phase",onClick:async()=>{if(!window.confirm("Revert to phase "+(B-1)+"?"))return;const t=await e(),s=Math.max(1,(t.currentPhase||1)-1);await l({...t,currentPhase:s}),J(s),F(1),te(0)},children:"← Prev phase"}),i.jsx("button",{className:"bg-slate-700 px-3 py-2 rounded-xl",onClick:async()=>{if(!me)return;const e=`${B}-${Math.max(1,R-1)}-${ee}`;let s=await a.get("sessions",e);if(!s&&1===R&&B>1&&(s=await a.get("sessions",`${B-1}-9-${ee}`)),s){const e={...me,entries:s.entries.map(e=>({...e,id:t(),sets:e.sets.map((e,t)=>({...e,setNumber:t+1}))}))};pe(e),await a.put("sessions",e)}},children:"Copy last session"})]})}),rs&&i.jsx("div",{className:"text-xs text-amber-300 fade-in inline-flex items-center gap-1","data-shape":"deload","aria-label":"Deload week adjustments are active",children:"Deload adjustments active"}),i.jsxs("div",{className:"space-y-3 sm:mt-0 "+(Fs?"mt-0":"-mt-[72px]"),children:[qt&&i.jsxs("div",{className:"space-y-3","aria-label":"Loading session",children:[i.jsx("div",{className:"h-5 w-40 rounded skeleton"}),i.jsxs("div",{className:"rounded-2xl p-4 glow-card",children:[i.jsx("div",{className:"h-4 w-3/5 rounded skeleton mb-3"}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("div",{className:"h-8 rounded skeleton"}),i.jsx("div",{className:"h-8 rounded skeleton"}),i.jsx("div",{className:"h-8 rounded skeleton"})]})]}),i.jsxs("div",{className:"rounded-2xl p-4 glow-card",children:[i.jsx("div",{className:"h-4 w-2/5 rounded skeleton mb-3"}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("div",{className:"h-8 rounded skeleton"}),i.jsx("div",{className:"h-8 rounded skeleton"})]})]})]}),!qt&&me&&me.entries.length>0&&i.jsx(_,{session:me,exMap:Bt,exNameCache:oe}),!qt&&me&&me.entries.map((e,t)=>{var s,n;const r=Bt.get(e.exerciseId)||void 0,a=Be?(l=Be,c=e.exerciseId,l[c]):void 0;var l,c;const u=[...e.sets].sort((e,t)=>(t.weightKg??0)!==(e.weightKg??0)?(t.weightKg??0)-(e.weightKg??0):(t.reps||0)-(e.reps||0))[0],m=(null==(s=null==Xe?void 0:Xe.progress)?void 0:s.showPrevHints)??!0,x=!!(m&&a&&u&&u.weightKg===a.set.weightKg&&u.reps===a.set.reps),h=!!kt[e.id],f=$t&&e.id===Dt,b=$t&&e.id!==Dt,v=(()=>{var t,s;let n,a;const i=(null==me?void 0:me.templateId)?re.find(e=>e.id===me.templateId):void 0;if(i&&Array.isArray(i.plan)){const t=i.plan.find(t=>t.exerciseId===e.exerciseId);t&&(n=t.plannedSets,a=t.repRange)}return null==n&&(n=(null==(t=null==r?void 0:r.defaults)?void 0:t.sets)??void 0),a||(a=(null==(s=null==r?void 0:r.defaults)?void 0:s.targetRepRange)??e.targetRepRange),null!=n||a?{sets:n,reps:a}:null})(),w=e.sets.filter(e=>(e.reps||0)>0||(e.weightKg||0)>0),y=w.reduce((e,t)=>e+(t.weightKg||0)*(t.reps||0),0),N=w.slice().sort((e,t)=>(t.weightKg||0)*(t.reps||0)-(e.weightKg||0)*(e.reps||0))[0],j=(null==r?void 0:r.name)||oe[e.exerciseId]||"Deleted exercise",S="inline-flex items-center gap-2 min-w-0 "+(h?"whitespace-normal break-words":""),I=h?"whitespace-normal break-words pr-1":"truncate max-w-[56vw] sm:max-w-none";return i.jsxs("div",{id:`exercise-${e.id}`,className:`relative card-enhanced rounded-2xl p-4 fade-in reorder-anim group transition-opacity duration-200 ${b?"opacity-30":""} ${f?"ring-2 ring-[var(--accent)] ring-offset-2 ring-offset-slate-950 shadow-[0_0_0_1px_rgba(var(--accent-rgb,59,130,246),0.45)]":""}`,draggable:!0,onDragStart:e=>{ye(t),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",String(t))},onDragOver:e=>e.preventDefault(),onDrop:e=>{var s;e.preventDefault();const n=we??Number(e.dataTransfer.getData("text/plain"));if(null!=n){Rs(n,t),ye(null);try{"vibrate"in navigator&&(null==(s=navigator.vibrate)||s.call(navigator,10))}catch{}}},onTouchStart:e=>{const s=e.currentTarget;let n=!1;const r=t,a=window.setTimeout(()=>{var e;n=!0,ye(r),s.classList.add("ring-app");try{"vibrate"in navigator&&(null==(e=navigator.vibrate)||e.call(navigator,18))}catch{}setTimeout(()=>s.classList.remove("ring-app"),900)},550),i=()=>{clearTimeout(a),n||s.classList.remove("ring-app"),s.removeEventListener("touchend",i),s.removeEventListener("touchmove",i),s.removeEventListener("touchcancel",i)};s.addEventListener("touchend",i,{passive:!0}),s.addEventListener("touchmove",i,{passive:!0}),s.addEventListener("touchcancel",i,{passive:!0})},children:[i.jsxs("div",{className:"pointer-events-none absolute inset-0 rounded-2xl overflow-hidden",children:[i.jsx("div",{className:"absolute inset-px rounded-[14px] opacity-0 group-hover:opacity-100 transition-opacity duration-500 bg-[radial-gradient(circle_at_25%_20%,rgba(0,185,255,0.18),transparent_55%),radial-gradient(circle_at_80%_75%,rgba(77,91,255,0.15),transparent_60%)]"}),i.jsx("div",{className:"absolute -inset-px rounded-2xl bg-gradient-to-br from-brand-500/15 via-electric-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"})]}),i.jsxs("div",{className:"relative z-10",onClick:t=>{const s=t.target;s&&s.closest('[data-history-trigger="true"]')||t.defaultPrevented||Et(e.id)},role:"group",children:[i.jsxs("div",{className:"flex items-start justify-between gap-2 cursor-pointer select-none","aria-expanded":!h,"aria-controls":`entry-${e.id}-sets`,role:"button",tabIndex:0,onKeyDown:t=>{var s;if("Enter"===t.key||" "===t.key){if(null==(s=t.target)?void 0:s.closest('[data-history-trigger="true"]'))return;t.preventDefault(),Et(e.id)}},children:[i.jsxs("div",{className:"font-medium flex items-center gap-2 flex-nowrap min-w-0",children:[i.jsx("span",{className:"hidden sm:inline-block cursor-grab select-none opacity-40 group-hover:opacity-100 drag-handle",title:"Drag to reorder","aria-label":"Drag to reorder",children:"⋮⋮"}),i.jsxs("button",{type:"button",className:`${S} -ml-1 px-1 py-0.5 rounded-md text-left transition-colors duration-150 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent)] focus-visible:ring-offset-2 focus-visible:ring-offset-slate-950 ${h?"":"hover:bg-slate-800/40"}`,onClick:t=>{t.stopPropagation(),Ks(e.exerciseId,j)},onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),t.stopPropagation(),Ks(e.exerciseId,j))},"aria-label":`View history for ${j}`,title:`View history for ${j}`,"data-history-trigger":"true",children:[r&&i.jsx("img",{src:k(r.muscleGroup),alt:r.muscleGroup||"other",className:"w-4 h-4 opacity-80 flex-shrink-0 rounded-sm ring-1 ring-white/10 shadow-sm",loading:"lazy"}),i.jsx("span",{className:I,children:j}),!r&&(oe[e.exerciseId]||!0)&&i.jsx("span",{className:"text-[9px] px-1 py-0.5 rounded bg-rose-700/40 text-rose-200 border border-rose-500/30",title:"This exercise reference was missing and will be auto‑recovered. You can rename it in the exercise library.",children:"missing"}),r&&es.has(r.id)&&i.jsx("span",{className:"text-[9px] px-1 py-0.5 rounded bg-amber-700/40 text-amber-100 border border-amber-500/30",title:"Auto‑recovered placeholder exercise (original was deleted). Rename or edit details if needed.",children:"recovered"})]}),i.jsx("span",{className:"transition-transform text-xs opacity-70 "+(h?"rotate-180":""),children:"▾"}),(null==r?void 0:r.isOptional)&&i.jsx("span",{className:"hidden sm:inline text-[10px] text-gray-400",children:"optional"}),h&&i.jsxs("span",{className:"hidden sm:flex ml-2 text-[10px] px-2 py-1 rounded bg-slate-700/60 text-slate-200 items-center gap-2",children:[i.jsxs("span",{children:[e.sets.length," sets"]}),y>0&&i.jsxs("span",{className:"opacity-70",children:["• ",y.toLocaleString()]}),N&&i.jsxs("span",{className:"opacity-70",children:["• ",N.weightKg,"×",N.reps]}),v&&i.jsxs("span",{className:"opacity-80",title:"Template guide (planned sets × rep range)",children:["• Guide ",v.sets?`${v.sets}×`:"",v.reps||""]})]}),!h&&i.jsxs("div",{className:"flex sm:hidden items-center gap-1 text-[10px] ml-auto shrink-0",children:[i.jsx("button",{disabled:0===t,className:"px-2 py-1 rounded bg-slate-700 disabled:opacity-40",onClick:()=>Rs(t,Math.max(0,t-1)),children:"Up"}),i.jsx("button",{disabled:t===me.entries.length-1,className:"px-2 py-1 rounded bg-slate-700 disabled:opacity-40",onClick:()=>Rs(t,Math.min(me.entries.length-1,t+1)),children:"Down"})]})]}),i.jsxs("div",{className:"shrink-0 flex flex-col items-end gap-1 relative min-w-[118px]",children:[rs&&i.jsx("div",{className:"w-full flex justify-end mt-1",children:i.jsx("span",{"data-shape":"deload",children:i.jsx(V,{loading:st,errored:rt,info:et[e.exerciseId],unit:(null==Xe?void 0:Xe.unit)||"kg"})})}),i.jsxs("div",{className:"flex items-center gap-1 justify-end w-full",children:[i.jsx("button",{"aria-label":f?"Exit focus mode":"Focus on this exercise",className:"text-[11px] rounded-xl px-2 py-1 transition-colors duration-150 "+(f?"bg-gradient-to-r from-emerald-400 via-emerald-500 to-emerald-600 text-slate-950 shadow-[0_10px_24px_-14px_rgba(16,185,129,0.6)]":"bg-slate-800 text-slate-200 hover:bg-slate-700"),onClick:t=>{t.stopPropagation(),Wt(e.id)},children:f?"Focused":"Focus"}),i.jsx("button",{"aria-label":"Switch exercise",className:"text-[11px] bg-slate-800 rounded-xl px-2 py-1",onClick:t=>{t.stopPropagation(),Te({entryId:e.id}),Oe("")},title:"Switch to a different exercise for this muscle group",children:"⇄"}),i.jsx("button",{"aria-label":"Remove exercise",className:"text-[11px] bg-slate-800 rounded-xl px-2 py-1",onClick:()=>gs(e.id),children:"Remove"})]}),h&&i.jsxs("div",{className:"flex sm:hidden items-center gap-1 text-[10px] w-full justify-end",children:[i.jsx("button",{disabled:0===t,className:"px-2 py-1 rounded bg-slate-700 disabled:opacity-40",onClick:()=>Rs(t,Math.max(0,t-1)),children:"Up"}),i.jsx("button",{disabled:t===me.entries.length-1,className:"px-2 py-1 rounded bg-slate-700 disabled:opacity-40",onClick:()=>Rs(t,Math.min(me.entries.length-1,t+1)),children:"Down"})]})]})]}),h&&i.jsxs("div",{className:"sm:hidden mt-1 text-[10px] px-2 py-1 rounded bg-slate-700/60 text-slate-200 inline-flex items-center gap-2",children:[i.jsxs("span",{children:[e.sets.length," sets"]}),y>0&&i.jsxs("span",{className:"opacity-70",children:["• ",y.toLocaleString()]}),N&&i.jsxs("span",{className:"opacity-70",children:["• ",N.weightKg,"×",N.reps]}),v&&i.jsxs("span",{className:"opacity-80",title:"Template guide (planned sets × rep range)",children:["• Guide ",v.sets?`${v.sets}×`:"",v.reps||""]})]})]}),i.jsx(o,{initial:!1,children:!h&&m&&i.jsx(d.div,{className:"mt-1 flex items-center gap-2 flex-wrap",variants:p(g),initial:"initial",animate:"animate",exit:"exit",children:a?i.jsxs(i.Fragment,{children:[i.jsxs("span",{className:"prev-hint-pill","aria-label":`Previous best set: ${a.set.weightKg} kilograms for ${a.set.reps} reps`,title:"Last logged best set",children:[i.jsx("span",{className:"opacity-70",children:"Prev:"}),i.jsx("span",{children:a.set.weightKg}),i.jsx("span",{children:"×"}),i.jsx("span",{children:a.set.reps})]}),null!=a.set.weightKg&&null!=a.set.reps&&a.set.weightKg>0&&a.set.reps>0&&i.jsxs("span",{className:"prev-hint-pill opacity-80","aria-label":`Suggested target: ${a.set.weightKg} kilograms for ${a.set.reps+1} reps`,title:"Suggested target (same weight, +1 rep)","data-suggest":"true",children:[i.jsx("span",{className:"opacity-60",children:"Target:"}),i.jsx("span",{children:a.set.weightKg}),i.jsx("span",{children:"×"}),i.jsx("span",{children:a.set.reps+1})]}),x&&i.jsx("span",{className:"prev-hint-pill","data-nudge":"true",children:"Try +1 rep or +2.5kg?"})]}):ze?i.jsx("span",{className:"prev-hint-pill","aria-hidden":"true",children:"..."}):null},"prevhints")}),i.jsx(o,{initial:!1,children:!h&&i.jsxs(d.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.28,ease:[.32,.72,.33,1]},style:{overflow:"hidden"},children:[i.jsxs("div",{id:`entry-${e.id}-sets`,className:"mt-3 sm:hidden space-y-2",children:[e.sets.map((t,s)=>{var n,r,a,l,o;return i.jsxs("div",{className:"group relative rounded-2xl bg-gradient-to-br from-slate-900/40 to-slate-900/60 px-3 py-3 border border-white/[0.03] shadow-xl hover:shadow-2xl transition-all duration-300 hover:border-white/[0.06] hover:from-slate-900/50 hover:to-slate-900/70",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-emerald-500/0 to-emerald-500/0 group-hover:from-emerald-500/5 group-hover:to-transparent rounded-2xl transition-all duration-300 pointer-events-none"}),i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[i.jsxs("span",{className:"text-gray-300 flex items-center gap-1.5",children:["Set ",t.setNumber,null!=t.weightKg&&t.weightKg>0&&null!=t.reps&&t.reps>0&&i.jsx("span",{className:"inline-flex items-center justify-center w-4 h-4 rounded-full bg-emerald-500/20 success-checkmark",children:i.jsx("svg",{className:"w-2.5 h-2.5 text-emerald-400 success-glow",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"3",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),(()=>{const e=t.addedAt||t.completedAt;if(!e)return null;try{const t=new Date(e),s=String(t.getHours()).padStart(2,"0"),n=String(t.getMinutes()).padStart(2,"0");return i.jsxs("span",{className:"ml-1 text-[10px] text-slate-400/50 tabular-nums",title:`Added at ${t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`,children:[s,":",n]})}catch{return null}})()]}),0===s&&0===(t.weightKg||0)&&0===(t.reps||0)&&ce.get(e.exerciseId)&&i.jsx("span",{className:"text-[10px] text-emerald-300 bg-emerald-600/20 px-1.5 py-0.5 rounded",title:"Suggested progression (enter manually to apply)",children:(()=>{const t=ce.get(e.exerciseId);return`${t.weightKg??""}${t.weightKg?"kg":""}${t.reps?` x ${t.reps}`:""}`})()}),i.jsx(H,{exerciseId:e.exerciseId,score:(t.weightKg??0)*(t.reps??0),week:R})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{className:"btn-touch-secondary",disabled:0===s,onClick:()=>os(e,s,s-1),children:"Up"}),i.jsx("button",{className:"btn-touch-secondary",disabled:s===e.sets.length-1,onClick:()=>os(e,s,s+1),children:"Down"}),i.jsx("button",{className:"btn-touch-danger",onClick:()=>ls(e,s),children:"Del"})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsxs("div",{className:"bg-slate-900/40 rounded-xl px-2 py-2 relative",children:[i.jsxs("div",{className:"text-[11px] text-gray-400 mb-1 flex items-center justify-between",children:[i.jsx("span",{children:"Weight"}),(()=>{var n;const r=null==(n=Ve[e.exerciseId])?void 0:n[s];if(!r||null==r.weightKg||null==t.weightKg||0===t.weightKg)return null;const a=t.weightKg-r.weightKg;return a>0?i.jsxs("div",{className:"flex items-center gap-0.5 bg-emerald-500/25 border border-emerald-400/40 text-emerald-300 px-1 py-0.5 rounded text-[8px] font-bold shadow-sm",title:"Progressive overload - weight increased!",children:[i.jsx("svg",{className:"w-2 h-2",fill:"currentColor",viewBox:"0 0 20 20",children:i.jsx("path",{fillRule:"evenodd",d:"M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z",clipRule:"evenodd"})}),"+",a]}):null})()]}),i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("button",{className:"btn-input-compact",onClick:()=>hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,weightKg:Math.max(0,(e.weightKg||0)-2.5)}:e)}),children:"-"}),i.jsxs("div",{className:"relative flex-1 pb-5",children:[i.jsx("input",{type:"text",inputMode:"decimal",pattern:"[0-9]*[.,]?[0-9]*","aria-label":"Weight",className:"input-number-enhanced w-full","data-set-input":"true","data-entry-id":e.id,"data-set-number":t.setNumber,value:jt.current[`${e.id}:${t.setNumber}`]??(o=t.weightKg,null==o?"":String(o)),placeholder:"",onKeyDown:t=>{"ArrowUp"===t.key?(t.preventDefault(),hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,weightKg:(e.weightKg||0)+2.5}:e)})):"ArrowDown"===t.key&&(t.preventDefault(),hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,weightKg:Math.max(0,(e.weightKg||0)-2.5)}:e)}))},onChange:n=>{let r=n.target.value;if(r.includes(",")&&(r=r.replace(",",".")),!/^\d*(?:[.,]\d*)?$/.test(r))return;if(jt.current[`${e.id}:${t.setNumber}`]=r,""===r||/[.,]$/.test(r))return;const a=D(r);hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,weightKg:a}:e)})},onBlur:n=>{let r=n.target.value;r.includes(",")&&(r=r.replace(",","."));const a=D(r.replace(/\.$/,""));hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,weightKg:a}:e)}),delete jt.current[`${e.id}:${t.setNumber}`]}}),(()=>{var t;const n=null==(t=Ve[e.exerciseId])?void 0:t[s];if(n&&null!=n.weightKg){const e=Ye;return i.jsx("div",{className:"absolute -bottom-1 left-0 right-0 text-center text-[9px] text-emerald-400/60 tabular-nums pointer-events-none select-none font-medium",title:e?`Week ${e} weight`:"Previous weight",children:i.jsxs("span",{className:"bg-slate-900/70 px-1 py-0.5 rounded text-[8px]",children:["prev: ",n.weightKg,"kg"]})})}return Je?i.jsx("div",{className:"absolute -bottom-1 left-0 right-0 text-center text-[8px] text-slate-500/40 pointer-events-none select-none",children:"..."}):null})(),!((jt.current[`${e.id}:${t.setNumber}`]??"").length>0)&&null==t.weightKg&&(null==(n=ce.get(e.exerciseId))?void 0:n.weightKg)&&i.jsxs("span",{className:"pointer-events-none absolute inset-0 flex items-center justify-center text-[10px] text-emerald-500/40 font-medium",children:[null==(r=ce.get(e.exerciseId))?void 0:r.weightKg,"kg"]})]}),i.jsx("button",{className:"btn-input-compact",onClick:()=>hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,weightKg:(e.weightKg||0)+2.5}:e)}),children:"+"})]})]}),i.jsxs("div",{className:"bg-slate-900/40 rounded-xl px-2 py-2 relative",children:[i.jsxs("div",{className:"text-[11px] text-gray-400 mb-1 flex items-center justify-between",children:[i.jsx("span",{children:"Reps"}),(()=>{var n;const r=null==(n=Ve[e.exerciseId])?void 0:n[s];if(!r||null==r.reps||null==t.reps||0===t.reps)return null;const a=t.reps-r.reps;return a>0?i.jsxs("div",{className:"flex items-center gap-0.5 bg-emerald-500/25 border border-emerald-400/40 text-emerald-300 px-1 py-0.5 rounded text-[8px] font-bold shadow-sm",title:"Progressive overload - reps increased!",children:[i.jsx("svg",{className:"w-2 h-2",fill:"currentColor",viewBox:"0 0 20 20",children:i.jsx("path",{fillRule:"evenodd",d:"M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z",clipRule:"evenodd"})}),"+",a]}):null})()]}),i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("button",{className:"btn-input-compact",onClick:()=>hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,reps:Math.max(0,(e.reps||0)-1)}:e)}),children:"-"}),i.jsxs("div",{className:"relative flex-1 pb-5",children:[i.jsx("input",{inputMode:"numeric","aria-label":"Reps",className:"input-number-enhanced w-full","data-set-input":"true","data-entry-id":e.id,"data-set-number":t.setNumber,value:St.current[`${e.id}:${t.setNumber}`]??(null==t.reps?"":String(t.reps)),placeholder:"",onFocus:()=>{us.current.add(`${e.id}:${t.setNumber}:reps`)},onKeyDown:n=>{if("ArrowUp"===n.key)n.preventDefault(),hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,reps:(e.reps||0)+1}:e)});else if("ArrowDown"===n.key)n.preventDefault(),hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,reps:Math.max(0,(e.reps||0)-1)}:e)});else if("Enter"===n.key){const n=St.current[`${e.id}:${t.setNumber}`];if(void 0!==n){const r=""===n?null:Number(n);hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,reps:r}:e)}),delete St.current[`${e.id}:${t.setNumber}`],us.current.delete(`${e.id}:${t.setNumber}:reps`)}}},onChange:n=>{const r=n.target.value;/^\d*$/.test(r)&&(St.current[`${e.id}:${t.setNumber}`]=r,""!==r&&hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,reps:Number(r)}:e)}))},onBlur:n=>{const r=n.target.value,a=""===r?null:Number(r);hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,reps:a}:e)}),delete St.current[`${e.id}:${t.setNumber}`],us.current.delete(`${e.id}:${t.setNumber}:reps`)}}),(()=>{var t;const n=null==(t=Ve[e.exerciseId])?void 0:t[s];if(n&&null!=n.reps){const e=Ye;return i.jsx("div",{className:"absolute -bottom-1 left-0 right-0 text-center text-[9px] text-emerald-400/60 tabular-nums pointer-events-none select-none font-medium",title:e?`Week ${e} reps`:"Previous reps",children:i.jsxs("span",{className:"bg-slate-900/70 px-1 py-0.5 rounded text-[8px]",children:["prev: ",n.reps,"r"]})})}return Je?i.jsx("div",{className:"absolute -bottom-1 left-0 right-0 text-center text-[8px] text-slate-500/40 pointer-events-none select-none",children:"..."}):null})(),!((St.current[`${e.id}:${t.setNumber}`]??"").length>0)&&null==t.reps&&((null==(a=ce.get(e.exerciseId))?void 0:a.reps)||e.targetRepRange)&&i.jsx("span",{className:"pointer-events-none absolute inset-0 flex items-center justify-center text-[10px] text-emerald-400/35 font-medium",children:(null==(l=ce.get(e.exerciseId))?void 0:l.reps)??e.targetRepRange})]}),i.jsx("button",{className:"btn-input-compact",onClick:()=>hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,reps:(e.reps||0)+1}:e)}),children:"+"})]})]})]}),t.completedAt&&i.jsx("div",{className:"mt-1 text-[10px] text-right text-slate-400/40 tracking-tight",children:new Date(t.completedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},s)}),i.jsx("button",{className:"w-full btn-touch-primary",onClick:()=>is(e),children:"Add Set"}),i.jsxs("div",{className:"pt-2 pb-1 flex items-center justify-end gap-3 min-h-[44px]",children:[i.jsx("button",{className:"px-3 h-8 leading-none rounded-lg bg-slate-700 active:scale-95 transition-all focus:outline-none focus:ring-2 focus:ring-emerald-500/60 text-xs flex items-center "+((null==(n=dt[e.id])?void 0:n.running)?"bg-emerald-700 text-emerald-50 shadow-inner":""),onClick:()=>Gt(e.id),"aria-label":dt[e.id]?"Restart rest timer":"Start rest timer",children:dt[e.id]?"Restart Rest":"Start Rest"}),i.jsxs("div",{className:"flex items-center gap-1 ml-1 h-8",children:[Ht(e.id),dt[e.id]&&i.jsx("button",{className:"px-2 h-8 leading-none flex items-center justify-center rounded-md bg-slate-700 hover:bg-slate-600 text-[10px] text-slate-200 focus:outline-none focus:ring-2 focus:ring-rose-500/60","aria-label":"Stop rest timer",onClick:()=>Vt(e.id),children:"×"})]})]})]}),i.jsxs("div",{className:"mt-3 hidden sm:grid grid-cols-[auto,1fr,1fr,auto] gap-2 items-center",role:"list","aria-label":`Sets for exercise ${e.exerciseId}`,children:[i.jsx("div",{className:"text-sm text-gray-400",children:"Set"}),i.jsx("div",{className:"text-sm text-gray-400",children:"Weight"}),i.jsx("div",{className:"text-sm text-gray-400",children:"Reps"}),i.jsx("div",{}),e.sets.map((t,s)=>{var n,r,a,l;return i.jsxs("div",{className:"contents",role:"listitem","aria-roledescription":"Draggable set row","aria-label":`Set ${t.setNumber} weight ${t.weightKg||0} reps ${t.reps||0}`,draggable:!0,onDragStart:t=>{e._dragSet=s,t.dataTransfer.setData("text/plain",String(s)),t.currentTarget.setAttribute("aria-grabbed","true")},onDragEnd:e=>e.currentTarget.removeAttribute("aria-grabbed"),onDragOver:e=>e.preventDefault(),onDrop:t=>{const n=e._dragSet;"number"==typeof n&&(os(e,n,s),e._dragSet=void 0)},children:[i.jsx("div",{className:"px-2",children:t.setNumber}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("button",{className:"text-xs bg-slate-700 rounded px-2",onClick:()=>hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,weightKg:Math.max(0,(e.weightKg||0)-2.5)}:e)}),children:"-"}),i.jsxs("div",{className:"relative w-24",children:[i.jsx("input",{inputMode:"decimal",pattern:"[0-9]*[.,]?[0-9]*","aria-label":"Weight",className:"bg-slate-800 rounded-xl px-3 py-2 w-full text-center","data-set-input":"true","data-entry-id":e.id,"data-set-number":t.setNumber,value:jt.current[`${e.id}:${t.setNumber}`]??(t.weightKg||0===t.weightKg?String(t.weightKg):""),placeholder:(()=>{if((t.weightKg||0)>0)return"0";const s=ce.get(e.exerciseId);return(null==s?void 0:s.weightKg)?String(s.weightKg):"0.0"})(),onKeyDown:t=>{"ArrowUp"===t.key?(t.preventDefault(),hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,weightKg:(e.weightKg||0)+2.5}:e)})):"ArrowDown"===t.key&&(t.preventDefault(),hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,weightKg:Math.max(0,(e.weightKg||0)-2.5)}:e)}))},onChange:n=>{let r=n.target.value;if(r.includes(",")&&(r=r.replace(",",".")),!/^\d*(?:[.,]\d*)?$/.test(r))return;if(jt.current[`${e.id}:${t.setNumber}`]=r,""===r||/[.,]$/.test(r))return;const a=Number(r);isNaN(a)||hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,weightKg:a}:e)})},onBlur:n=>{let r=n.target.value;if(r.includes(",")&&(r=r.replace(",",".")),!/^\d*(?:[.,]\d*)?$/.test(r))return;const a=""===r?0:Number(r.replace(/\.$/,""));hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,weightKg:isNaN(a)?0:a}:e)}),delete jt.current[`${e.id}:${t.setNumber}`]}}),!((jt.current[`${e.id}:${t.setNumber}`]??"").length>0)&&null==t.weightKg&&(null==(n=ce.get(e.exerciseId))?void 0:n.weightKg)&&i.jsxs("span",{className:"pointer-events-none absolute inset-0 flex items-center justify-center text-[10px] text-emerald-500/40 font-medium",children:[null==(r=ce.get(e.exerciseId))?void 0:r.weightKg,"kg"]})]}),i.jsx("button",{className:"text-xs bg-slate-700 rounded px-2",onClick:()=>hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,weightKg:(e.weightKg||0)+2.5}:e)}),children:"+"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("button",{className:"text-xs bg-slate-700 rounded px-2",onClick:()=>hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,reps:Math.max(0,(e.reps||0)-1)}:e)}),children:"-"}),i.jsxs("div",{className:"relative w-20",children:[i.jsx("input",{inputMode:"numeric","aria-label":"Reps",className:"bg-slate-800 rounded-xl px-3 py-2 w-full text-center","data-set-input":"true","data-entry-id":e.id,"data-set-number":t.setNumber,value:St.current[`${e.id}:${t.setNumber}`]??(null==t.reps?"":String(t.reps)),placeholder:(()=>{if((t.reps||0)>0)return"0";const s=ce.get(e.exerciseId);return(null==s?void 0:s.reps)?String(s.reps):e.targetRepRange?e.targetRepRange:"0"})(),onKeyDown:n=>{if("ArrowUp"===n.key)n.preventDefault(),hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,reps:(e.reps||0)+1}:e)});else if("ArrowDown"===n.key)n.preventDefault(),hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,reps:Math.max(0,(e.reps||0)-1)}:e)});else if("Enter"===n.key){const n=St.current[`${e.id}:${t.setNumber}`];if(void 0!==n){const r=""===n?null:Number(n);hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,reps:r}:e)}),delete St.current[`${e.id}:${t.setNumber}`]}}},onChange:n=>{const r=n.target.value;/^\d*$/.test(r)&&(St.current[`${e.id}:${t.setNumber}`]=r,""!==r&&hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,reps:Number(r)}:e)}))},onBlur:n=>{const r=n.target.value,a=""===r?null:Number(r);hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,reps:a}:e)}),delete St.current[`${e.id}:${t.setNumber}`]}}),!((St.current[`${e.id}:${t.setNumber}`]??"").length>0)&&null==t.reps&&((null==(a=ce.get(e.exerciseId))?void 0:a.reps)||e.targetRepRange)&&i.jsx("span",{className:"pointer-events-none absolute inset-0 flex items-center justify-center text-[10px] text-emerald-400/35 font-medium",children:(null==(l=ce.get(e.exerciseId))?void 0:l.reps)??e.targetRepRange})]}),i.jsx("button",{className:"text-xs bg-slate-700 rounded px-2",onClick:()=>hs({...e,sets:e.sets.map((e,t)=>t===s?{...e,reps:(e.reps||0)+1}:e)}),children:"+"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(H,{exerciseId:e.exerciseId,score:(t.weightKg??0)*(t.reps??0),week:R}),i.jsx("button",{className:"text-[10px] bg-slate-700 rounded px-2 py-0.5",disabled:0===s,onClick:()=>os(e,s,s-1),children:"Up"}),i.jsx("button",{className:"text-[10px] bg-slate-700 rounded px-2 py-0.5",disabled:s===e.sets.length-1,onClick:()=>os(e,s,s+1),children:"Down"}),i.jsx("button",{className:"text-[10px] bg-red-600 rounded px-2 py-0.5",onClick:()=>ls(e,s),children:"Del"}),s===e.sets.length-1&&i.jsx("button",{className:"text-[10px] bg-emerald-700 rounded px-2 py-0.5",onClick:()=>(e=>{const t=[...e.sets].pop();if(!t)return;const s={...t,setNumber:e.sets.length+1};hs({...e,sets:[...e.sets,s]})})(e),children:"Dup"})]})]},s)}),i.jsxs("div",{className:"contents",children:[i.jsx("div",{}),i.jsx("div",{}),i.jsx("div",{}),i.jsx("div",{children:i.jsx("button",{className:"text-[10px] bg-emerald-700 rounded px-2 py-0.5",onClick:()=>is(e),children:"Add Set"})})]}),i.jsx("div",{className:"col-span-4 mt-2 flex items-center justify-end gap-3 text-[11px] min-h-[44px]",children:i.jsxs("div",{className:"flex items-center gap-1 h-8",children:[Ht(e.id),dt[e.id]&&i.jsx("button",{className:"px-2 h-8 leading-none flex items-center justify-center rounded-md bg-slate-700 hover:bg-slate-600 text-[10px] text-slate-200 focus:outline-none focus:ring-2 focus:ring-rose-500/60","aria-label":"Stop rest timer",onClick:()=>Vt(e.id),children:"×"})]})})]})]},"setsBlock")})]},e.id)})]}),me&&!!me.entries.length&&i.jsx(G,{session:me,exercises:ie,analytics:Ut}),i.jsx("div",{className:"h-40 sm:h-0","aria-hidden":"true"}),me&&!!me.entries.length&&i.jsx(q,{visibleThreshold:.5,children:i.jsx(Y,{session:me,exercises:ie,analytics:Ut})}),i.jsx(P,{open:$e,title:(null==De?void 0:De.name)?`${De.name} history`:"Exercise history",description:"Review recent sessions logged for this movement.",onClose:Ls,options:As,highlight:Ms??void 0,emptyState:i.jsx("div",{className:"rounded-2xl border border-white/10 bg-white/5 px-4 py-6 text-center text-sm text-white/70",children:Es}),maxListHeight:520}),i.jsx("div",{className:"bg-card rounded-2xl p-4 border border-white/5 hover:border-white/10 transition-all",children:i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("div",{className:"text-base font-medium",children:"Add exercise"}),i.jsx("button",{className:"btn-primary-enhanced btn-enhanced text-sm px-4 py-2.5 rounded-xl font-medium text-white",onClick:()=>he(!0),children:"Search"})]})}),i.jsx(P,{open:xe,title:"Add exercise",description:"Search the library or build a custom movement for this session.",onClose:()=>{he(!1),fe(""),ve("all")},searchValue:ge,onSearchChange:fe,searchPlaceholder:"Search or type a new exercise name",searchLabel:"Exercise",initialFocus:"search",options:Ns,highlight:js||void 0,emptyState:i.jsx("div",{className:"rounded-2xl border border-white/10 bg-white/5 px-4 py-6 text-center text-sm text-white/70",children:ge.trim()?`No exercises match "${ge.trim()}". Use the button below to create it.`:"No exercises found. Try syncing or creating a custom exercise."}),primaryAction:ge.trim()?{label:`Create "${ge.trim()}"`,onClick:()=>{(async e=>{const s=e.trim().replace(/\s+/g," ").slice(0,60);if(!s)return;const n={id:t(),name:s,muscleGroup:"other",defaults:{sets:3,targetRepRange:"8-12"}};await a.put("exercises",n),le([n,...ie]),await fs(n)})(ge.trim()),he(!1),fe(""),ve("all")}}:void 0,maxListHeight:560}),i.jsx(P,{open:Boolean(Pe)&&Boolean(Ss),title:(null==Ss?void 0:Ss.currentEx)?`Switch ${Ss.currentEx.name}`:"Switch exercise",description:(null==Ss?void 0:Ss.group)?`Browse alternatives for ${W(Ss.group)}.`:"Pick a different movement to replace this entry.",onClose:()=>Te(null),searchValue:_e,onSearchChange:Oe,searchPlaceholder:"Search exercises",searchLabel:"Search",initialFocus:"search",options:(null==Ss?void 0:Ss.options)??[],highlight:ks||void 0,emptyState:i.jsxs("div",{className:"space-y-3 rounded-2xl border border-white/10 bg-white/5 px-4 py-6 text-center text-sm text-white/70",children:[i.jsx("p",{children:"No alternatives found in this view."}),"group"===Fe&&((null==Ss?void 0:Ss.totalCount)||0)>0?i.jsx("button",{type:"button",className:"inline-flex items-center justify-center gap-2 rounded-full border border-white/15 bg-white/10 px-4 py-2 text-xs font-medium text-white/80 transition hover:border-emerald-400/60 hover:bg-emerald-400/20 hover:text-white",onClick:()=>We("all"),children:"Show all exercises"}):null]}),footer:(null==Ss?void 0:Ss.currentEx)?i.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-xs text-white/70",children:[i.jsx("span",{className:"text-white/90",children:"Currently:"})," ",i.jsx("span",{className:"font-medium text-white",children:Ss.currentEx.name})]}):void 0,maxListHeight:520}),i.jsx("div",{children:i.jsx("button",{className:"text-xs underline",onClick:()=>async function(){K&&(await K.undo(),K=null)}(),children:"Undo last action"})}),i.jsx(M,{open:je,onClose:()=>Se(!1),session:me,weekNumber:R,onImported:(e,t,s)=>{pe(e),Ne({message:`Imported ${t} exercises from "${s}"`})}}),i.jsx(E,{open:ke,onClose:()=>Ie(!1),session:me,onSaved:e=>{Ne({message:`Saved template "${e.name}"`})}}),i.jsx("div",{id:"sessions-bottom-anchor","aria-hidden":"true",style:{position:"relative",height:0}})]})}function U({labels:e,value:t,onChange:s}){const[n,r]=v.useState(!1),a=v.useRef(null),l=v.useRef(null);v.useEffect(()=>{e.length&&(t<0?s(0):t>=e.length&&s(e.length-1))},[e.length,t,s]),v.useEffect(()=>{try{sessionStorage.setItem("lastDayIdx",String(t))}catch{}},[t]),v.useEffect(()=>{if(e.length)try{const n=sessionStorage.getItem("lastDayIdx");if(null!=n){const r=Number(n);if(Number.isFinite(r)){const n=Math.max(0,Math.min(e.length-1,r));n!==t&&s(n)}}}catch{}},[e.length,s,t]),v.useEffect(()=>{var e;if(n)try{null==(e=navigator.vibrate)||e.call(navigator,12)}catch{}},[n]);const o=v.useCallback(e=>{l.current&&(l.current.textContent=`Selected ${e}`)},[]),d=v.useCallback(t=>{var n;const a=e[t]||`Day ${t+1}`;s(t),r(!1),o(a);try{null==(n=navigator.vibrate)||n.call(navigator,10)}catch{}},[e,s,o]),c=v.useMemo(()=>e.length?e.map((e,s)=>{const n=e||`Day ${s+1}`;return{id:String(s),label:n,description:`Day ${s+1}`,selected:s===t,trailing:s===t?"Current":void 0,onSelect:()=>d(s)}}).filter(Boolean):[],[e,t,d]),u=e[t]||`Day ${t+1}`;return i.jsxs("div",{className:"relative",children:[i.jsxs("button",{ref:a,type:"button",onClick:()=>r(!0),onKeyDown:e=>{["Enter"," ","ArrowDown","ArrowUp"].includes(e.key)&&(e.preventDefault(),r(!0))},"aria-haspopup":"listbox","aria-expanded":n,className:"inline-flex w-full sm:w-auto max-w-full items-center justify-between gap-2 rounded-md border border-white/10 bg-slate-800/70 px-3 py-2 text-sm text-white/90 transition hover:border-white/20 hover:bg-slate-700/70 focus:outline-none focus:ring-2 focus:ring-emerald-500/40",title:u,children:[i.jsx("span",{className:"truncate max-w-[70vw] sm:max-w-[180px]",children:u}),i.jsx("span",{className:"opacity-70 text-[10px]","aria-hidden":"true",children:"▼"})]}),i.jsx(P,{open:n,title:"Choose workout day",description:"Switching days updates the session you are editing.",onClose:()=>{r(!1)},initialFocus:"list",options:c,emptyState:i.jsx("div",{className:"rounded-2xl border border-white/10 bg-white/5 px-4 py-6 text-center text-sm text-white/70",children:"No days available."}),footer:e.length>0?i.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-xs text-white/60",children:[e.length," day",1===e.length?"":"s"," in this phase"]}):void 0,maxListHeight:420}),i.jsx("div",{ref:l,className:"sr-only","aria-live":"polite"})]})}function z({analytics:e,onFocusRequest:t,focusedEntryId:s}){const n=Math.max(0,Math.min(100,e.completionPct)),r=e.muscleLoad.filter(e=>e.workingSets>0).length,a=e.muscleLoad.slice(0,4),l=[];for(const i of e.incompleteExercises)if(0===i.workingSets&&l.push(i),3===l.length)break;const o=l.length;return i.jsxs("div",{className:"mx-4 mt-2 space-y-4 rounded-2xl border border-white/8 bg-slate-950/70 p-4 shadow-[0_18px_40px_-28px_rgba(59,130,246,0.85)] fade-in",children:[i.jsxs("div",{className:"flex flex-wrap items-end justify-between gap-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-[11px] uppercase tracking-[0.32em] text-gray-400/70",children:"Session momentum"}),i.jsxs("div",{className:"mt-1 flex items-baseline gap-2",children:[i.jsxs("span",{className:"text-3xl font-semibold text-white/90",children:[n,"%"]}),i.jsx("span",{className:"text-xs uppercase tracking-[0.28em] text-gray-400",children:"Complete"})]})]}),i.jsxs("div",{className:"text-right text-sm text-gray-300",children:[i.jsxs("div",{className:"font-medium text-white/90",children:[e.completedSets.toLocaleString()," /"," ",e.plannedSets.toLocaleString()," sets"]}),i.jsxs("div",{className:"text-[11px] text-gray-500",children:[e.completedExercises,"/",e.totalExercises," exercises logged"]})]})]}),i.jsx("div",{className:"progress-track mt-3",children:i.jsx("div",{className:"progress-fill",style:{width:`${n}%`},"aria-hidden":"true"})}),i.jsxs("div",{className:"grid gap-3 text-[11px] text-gray-300 sm:grid-cols-4",children:[i.jsxs("div",{className:"rounded-xl border border-white/8 bg-slate-900/60 px-3 py-2 shadow-inner",children:[i.jsx("span",{className:"block text-[9px] uppercase tracking-[0.28em] text-gray-500",children:"Sets"}),i.jsx("span",{className:"mt-1 text-sm font-semibold text-white/90",children:e.completedSets.toLocaleString()}),i.jsxs("span",{className:"ml-1 text-[10px] text-gray-500",children:["of ",e.plannedSets.toLocaleString()]})]}),i.jsxs("div",{className:"rounded-xl border border-white/8 bg-slate-900/60 px-3 py-2 shadow-inner",children:[i.jsx("span",{className:"block text-[9px] uppercase tracking-[0.28em] text-gray-500",children:"Volume"}),i.jsx("span",{className:"mt-1 text-sm font-semibold text-emerald-300",children:e.totalVolume.toLocaleString()})]}),i.jsxs("div",{className:"rounded-xl border border-white/8 bg-slate-900/60 px-3 py-2 shadow-inner",children:[i.jsx("span",{className:"block text-[9px] uppercase tracking-[0.28em] text-gray-500",children:"PR Signals"}),i.jsx("span",{className:"mt-1 text-sm font-semibold text-white/90",children:e.prSignals})]}),i.jsxs("div",{className:"rounded-xl border border-white/8 bg-slate-900/60 px-3 py-2 shadow-inner",children:[i.jsx("span",{className:"block text-[9px] uppercase tracking-[0.28em] text-gray-500",children:"Muscles active"}),i.jsx("span",{className:"mt-1 text-sm font-semibold text-white/90",children:r})]})]}),a.length>0&&i.jsx("div",{className:"flex flex-wrap items-center gap-2 text-[11px] text-slate-200",children:a.map(e=>{const t=k(e.muscle);return i.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-slate-900/60 px-3 py-1 tabular-nums",title:`${e.muscle} · ${e.workingSets}/${e.totalSets} sets`,children:[t?i.jsx("img",{src:t,alt:e.muscle,className:"h-5 w-5 rounded-sm border border-white/15 bg-black/20"}):i.jsx("span",{className:"h-5 w-5 rounded-sm border border-white/10 bg-slate-700/60","aria-hidden":"true"}),i.jsxs("span",{className:"text-emerald-300",children:[e.workingSets,"/",e.totalSets]})]},e.muscle)})}),o>0&&i.jsxs("div",{className:"rounded-xl border border-white/10 bg-slate-900/70 p-3",children:[i.jsxs("div",{className:"flex items-center justify-between text-[11px] uppercase tracking-[0.26em] text-gray-400",children:[i.jsx("span",{children:"Up next"}),i.jsxs("span",{className:"text-gray-500 normal-case tracking-normal",children:[o," item",1===o?"":"s"]})]}),i.jsx("div",{className:"mt-2 grid gap-2 sm:grid-cols-2",children:l.map(e=>{const n=s===e.entryId;return i.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-lg border px-3 py-2 text-[11px] "+(n?"border-emerald-400/50 bg-emerald-500/10 text-emerald-100":"border-white/10 bg-slate-800/60 text-slate-200"),children:[i.jsxs("div",{className:"min-w-0",children:[i.jsx("div",{className:"truncate font-medium text-white/90",children:e.name}),i.jsxs("div",{className:"text-[10px] text-gray-400",children:[e.missingSets," set",1===e.missingSets?"":"s"," ","remaining ·"," ",i.jsx("span",{className:"capitalize",children:e.muscle})]})]}),t&&i.jsx("button",{className:"shrink-0 rounded-full px-2 py-1 text-[10px] font-medium transition "+(n?"bg-emerald-400 text-slate-950":"bg-slate-700 text-slate-200 hover:bg-slate-600"),onClick:()=>t(e.entryId),children:n?"Focused":"Focus"})]},e.entryId)})})]})]})}function G({session:e,exercises:t,analytics:s}){const n=v.useMemo(()=>new Map(t.map(e=>[e.id,e])),[t]),r=v.useMemo(()=>{var t;let s=0,r=0,a=0;for(const i of e.entries)for(const e of i.sets){s++;const l=(e.weightKg||0)*(e.reps||0);r+=l,l>0&&l>=50*((null==(t=n.get(i.exerciseId))?void 0:t.defaults.sets)||3)&&a++}return{sets:s,volume:r,prs:a}},[e,n]),a=s?{sets:s.completedSets,volume:s.totalVolume,prs:s.prSignals}:r,l=v.useMemo(()=>{const t={};for(const r of e.entries){const e=n.get(r.exerciseId);if(!e)continue;const s=e.muscleGroup||"other";let a=t[s];a||(a=t[s]={sets:0,tonnage:0});for(const t of r.sets)a.sets+=1,a.tonnage+=(t.weightKg||0)*(t.reps||0)}const s=e=>e.charAt(0).toUpperCase()+e.slice(1);return Object.entries(t).filter(([,e])=>e.sets>=1).sort((e,t)=>s(e[0]).localeCompare(s(t[0])))},[e,n]),o=s?s.muscleLoad.filter(e=>e.workingSets>0).map(e=>[e.muscle,{sets:e.workingSets,tonnage:e.tonnage}]):l,d=a.volume;return i.jsx("div",{className:"bg-card rounded-2xl p-4 shadow-soft mt-4 fade-in",children:i.jsxs("div",{className:"flex flex-wrap gap-4 text-xs",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-muted",children:"Sets:"})," ",a.sets]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-muted",children:"Volume:"})," ",d]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-muted",children:"PR Signals:"})," ",a.prs]}),o.length>0&&i.jsx("div",{className:"inline-flex flex-wrap items-center gap-2",children:o.map(([e,t])=>i.jsxs("span",{className:"px-2 py-0.5 rounded-md bg-slate-800 text-slate-200 border border-white/10 tabular-nums",title:`${e} • ${t.sets} sets • ${t.tonnage} tonnage`,children:[i.jsxs("span",{className:"opacity-70 mr-1",children:[e.charAt(0).toUpperCase()+e.slice(1),":"]}),i.jsxs("span",{children:[t.sets," sets · ",t.tonnage]})]},e))})]})})}function V({info:e,loading:t,errored:s,unit:n}){let r="Deload --";if(t)r="Deload …";else if(s)r="Deload --";else if(e&&!e.inactive){const t=Math.max(0,e.targetSets??0),s=(a=e.targetWeight??0,!Number.isFinite(a)||a<=0?null:`${"lb"===n?Math.round(2.20462*a):Math.round(a)}${n}`);if(s){r=`Deload ${s}${t>0?` × ${t}`:""}`}else r=t>0?`Deload × ${t}`:"Deload"}var a;return i.jsx("span",{className:"inline-flex items-center gap-1 text-xs bg-slate-800 rounded-xl px-2 py-1 whitespace-nowrap",children:r})}function H({exerciseId:e,score:t,week:s}){const[n,r]=v.useState(0);return v.useEffect(()=>{(async()=>{const t=await f(e);r(t.bestTonnageSet)})()},[e,s]),t<=0||n<=0||t<n?null:i.jsxs("span",{className:"text-[8px] rounded px-1 py-0.5 inline-flex items-center gap-0.5 bg-yellow-500/90 text-black border border-yellow-400/50 font-bold","data-shape":"pr","aria-label":"Personal record set",title:"Personal Record",children:[i.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-black","aria-hidden":"true"}),"PR"]})}function Y({session:e,exercises:t,analytics:s}){const n=v.useMemo(()=>new Map(t.map(e=>[e.id,e])),[t]),r=v.useMemo(()=>{var t;let s=0,r=0,a=0;for(const i of e.entries)for(const e of i.sets)if((e.reps||0)>0||(e.weightKg||0)>0){s++;const l=(e.weightKg||0)*(e.reps||0);r+=l,l>0&&l>=50*((null==(t=n.get(i.exerciseId))?void 0:t.defaults.sets)||3)&&a++}return{sets:s,volume:r,prs:a}},[e,n]),a=s?{sets:s.completedSets,volume:s.totalVolume,prs:s.prSignals}:r,l=v.useMemo(()=>{const t={};for(const r of e.entries){const e=n.get(r.exerciseId);if(!e)continue;const s=e.muscleGroup||"other";let a=0;for(const t of r.sets)((t.reps||0)>0||(t.weightKg||0)>0)&&a++;a>0&&(t[s]=(t[s]||0)+a)}const s=e=>e.charAt(0).toUpperCase()+e.slice(1);return Object.entries(t).filter(([,e])=>e>=1).sort((e,t)=>s(e[0]).localeCompare(s(t[0])))},[e,n]),o=s?s.muscleLoad.filter(e=>e.workingSets>0).map(e=>[e.muscle,e.workingSets]):l;return i.jsxs("div",{className:"flex items-center gap-4 text-xs font-medium",children:[i.jsxs("span",{className:"flex flex-col items-center gap-0.5",children:[i.jsx("span",{className:"metric-label",children:"Sets"}),i.jsx("span",{className:"display-number-sm text-slate-100",children:a.sets})]}),i.jsxs("span",{className:"flex flex-col items-center gap-0.5",children:[i.jsx("span",{className:"metric-label",children:"Vol"}),i.jsx("span",{className:"display-number-sm text-emerald-400",children:a.volume})]}),i.jsxs("span",{className:"flex flex-col items-center gap-0.5",children:[i.jsx("span",{className:"metric-label",children:"PR"}),i.jsx("span",{className:"display-number-sm text-emerald-400",children:a.prs})]}),o.length>0&&i.jsx("div",{className:"flex items-center gap-2",children:o.map(([e,t])=>i.jsxs("span",{className:"px-2 py-0.5 rounded bg-slate-800/80 border border-white/10 whitespace-nowrap",children:[e.charAt(0).toUpperCase()+e.slice(1)," ",t]},e))})]})}function q({children:e,visibleThreshold:t=.5}){const[s,n]=v.useState(!0);return v.useEffect(()=>{const e=()=>{const e=document.documentElement.scrollHeight-window.innerHeight||1,s=window.scrollY/e;n(s<t)};return e(),window.addEventListener("scroll",e,{passive:!0}),()=>window.removeEventListener("scroll",e)},[t]),i.jsx("div",{className:"fixed sm:hidden bottom-0 left-0 right-0 z-30 px-4 py-3 flex items-center gap-4 overflow-x-auto transition-all duration-500 ease-out will-change-transform backdrop-blur border-t border-white/10 bg-slate-900/80 "+(s?"opacity-100 translate-y-0":"opacity-0 translate-y-4 pointer-events-none"),"aria-hidden":s?void 0:"true",children:e})}export{B as default};
